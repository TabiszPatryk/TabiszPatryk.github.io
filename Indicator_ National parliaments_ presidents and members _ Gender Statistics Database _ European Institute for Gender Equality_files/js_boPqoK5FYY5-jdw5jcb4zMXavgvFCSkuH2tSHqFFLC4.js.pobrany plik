/* @license GNU-GPL-2.0-or-later https://www.drupal.org/licensing/faq */
(function($){"use strict";window.app={views:{},controllers:{},models:{},collections:{},templates:{},data:{},isMobile:window.orientation!==undefined,isIE:window.navigator.userAgent.indexOf("MSIE ")>0||window.navigator.userAgent.indexOf("Trident")>0,getDbEndpoint:function(path){return app.ajaxPath+'?path='+encodeURIComponent(path);},getFilename:function(filename){return app.rootFiles+'/'+filename+'?'+app.cacheBuster;},run:function(root,ajaxPath,rootFiles,rootElementSelector,cacheBuster){$LAB.setGlobalDefaults({Debug:false});this.host=window.location.origin+'/';this.root=root;this.ajaxPath=ajaxPath;this.rootFiles=rootFiles;this.cacheBuster=cacheBuster;app.locale=app.strings.locale;this.p=new Polyglot({locale:app.strings.locale,phrases:app.strings});$(rootElementSelector).siblings('script[type="text/template"]').each(function(){app.templates[$(this).data('id')]=_.template(this.innerHTML);});app.router=new app.Router();app.controllers.skeleton.initialize();app.controllers.skeleton.createView(rootElementSelector);Backbone.history.start({pushState:true,root:this.root});}};})(window.jQuery);;
(function(){"use strict";app.utils={updateActiveMenuLink:function($,activeMenuSuffix){var $submenu=$("#block-eige-main-menu-level-2 ul.menu");$submenu.find("li").removeClass("active").removeClass("menu-item--active-trail");$submenu.find("li a").removeClass("is-active");if($submenu.find("li.menu-item--"+activeMenuSuffix).length){$submenu.find("li.menu-item--"+activeMenuSuffix).addClass("menu-item--active-trail");$submenu.find("li.menu-item--"+activeMenuSuffix+" a").addClass("is-active");}},polarToCartesian:function(centerX,centerY,radius,angleInDegrees){var angleInRadians=(angleInDegrees-90)*Math.PI/180.0;return {x:centerX+(radius*Math.cos(angleInRadians)),y:centerY+(radius*Math.sin(angleInRadians))};},describeSvgArc:function(x,y,radius,startAngle,endAngle){var start=this.polarToCartesian(x,y,radius,endAngle),end=this.polarToCartesian(x,y,radius,startAngle),arcSweep=endAngle-startAngle<=180?"0":"1";return ["M",start.x,start.y,"A",radius,radius,0,arcSweep,0,end.x,end.y].join(" ");},easeOutQuad:function(inElapsed,inTotal,outStart,outEnd){return -outEnd*(inElapsed/=inTotal)*(inElapsed-2)+outStart;},easeInQuad:function(t,d,b,c){return c*(t/=d)*t+b;},easeOutQuart:function(t,d,b,c){t/=d;t--;return -c*(t*t*t*t-1)+b;},easeOutExpo:function(t,d,b,c){return c*(-Math.pow(2,-10*t/d)+1)+b;},sanitize:function(text){if(typeof text!=='string')return '';return text.toLowerCase().replace(/ /g,'-').replace(/[^a-z0-9\-_]/g,'');},sanitizeForUrlParam:function(text){return text.trim().toLowerCase().replace(/[^a-z0-9]/g,"_");},truncateText:function(text,length,abbreviationText){text=text||'';length=length||0;abbreviationText=abbreviationText||'...';return text.length>length?text.substr(0,length)+abbreviationText:text;},cartesianProductOf:function(arrays){return _.reduce(arrays,function(a,b){return _.flatten(_.map(a,function(x){return _.map(b,function(y){return x.concat([y]);});}),true);},[[]]);},decimalPlaces:function(num){var match=(''+num).match(/(?:\.(\d+))?(?:[eE]([+-]?\d+))?$/);if(!match)return 0;return Math.max(0,(match[1]?match[1].length:0)-(match[2]?+match[2]:0));},getNiceStepsBetween:function(minValue,maxValue,approximateAmount){var roundedSteps=[50000000,20000000,10000000,5000000,2000000,1000000,500000,200000,100000,50000,20000,10000,5000,2000,1000,750,500,250,200,100,75,50,25,20,10,5,2,1,0.5,0.2,0.1,0.05,0.025,0.01,0.001,0.0001],range=maxValue-minValue,step=range/approximateAmount,roundedStep=_.reduce(roundedSteps,function(prev,curr){return Math.abs(prev-step)<Math.abs(curr-step)?prev:curr;}),minStep=minValue-minValue%roundedStep,minStep=minStep<minValue?minStep+roundedStep:minStep,maxStep=maxValue-maxValue%roundedStep,maxStep=maxStep>maxValue?maxStep-roundedStep:maxStep,amount=(maxStep-minStep)/roundedStep,amount=Math.round(amount*1000)/1000,result=[];for(var i=0;i<=amount;i++){var value=minStep+i*roundedStep,roundedValue=value.toFixed(app.utils.decimalPlaces(roundedStep));result.push(roundedValue);}return result;},parseYear:function(yearCombo){if(yearCombo.match(/^[\d]{4}$/))return parseInt(yearCombo);var match=yearCombo.match(/^([\d]{4})-(.*)$/);var year=parseInt(match[1]);if(match.length<3)return year;var fraction=match[2];if(fraction.match(/^(:?0[1-9]|1[0-2])$/))return year+(parseInt(fraction)-1)/12;if(fraction.match(/^Q[1-4]$/))return year+(parseInt(fraction.substr(1))-1)/4;if(fraction.match(/^B[1-2]$/))return year+(parseInt(fraction.substr(1))-1)/2;if(fraction.match(/^([\d]{4})$/))return year;return year;},generateYearLabelSeries:function(fromYear,toYear,format){var yearLabelSeries=({'P1M':'01,02,03,04,05,06,07,08,09,10,11,12'.split(','),'P3M':'Q1,Q2,Q3,Q4'.split(','),'P6M':'B1,B2'.split(',')})[format],result=[];for(var year=fromYear;year<=toYear;year++)if(yearLabelSeries)for(var i=0;i<yearLabelSeries.length;i++)result.push({label:year.toString()+'-'+yearLabelSeries[i],start:i==0});else result.push({label:year.toString(),start:true});return result;},applyContentInteractions:function($content){if(typeof window.Drupal.behaviors==='undefined')return;window.Drupal.behaviors.applyExpandableContent.attach($content);window.Drupal.behaviors.applyTableWrappers.attach($content);}};})();(function(window,rAF,cAF){var lastTime=0,vendors=['ms','moz','webkit','o'],x;for(x=0;x<vendors.length&&!window[rAF];++x){window[rAF]=window[vendors[x]+'RequestAnimationFrame'];window[cAF]=window[vendors[x]+'CancelAnimationFrame']||window[vendors[x]+'CancelRequestAnimationFrame'];}if(!window[rAF])window[rAF]=function(callback){var currTime=new Date().getTime(),timeToCall=Math.max(0,16-(currTime-lastTime)),id=window.setTimeout(function(){callback(currTime+timeToCall);},timeToCall);lastTime=currTime+timeToCall;return id;};if(!window[cAF])window[cAF]=function(id){window.clearTimeout(id);};}(this,'requestAnimationFrame','cancelAnimationFrame'));var dateFormat=function(){var token=/d{1,4}|m{1,4}|yy(?:yy)?|([HhMsTt])\1?|[LloSZ]|"[^"]*"|'[^']*'/g,timezone=/\b(?:[PMCEA][SDP]T|(?:Pacific|Mountain|Central|Eastern|Atlantic) (?:Standard|Daylight|Prevailing) Time|(?:GMT|UTC)(?:[-+]\d{4})?)\b/g,timezoneClip=/[^-+\dA-Z]/g,pad=function(val,len){val=String(val);len=len||2;while(val.length<len)val="0"+val;return val;};return function(date,mask,utc){var dF=dateFormat;if(arguments.length==1&&Object.prototype.toString.call(date)=="[object String]"&&!/\d/.test(date)){mask=date;date=undefined;}date=date?new Date(date):new Date();if(isNaN(date))throw SyntaxError("invalid date");mask=String(dF.masks[mask]||mask||dF.masks["default"]);if(mask.slice(0,4)=="UTC:"){mask=mask.slice(4);utc=true;}var _=utc?"getUTC":"get",d=date[_+"Date"](),D=date[_+"Day"](),m=date[_+"Month"](),y=date[_+"FullYear"](),H=date[_+"Hours"](),M=date[_+"Minutes"](),s=date[_+"Seconds"](),L=date[_+"Milliseconds"](),o=utc?0:date.getTimezoneOffset(),flags={d,dd:pad(d),ddd:dF.i18n.dayNames[D],dddd:dF.i18n.dayNames[D+7],m:m+1,mm:pad(m+1),mmm:dF.i18n.monthNames[m],mmmm:dF.i18n.monthNames[m+12],yy:String(y).slice(2),yyyy:y,h:H%12||12,hh:pad(H%12||12),H,HH:pad(H),M,MM:pad(M),s,ss:pad(s),l:pad(L,3),L:pad(L>99?Math.round(L/10):L),t:H<12?"a":"p",tt:H<12?"am":"pm",T:H<12?"A":"P",TT:H<12?"AM":"PM",Z:utc?"UTC":(String(date).match(timezone)||[""]).pop().replace(timezoneClip,""),o:(o>0?"-":"+")+pad(Math.floor(Math.abs(o)/60)*100+Math.abs(o)%60,4),S:["th","st","nd","rd"][d%10>3?0:(d%100-d%10!=10)*d%10]};return mask.replace(token,function($0){return $0 in flags?flags[$0]:$0.slice(1,$0.length-1);});};}();dateFormat.masks={"default":"ddd mmm dd yyyy HH:MM:ss",shortDate:"m/d/yy",mediumDate:"mmm d, yyyy",longDate:"mmmm d, yyyy",fullDate:"dddd, mmmm d, yyyy",shortTime:"h:MM TT",mediumTime:"h:MM:ss TT",longTime:"h:MM:ss TT Z",isoDate:"yyyy-mm-dd",isoTime:"HH:MM:ss",isoDateTime:"yyyy-mm-dd'T'HH:MM:ss",isoUtcDateTime:"UTC:yyyy-mm-dd'T'HH:MM:ss'Z'"};dateFormat.i18n={dayNames:["Sun","Mon","Tue","Wed","Thu","Fri","Sat","Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],monthNames:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec","January","February","March","April","May","June","July","August","September","October","November","December"]};Date.prototype.format=function(mask,utc){return dateFormat(this,mask,utc);};Object.defineProperty(SVGElement.prototype,'outerHTML',{get:function(){var $node,$temp;$temp=document.createElement('div');$node=this.cloneNode(true);$temp.appendChild($node);return $temp.innerHTML;},enumerable:false,configurable:true});Backbone.$.fn.select2.amd.define('select2/selectAllAdapter',['select2/utils','select2/dropdown','select2/dropdown/attachBody'],function(Utils,Dropdown,AttachBody){function SelectAll(){}SelectAll.prototype.render=function(decorated){var self=this,$rendered=decorated.call(this),$selectAll=Backbone.$('<button class="all" type="button">Select All</button>'),$unselectAll=Backbone.$('<button class="none" type="button">Deselect All</button>'),$btnContainer=Backbone.$('<div class="buttons">').append($selectAll).append($unselectAll);if(!this.$element.prop("multiple"))return $rendered;$rendered.find('.select2-dropdown').prepend($btnContainer);$selectAll.on('click',function(e){var $results=$rendered.find('.select2-results__option[aria-selected=false]');$results.each(function(){self.trigger('select',{data:Backbone.$(this).data('data')});});self.trigger('close');});$unselectAll.on('click',function(e){var $results=$rendered.find('.select2-results__option[aria-selected=true]');$results.each(function(){self.trigger('unselect',{data:Backbone.$(this).data('data')});});self.trigger('close');});return $rendered;};return Utils.Decorate(Utils.Decorate(Dropdown,AttachBody),SelectAll);});;
(function(){"use strict";app.Router=Backbone.Router.extend({routes:{'':'index','about':'about','*catchall':'index'},initialize:function(){this.route(/^indicator\/([a-z0-9_]+)(\?.*)?$/,'indicator');this.route(/^indicator\/([a-z0-9_]+)\/(map|bar|hbar|line|breakdown)(\?.*)?$/,'indicator');this.route(/^indicator\/([a-z0-9_]+)\/(map|bar|hbar|line|breakdown)()([a-zA-Z0-9_\-,:\/]+)(\?.*)?$/,'indicator');this.route(/^indicator\/([a-z0-9_]+)\/(map|bar|hbar|line|breakdown)\/(chart|table|metadata)(\?.*)?$/,'indicator');this.route(/^indicator\/([a-z0-9_]+)\/(map|bar|hbar|line|breakdown)\/(chart|table|metadata)([a-zA-Z0-9_\-,:\/]+)(\?.*)?$/,'indicator');this.route(/^indicator\/([a-z0-9_]+)\/(datatable)$/,'indicator');this.route(/^indicator\/([a-z0-9_]+)\/(datatable)()(\?.*)?$/,'indicator');this.route(/^indicator\/([a-z0-9_]+)\/(metadata)$/,'indicator');this.route(/^indicator\/([a-z0-9_]+)\/(datatable)\/(table|metadata)$/,'indicator');this.route(/^browse\/?$/,'browse');this.route(/^browse\/([a-z0-9_\/]+)$/,'theme');this.route(/^search$/,'search');this.route(/^search\/(.*)$/,'search');},getUrl:function(elements){return _.compact(elements).join('/');},index:function(){app.controllers.skeleton.renderSubView(app.controllers.indexPage.createView());},about:function(){app.controllers.skeleton.renderSubView(app.controllers.aboutPage.createView());},search:function(params){app.controllers.skeleton.renderSubView(app.controllers.searchPage.createView(params));},browse:function(){app.controllers.skeleton.renderSubView(app.controllers.browsePage.createView());},theme:function(themePath){app.controllers.skeleton.renderSubView(app.controllers.themePage.createView(themePath));},indicator:function(id,chartType,dataDisplay,params){app.controllers.skeleton.renderSubView(app.controllers.indicatorPage.createView(id,chartType,dataDisplay,params));}});})();;
(function(){"use strict";app.models.Criteria=Backbone.Model.extend({idAttribute:'code',defaults:{code:'',name:'',helpText:'',categories:[],hidden:false,mandatory:true,sort:null,sentToBackend:true,sentToBackendInCaseOfAllSelected:true},getSortedCategories:function(){return this.get('sort')?_.clone(this.get('categories')).sort(this.get('sort')):_.clone(this.get('categories'));},getCategoryName:function(code){return this.hasCategoryCode(code)?_.findWhere(this.get('categories'),{code}).name:undefined;},selectByIndex:function(index){if(this.get('categories')&&this.get('categories').length){var sortedCategories=this.getSortedCategories();if(sortedCategories[index]&&sortedCategories[index].code){this.select(sortedCategories[index].code);return this;}}this.select(null);return this;},selectFirst:function(){return this.selectByIndex(0);},hasCategoryCode:function(optionCode){return _.contains(_.pluck(this.get('categories'),'code'),optionCode);},toggle:function(optionCode){this.select(optionCode,!this.isSelected(optionCode));return this;},selectLast:function(){if(this.get('categories')&&this.get('categories').length&&this.get('categories')[this.get('categories').length-1].code)this.select(this.get('categories')[this.get('categories').length-1].code);return this;},setHidden:function(hidden){this.set('hidden',hidden);return this;},isHidden:function(){return this.get('hidden');},isMandatory:function(){return this.get('mandatory');},getShortNameForSelection:function(selected,length){var category=_.findWhere(this.get('categories'),{code:selected});if(category===null)return null;return category.name.length<length?category.name:selected;}});})();;
(function(){"use strict";app.models.CriteriaMultiSelect=app.models.Criteria.extend({isMulti:true,isRange:false,clone:function(){return new app.models.CriteriaMultiSelect(Backbone.$.extend(true,{},this.attributes));},getSelected:function(){return this.get('selectedOptionCodes')||[];},select:function(selectedOptionCode,enable){enable=enable===false?false:true;var selectedOptionCodes=this.getSelected();if(!enable&&selectedOptionCodes.length===1&&this.isMandatory())return this;if(!_.contains(_.pluck(this.get('categories'),'code'),selectedOptionCode))return this;if(enable&&!_.contains(selectedOptionCodes,selectedOptionCode)){if(this.get('maxSelected')&&this.get('maxSelected')===selectedOptionCodes.length)return this;selectedOptionCodes.push(selectedOptionCode);this.set('selectedOptionCodes',selectedOptionCodes);return this;}if(!enable&&_.contains(selectedOptionCodes,selectedOptionCode)){this.set('selectedOptionCodes',_.without(selectedOptionCodes,selectedOptionCode));return this;}return this;},selectFromUrl:function(selectedOptionCodesString){this.selectNone();var that=this;_.each(selectedOptionCodesString.split(','),function(selectedOptionCode){that.select(selectedOptionCode);});if(this.isMandatory()&&this.getSelected().length===0)this.selectFirst();return this;},selectAll:function(){this.set('selectedOptionCodes',_.pluck(this.get('categories'),'code'));return this;},selectNone:function(){this.set('selectedOptionCodes',[]);return this;},selectAllValidated:function(){var categories=this.getSortedCategories();for(var i=0;i<categories.length;i++)this.select(categories[i].code,true);},selectNoneValidated:function(){this.selectAll();var categories=this.getSortedCategories();for(var i=categories.length-1;i>=0;i--)this.select(categories[i].code,false);},isSelected:function(optionCode){return _.contains(this.get('selectedOptionCodes'),optionCode);},isAllSelected:function(){if(!this.get('selectedOptionCodes'))return false;return this.get('selectedOptionCodes').length===this.get('categories').length;},getUrl:function(){return this.get('code')+':'+this.getSelected().join(',');},getUrlForBackend:function(){if(!this.get('sentToBackend'))return null;if(!this.get('sentToBackendInCaseOfAllSelected')&&this.isAllSelected())return null;return this.getUrl();},getDescription:function(){if(this.isHidden())return null;var selected=this.getSelected();if(selected.length===0)return null;if(this.isAllSelected())return app.p.has('Criteria.'+this.id+'.all')?app.p.t('Criteria.'+this.id+'.all'):app.p.t('Criteria._.all',{code:this.id.toUpperCase()});if(selected.length<3)return _.map(selected,function(selected){return this.getShortNameForSelection(selected,12);},this).join(', ');return app.p.has('Criteria.'+this.id+'.some')?app.p.t('Criteria.'+this.id+'.some',{count:selected.length}):app.p.t('Criteria._.some',{count:selected.length,code:this.id.toUpperCase()});},displaysHelperButtons:function(){var categoriesThreshold=5;if(!this.get('maxSelected')&&this.get('categories').length>=categoriesThreshold)return true;if(this.get('maxSelected')&&this.get('maxSelected')>=categoriesThreshold&&this.get('categories').length>=categoriesThreshold)return true;return false;}});})();;
(function(){"use strict";app.models.CriteriaMultiSelectRange=app.models.CriteriaMultiSelect.extend({isRange:true,initialize:function(){this.set({"sort":function(a,b){return a.code<b.code?1:a.code>b.code?-1:0;}},{silent:true});},clone:function(){return new app.models.CriteriaMultiSelectRange(Backbone.$.extend(true,{},this.attributes));},getSortedCategoriesReversed:function(){return this.getSortedCategories().reverse();},getSortedSelectedOptions:function(){return _.clone(this.getSelected()).sort(function(a,b){return a<b?1:a>b?-1:0;});},getMinSelectedOption:function(){if(this.getSelected().length===0)return null;return _.last(this.getSortedSelectedOptions());},getMaxSelectedOption:function(){if(this.getSelected().length===0)return null;return _.first(this.getSortedSelectedOptions());},isRangeValid:function(min,max){if(!min||!max)return false;if(!this.hasCategoryCode(min)||!this.hasCategoryCode(max))return false;return min<=max;},getOptionCodesInRange:function(min,max){if(!this.isRangeValid(min,max))return [];var codes=[];var categories=this.getSortedCategoriesReversed();for(var i=0;i<categories.length;i++){var category=categories[i].code;if(category>=min&&category<=max)codes.push(category);}return codes;},selectSome:function(selectedOptionCodes){this.selectNone();var that=this;_.each(selectedOptionCodes,function(optionCode){that.select(optionCode);});if(this.isMandatory()&&this.getSelected().length===0)this.selectFirst();return this;},selectInRange:function(min,max){return this.selectSome(this.getOptionCodesInRange(min,max));},displaysHelperButtons:function(){return false;}});})();;
(function(){"use strict";app.models.CriteriaSingleSelect=app.models.Criteria.extend({clone:function(){return new app.models.CriteriaSingleSelect(Backbone.$.extend(true,{},this.attributes));},getSelected:function(){return this.get('selectedOptionCode');},getSelectedIndex:function(){var selected=this.getSelected(),categoryCodes=_.pluck(this.get('categories'),'code');return categoryCodes.indexOf(selected);},select:function(selectedOptionCode,enable){enable=enable===false?false:true;if(!enable&&this.isMandatory())return this;if(_.contains(_.pluck(this.get('categories'),'code'),selectedOptionCode)){if(enable&&this.get('selectedOptionCode')!==selectedOptionCode)this.set('selectedOptionCode',selectedOptionCode);if(!enable&&this.get('selectedOptionCode')===selectedOptionCode)this.set('selectedOptionCode',null);}if(selectedOptionCode===''||selectedOptionCode===null)this.set('selectedOptionCode',null);return this;},selectFromUrl:function(selectedOptionCodeString){this.select(selectedOptionCodeString);if(this.isMandatory()&&this.getSelected()===null)this.selectFirst();return this;},isSelected:function(optionCode){return this.get('selectedOptionCode')===optionCode;},getUrl:function(){var selected=this.getSelected();return this.get('code')+':'+(selected===null||selected===undefined?'':selected);},getUrlForBackend:function(){if(!this.get('sentToBackend'))return null;return this.getUrl();},getSelectedCategoryName:function(){var selected=_.findWhere(this.get('categories'),{code:this.getSelected()});return selected?selected.name:null;},getDescription:function(){if(this.isHidden())return null;return this.getShortNameForSelection(this.getSelected(),12);}});})();;
(function(){"use strict";app.models.Featured=Backbone.Model.extend({id:'',name:'',featured:false,featuredImage:'',getId:function(){return this.get('id');},getName:function(){return this.get('name');},getFeatured:function(){return this.get('featured');},getFeaturedImage:function(){return this.get('featured_image');}});})();;
(function(){"use strict";app.models.Filter=Backbone.Model.extend({idAttribute:'key',defaults:{key:'',label:''}});})();;
(function(){"use strict";app.models.FilterOption=Backbone.Model.extend({idAttribute:"_id",defaults:{name:'',translationPrefix:'',selected:false},initialize:function(){if(!this.get(this.idAttribute)){this.id=this.getKey();this.set(this.idAttribute,this.id);}},isSelected:function(){return this.get("selected");},select:function(){this.set("selected",true);},deselect:function(){this.set("selected",false);},getKey:function(){if(this.id)return this.id;return app.utils.sanitizeForUrlParam(this.get("name"));}});})();;
(function(){"use strict";app.models.FlagValue=Backbone.Model.extend({idAttribute:'_id'});})();;
(function(){"use strict";app.models.MultipleSelectFilter=app.models.Filter.extend({isSelect:true,urlMultipleValuesSeparator:',',defaults:{filterOptions:null,sendLabelsToBackend:false},initialize:function(attributes){if(attributes.data)this.set("filterOptions",new app.collections.FilterOptions(attributes.data));},select:function(keys){this.get("filterOptions").select(keys);},deselect:function(keys){this.get("filterOptions").deselect(keys);},clear:function(){this.get("filterOptions").deselectAll();return this;},getUrl:function(keyValueSeparator){if(!this.get("key")||!this.get("filterOptions")||!this.isActive())return '';return this.get("key")+keyValueSeparator+this.get("filterOptions").getSelectedKeys().join(this.urlMultipleValuesSeparator);},getBackendUrl:function(keyValueSeparator){if(!this.get("key")||!this.get("filterOptions")||!this.get("filterOptions").isAnySelected()||this.get("filterOptions").isAllSelected())return '';var values=this.get("filterOptions").getSelectedKeys();if(this.get("sendLabelsToBackend"))values=_.map(this.get("filterOptions").getSelectedLabels(),function(label){return label.replace(/,/g,",,").replace(/\//g,"//");});return this.get("key")+keyValueSeparator+values.join(this.urlMultipleValuesSeparator);},populateFromUrl:function(value){this.clear();if(value&&typeof value==='string'){var keys=value.split(this.urlMultipleValuesSeparator);if(keys)this.select(keys);}return this;},isActive:function(){return this.get("filterOptions").isAnySelected();},getActiveValue:function(){if(!this.get("filterOptions")||!this.isActive())return '';return this.get("filterOptions").getSelectedLabels().join(", ");},getSelectedLabels:function(){if(!this.get("filterOptions")||!this.isActive())return [];return this.get("filterOptions").getSelectedLabels();},getSelectedOptionsCount:function(){if(!this.get("filterOptions")||!this.isActive())return 0;return this.get("filterOptions").getSelectedKeys().length;}});})();;
(function(){"use strict";app.models.Pager=Backbone.Model.extend({idAttribute:'key',_totalPages:0,_offset:0,_limit:0,_prevActive:false,_nextActive:false,defaults:{key:'',pagesDisplayed:9,step:12,totalItems:0,currentPage:0},initialize:function(attributes){if(!attributes||!attributes.step||attributes.step<=0)this.set("step",12);if(!attributes||!attributes.pagesDisplayed||attributes.pagesDisplayed<=0)this.set("pagesDisplayed",9);this._totalPages=Math.ceil(this.get("totalItems")/this.get("step"));this.calculateCurrentPage(this.get("currentPage"));this.calculatePagerLimits();},calculateCurrentPage:function(page){if(!page||!parseInt(page)||page<0)this.set("currentPage",0);else if(page>=this._totalPages)this.set("currentPage",this._totalPages-1);else this.set("currentPage",page);},updateCurrentPage:function(page){this.calculateCurrentPage(page);this.calculatePagerLimits();},calculatePagerLimits:function(){this._prevActive=this.get("currentPage")>0;this._nextActive=this.get("currentPage")<(this._totalPages-1);this._offset=this.get("step")*this.get("currentPage");this._limit=(this._offset+this.get("step"))>this.get("totalItems")?(this.get("totalItems")-this._offset):this.get("step");},getTotalItems:function(){return this.get("totalItems");},getCurrentPage:function(){return this.get("currentPage");},getStep:function(){return this.get("step");},getTotalPages:function(){return this._totalPages;},isPrevActive:function(){return this._prevActive;},isNextActive:function(){return this._nextActive;},getOffset:function(){return this._offset;},getLimit:function(){return this._limit;},getFirstPage:function(){return 0;},getLastPage:function(){return this._totalPages-1;},getFirstItemIndex:function(){return this._offset+1;},getLastItemIndex:function(){return this._offset+this._limit;},getUrl:function(page,urlParams){if(!page||typeof page!=='number')return urlParams?urlParams:'';if(page<=0)return urlParams?urlParams:'';if(page>this.getLastPage())page=this.getLastPage();var pageParam=this.get("key")+":"+page;if(urlParams)return urlParams+"/"+pageParam;return pageParam;},isEmpty:function(){return this.get("totalItems")<1;},hasMorePagesToDisplay:function(){return this._totalPages>(this.getPages().pop()+1);},getPages:function(){var start=this.getFirstPage();var end=this.getLastPage();if(this._totalPages>this.get("pagesDisplayed")){start=this.get("currentPage")-Math.ceil(this.get("pagesDisplayed")/2);if(start<0)start=0;end=start+this.get("pagesDisplayed")-1;if(end>this.getLastPage()){start=start-(end-this.getLastPage());end=this.getLastPage();}}var pages=[];for(var i=start;i<=end;i++)pages.push(i);return pages;}});})();;
(function(){"use strict";app.models.Region=Backbone.Model.extend({idAttribute:'_id',_eu28codes:'BE,BG,CZ,DK,DE,EE,IE,EL,ES,FR,HR,IT,CY,LV,LT,LU,HU,MT,NL,AT,PL,PT,RO,SI,SK,FI,SE,UK'.split(','),_eu27codes:'BE,BG,CZ,DK,DE,EE,IE,EL,ES,FR,HR,IT,CY,LV,LT,LU,HU,MT,NL,AT,PL,PT,RO,SI,SK,FI,SE'.split(','),isEu28:function(){return _.contains(this._eu28codes,this.id);},isEu27:function(){return _.contains(this._eu27codes,this.id);},getFilterName:function(){return this.id+' - '+this.get('name');}});})();;
(function(){"use strict";app.models.Setting=Backbone.Model.extend({defaults:{enabled:false},enable:function(){this.set('enabled',true);return this;},disable:function(){this.set('enabled',false);return this;},isEnabled:function(){return this.getOverriddenState()===null?this.get('enabled'):this.getOverriddenState();},getOverriddenState:function(){return window.location.search.match(new RegExp(this.id+'=true'))?true:window.location.search.match(new RegExp(this.id+'=false'))?false:null;},toggle:function(){this.set('enabled',!this.isEnabled());return this;}});})();;
(function(){"use strict";app.models.TextFilter=app.models.Filter.extend({defaults:{summaryLabel:'',value:'',placeholder:'',helpMessage:'',charsLimit:0},setValue:function(value){if(!value||typeof value!=='string')this.set('value','');else{value=value.replace(/\\/g,"").replace(/\//g,"").trim();if(this.get("charsLimit")>0&&value.length>this.get("charsLimit"))value=value.substr(0,this.get("charsLimit"));this.set('value',value);}return this;},clear:function(){this.set('value','');return this;},getUrl:function(keyValueSeparator,rawValue){if(!this.get('key')||!this.get("value"))return '';return this.get('key')+keyValueSeparator+(rawValue?this.get("value"):encodeURIComponent(this.get("value")));},getBackendUrl:function(keyValueSeparator){return this.getUrl(keyValueSeparator,true);},populateFromUrl:function(value){this.clear();this.setValue(value);return this;},isActive:function(){return this.get("value");},getActiveValue:function(){return this.get("value");}});})();;
(function(){"use strict";app.collections.Criterias=Backbone.Collection.extend({model:app.models.Criteria,clone:function(predicate){return new app.collections.Criterias(_.map(this.filter(predicate),function(criteria){return criteria.clone();}));},getCaseInsensitive:function(key){return this.find(function(model){return model.get('code').toLowerCase()===key.toLowerCase();});},getUrlForBackend:function(){return _.compact(this.invoke('getUrlForBackend')).join('/');},getUrlForUI:function(){return _.compact(this.invoke('getUrl')).join('/');},setStateFromUrl:function(params){var params=params.split('/');for(var i=0;i<params.length;i++){var param=params[i].split(':');if(param.length!==2)continue;var key=param[0],value=param[1];var criteria=this.get(key);if(!criteria)continue;criteria.selectFromUrl(value);}return this;},getDescription:function(){return _.compact(this.invoke('getDescription')).join('; ');}});})();;
(function(){"use strict";app.collections.Featured=Backbone.Collection.extend({model:app.models.Featured,getFeatured:function(){var allFeatured=[];this.each(function(featured){var id=featured.getId();var name=featured.getName();var isFeatured=featured.getFeatured();var img=featured.getFeaturedImage();if(id&&name&&isFeatured)allFeatured.push({id,name,img});});if(!allFeatured.length)return false;return allFeatured;}});})();;
(function(){"use strict";app.collections.FilterOptions=Backbone.Collection.extend({model:app.models.FilterOption,comparator:function(aNode,anotherNode){if(aNode.has("display_order")&&anotherNode.has("display_order"))return aNode.get("display_order")<anotherNode.get("display_order")?-1:aNode.get("display_order")>anotherNode.get("display_order")?1:0;return aNode.get("name").toUpperCase()<anotherNode.get("name").toUpperCase()?-1:aNode.get("name").toUpperCase()>anotherNode.get("name").toUpperCase()?1:0;},getSelected:function(){return this.where({selected:true});},isAnySelected:function(){return this.getSelected().length>0;},isAllSelected:function(){return this.getSelected().length===this.models.length;},getSelectedKeys:function(){return _.pluck(this.getSelected(),'id');},getSelectedLabels:function(){return _.map(this.getSelected(),function(model){return model.get("name");});},select:function(keys){if(!keys)return;if(typeof keys==='string')keys=[keys];keys=_.compact(keys);_.invoke(this.filter(function(model){return _.contains(keys,model.id);}),'select');},deselect:function(keys){if(!keys)return;if(typeof keys==='string')keys=[keys];keys=_.compact(keys);_.invoke(this.filter(function(model){return _.contains(keys,model.id);}),'deselect');},deselectAll:function(){this.invoke('deselect');}});})();;
(function(){"use strict";app.collections.Filters=Backbone.Collection.extend({model:app.models.Filter,urlFiltersSeparator:'/',urlFilterKeyValueSeparator:':',initialize:function(models,options){if(options&&options.urlFilterKeyValueSeparator)this.urlFilterKeyValueSeparator=options.urlFilterKeyValueSeparator;},getUrl:function(){return _.compact(this.invoke('getUrl',this.urlFilterKeyValueSeparator)).join(this.urlFiltersSeparator);},getBackendUrl:function(){return _.compact(this.invoke('getBackendUrl',this.urlFilterKeyValueSeparator)).join(this.urlFiltersSeparator);},clearAll:function(){this.invoke('clear');},clearAndpopulateFromUrl:function(filtersString){this.clearAll();if(!filtersString)return this;if(filtersString.lastIndexOf(this.urlFiltersSeparator)===filtersString.length-1)filtersString=filtersString.slice(0,filtersString.length-1);var params=filtersString.split(this.urlFiltersSeparator);params=_.compact(params);for(var i=0;i<params.length;i++){var keyValuePair=params[i];var keyValueSeparatorIndex=keyValuePair.indexOf(this.urlFilterKeyValueSeparator);if(keyValueSeparatorIndex<=0)continue;var key=keyValuePair.slice(0,keyValueSeparatorIndex);var filter=this.get(key);if(!filter)continue;filter.populateFromUrl(keyValuePair.slice(keyValueSeparatorIndex+1));}return this;},isAnyActive:function(){var active=false;this.each(function(filter){if(filter.isActive())active=true;});return active;}});})();;
(function(){"use strict";app.collections.FlagValues=Backbone.Collection.extend({model:app.models.FlagValue});})();;
(function(){"use strict";app.collections.Regions=Backbone.Collection.extend({model:app.models.Region});})();;
(function(){"use strict";app.collections.Settings=Backbone.Collection.extend({model:app.models.Setting,toggle:function(settingId){var setting=this.get(setting);if(!setting)setting=this.add(new app.models.Setting({id:settingId}));setting.toggle();this.trigger('change:'+settingId);if(this.localStorage)setting.save();return this;},isEnabled:function(settingId){var setting=this.get(settingId);return !setting?false:setting.isEnabled();}});})();;
(function(){"use strict";app.controllers.aboutPage={initialize:function(){},createView:function(){this.view=new app.views.AboutPage({controller:this});this.fetchDataAndRenderContent();Backbone.trigger('title',app.p.t('AboutPage.title'));return this.view;},fetchDataAndRenderContent:function(){var that=this;that.view.appendSpinner();if(that.contentRequest&&that.contentRequest.abort)that.contentRequest.abort();that.contentRequest=Backbone.$.ajax({url:app.root+'/json/page'+app.root+'/about-content'});Backbone.$.when(that.contentRequest).done(function(content){delete that.contentRequest;that.view.removeSpinner();that.view.renderContent(content);}).fail(function(e){that.view.removeSpinner();if(e.status===200)return;if(e.status===0)return;Backbone.trigger('error',e);});}};})();;
(function(){"use strict";app.controllers.browsePage={initialize:function(){},createView:function(){this.view=new app.views.BrowsePage({controller:this});this.calculateAndRenderTree();Backbone.trigger('title',app.p.t('BrowsePage.title_short'));return this.view;},calculateAndRenderTree:function(){this.view.renderTree(app.controllers.navigationTree.getRenderableNode());}};})();;
(function(){"use strict";app.controllers.error404Page={initialize:function(){},createView:function(){this.view=new app.views.Error404Page({controller:this});Backbone.trigger('title',app.p.t('Error404Page.title'));this.createAndRenderSearchFilter();return this.view;},createAndRenderSearchFilter:function(){this.textFilter=new app.models.TextFilter({key:app.controllers.searchPage.textSearchKey,charsLimit:app.controllers.searchPage.maxTextSearchCharsLimit,label:app.p.t('Error404Page.search.label'),placeholder:app.p.t('Error404Page.search.placeholder')});this.view.renderSearchInput(this.textFilter);},redirectToSearch:function(searchTerm){if(!searchTerm)return;this.textFilter.setValue(searchTerm);if(this.textFilter.isActive())app.router.navigate("search/"+encodeURIComponent(this.textFilter.getUrl(app.controllers.searchPage.urlFilterKeyValueSeparator)),{trigger:true});}};})();;
(function(){"use strict";app.controllers.indexPage={featuredBlockKey:'dgs_data_talks',publicationsViewConfig:'publications:publications_feed_block:285',tagsLimit:10,initialize:function(){},createView:function(){this.view=new app.views.IndexPage({controller:this});this.calculateAndRenderData();Backbone.trigger('title',app.p.t('IndexPage.title'));return this.view;},calculateAndRenderData:function(){this.view.renderTree(app.controllers.navigationTree.getRenderableNode());this.fetchAndRenderAboutContent();this.fetchAndRenderTagsContent();this.fetchAndRenderFeaturedBlock();this.fetchAndRenderPublicationsList();this.fetchAndRenderFeaturedIndicators(app.data.tree);},fetchAndRenderAboutContent:function(){var that=this;if(that.contentRequest&&that.contentRequest.abort)that.contentRequest.abort();that.contentRequest=Backbone.$.ajax({url:app.root+'/json/page'+app.root+'/about-content'});Backbone.$.when(that.contentRequest).done(function(content){delete that.contentRequest;that.view.renderAbout(content);}).fail(function(e){that.view.hideAboutSection();if(e.status===200)return;if(e.status===0)return;Backbone.trigger('error',e);});},fetchAndRenderTagsContent:function(){var that=this;if(that.tagsRequest&&that.tagsRequest.abort)that.tagsRequest.abort();that.tagsRequest=Backbone.$.ajax({url:app.getDbEndpoint('tag-keywords')});Backbone.$.when(that.tagsRequest).done(function(content){delete that.tagsRequest;that.view.renderTags(that.getTagsForDisplay(content));}).fail(function(e){that.view.hideTagsSection();if(e.status===200)return;if(e.status===0)return;Backbone.trigger('error',e);});},getTagsForDisplay:function(data){function addTagIfNotExists(tags,tag){var existingTag=_.findWhere(tags,{'name':tag._id});if(existingTag){if(existingTag.count<tag.data_set_view_count)existingTag.count=tag.data_set_view_count;}else tags.push({"name":tag._id,"valueForUrl":app.utils.sanitizeForUrlParam(tag._id),"count":tag.data_set_view_count});}if(data&&data.length){var tags=[];var mainKeywords=app.data.searchFilters.keywords;_.each(data,function(tag){var isMain=_.findWhere(mainKeywords,{'name':tag._id})?true:false;if(isMain)addTagIfNotExists(tags,tag);else{var mainKeyword;_.each(mainKeywords,function(keyword){if(_.indexOf(keyword.synonyms,tag._id)>-1)mainKeyword=keyword;if(!mainKeyword)if(_.indexOf(keyword.synonyms,tag._id.toLowerCase())>-1)mainKeyword=keyword;});if(mainKeyword)addTagIfNotExists(tags,{'_id':mainKeyword.name,'data_set_view_count':tag.data_set_view_count});}});tags=_.sortBy(tags,'count').reverse();return tags.slice(0,this.tagsLimit);}return false;},fetchAndRenderFeaturedBlock:function(){var that=this;that.view.appendSpinner();if(that.featuredBlockRequest&&that.featuredBlockRequest.abort)that.featuredBlockRequest.abort();that.featuredBlockRequest=Backbone.$.ajax({url:app.root+'/json/block/'+this.featuredBlockKey});Backbone.$.when(that.featuredBlockRequest).done(function(content){delete that.featuredBlockRequest;that.view.removeSpinner();that.view.renderFeaturedContent(content);}).fail(function(e){that.view.removeSpinner();if(e.status===200)return;if(e.status===0)return;Backbone.trigger('error',e);});},fetchAndRenderPublicationsList:function(){var that=this;if(that.publicationsBlockRequest&&that.publicationsBlockRequest.abort)that.publicationsBlockRequest.abort();that.publicationsBlockRequest=Backbone.$.ajax({url:app.root+'/json/view/'+this.publicationsViewConfig});Backbone.$.when(that.publicationsBlockRequest).done(function(content){delete that.publicationsBlockRequest;that.view.renderPublicationsList(content);}).fail(function(e){that.view.hidePublicationsSection();if(e.status===200)return;if(e.status===0)return;Backbone.trigger('error',e);});},fetchAndRenderFeaturedIndicators:function(data){this.featured=new app.collections.Featured([]);this.findFeaturedIndicators(data);this.view.renderFeaturedIndicators(this.featured);},findFeaturedIndicators:function(data){for(var key in data)if(typeof (data[key])==='object')this.findFeaturedIndicators(data[key]);else{if(key==='featured'&&data[key])this.featured.add(new app.models.Featured({id:data.id,name:data.name,featured:data.featured,featured_image:data.featured_image}));}}};})();;
(function(){"use strict";app.controllers.indicatorBarChart={createYearCriteria:function(years){return new app.models.CriteriaSingleSelect({code:'year',name:app.p.t('Criteria.year.label'),categories:_.map(years,function(year){return {code:String(year),name:year};}),sort:function(a,b){return a.code<b.code?1:a.code>b.code?-1:0;},sentToBackend:false}).selectLast();},createRegionCriteria:function(regionCodes){var orderedRegionsSubset=new Backbone.Collection(app.collections.regions.filter(function(region){return _.contains(regionCodes,region.id);}));return new app.models.CriteriaMultiSelect({code:'geo',name:app.p.t('Criteria.geo.labelMulti'),categories:orderedRegionsSubset.map(function(region){return {code:region.id,name:region.get('name'),filterName:region.getFilterName()};}),sentToBackendInCaseOfAllSelected:false}).selectAll();},createCriteria:function(data){if('sex'===data.code)return new app.models.CriteriaMultiSelect(data).selectFirst();return new app.models.CriteriaSingleSelect(data).selectFirst();},needsEuAverages:function(settings){return settings.isEnabled('euAverages');},finalizeFilter:function(filter){filter.each(function(criteria){if(criteria.isMulti)if(criteria.id==='sex')if(criteria.hasCategoryCode('M')&&criteria.hasCategoryCode('W'))criteria.selectNone().select('M').select('W');else criteria.selectAll();else criteria.selectByIndex(0).selectByIndex(1);});},shouldRenderNoData:function(data,filter){return data.length===0;},getTimelineCriteria:function(filter){return filter.get('year')&&filter.get('year').get('categories').length>1?filter.get('year'):null;},getCriteriaShortcut:function(filter){return filter.get('sex');},getDataTableYAxis:function(){return 'geo';},getPossibleTabs:function(){return ['chart','metadata'];},processData:function(data,filter){data=_.where(data,{year:filter.get('year').getSelected()});return _.sortBy(data,function(dataRow){return app.collections.regions.indexOf(app.collections.regions.get(dataRow.geo));});},getDataTableYAxisValues:function(processedData,filter,settings){return settings.isEnabled('eu27Only')?_.filter(filter.get('geo').getSelected(),function(geo){return app.collections.regions.get(geo).isEu27();}):filter.get('geo').getSelected();},createChart:function(data,settings){return new app.views.IndicatorBarChart(data);},createNoDataChart:function(){return new app.views.IndicatorNoData(1200,555);},getVisibleSettings:function(){return ['fixedYAxis','euAverages','eu27Only'];}};})();;
(function(){"use strict";app.controllers.indicatorBreakdownChart={createYearCriteria:function(years){return new app.models.CriteriaSingleSelect({code:'year',name:app.p.t('Criteria.year.label'),categories:_.map(years,function(year){return {code:String(year),name:year};}),sort:function(a,b){return a.code<b.code?1:a.code>b.code?-1:0;},sentToBackend:false}).selectLast();},createRegionCriteria:function(regionCodes){var orderedRegionsSubset=new Backbone.Collection(app.collections.regions.filter(function(region){return _.contains(regionCodes,region.id);}));return new app.models.CriteriaSingleSelect({code:'geo',name:app.p.t('Criteria.geo.label'),categories:orderedRegionsSubset.map(function(region){return {code:region.id,name:region.get('name'),filterName:region.getFilterName()};})}).selectFirst();},createCriteria:function(data){return new app.models.CriteriaMultiSelect(data).selectFirst();},needsEuAverages:function(settings){return false;},finalizeFilter:function(filter){var firstAllDone=false;filter.each(function(criteria){if(criteria.isMulti){criteria.set('maxSelected',6);if(criteria.id==='sex')if(criteria.hasCategoryCode('M')&&criteria.hasCategoryCode('W'))criteria.selectNone().select('M').select('W');else criteria.selectAll();else if(firstAllDone)criteria.selectByIndex(0).selectByIndex(1);else{firstAllDone=true;criteria.selectAllValidated();}}});var sexCriteria=filter.get('sex');if(!sexCriteria)return;filter.remove(sexCriteria,{silent:true});filter.add(sexCriteria,{at:2,silent:true});},shouldRenderNoData:function(data,filter){var dimensions=filter.filter(function(criteria){return !criteria.isHidden()&&criteria.isMulti&&criteria.getSelected().length>1;});return dimensions.length<2||data.length===0;},getTimelineCriteria:function(filter){return filter.get('year')&&filter.get('year').get('categories').length>1?filter.get('year'):null;},getCriteriaShortcut:function(filter){return null;},getDataTableYAxis:function(){return 'year';},getPossibleTabs:function(){return ['chart','metadata'];},processData:function(data,filter){data=_.where(data,{year:filter.get('year').getSelected()});return data;},getDataTableYAxisValues:function(processedData,filter,settings){return _.uniq(_.pluck(processedData,this.getDataTableYAxis()));},createChart:function(data,settings){return new app.views.IndicatorBreakdownChart(data);},createNoDataChart:function(){return new app.views.IndicatorNoData(960,600);},getVisibleSettings:function(){return [];}};})();;
(function(){"use strict";app.controllers.indicatorDataTable={getPossibleTabs:function(){return ['table','metadata'];}};})();;
(function(){"use strict";app.controllers.indicatorHorizontalBarChart={createYearCriteria:function(years){return new app.models.CriteriaSingleSelect({code:'year',name:app.p.t('Criteria.year.label'),categories:_.map(years,function(year){return {code:String(year),name:year};}),sort:function(a,b){return a.code<b.code?1:a.code>b.code?-1:0;},sentToBackend:false}).selectLast();},createRegionCriteria:function(regionCodes,yAxis){var orderedRegionsSubset=new Backbone.Collection(app.collections.regions.filter(function(region){return _.contains(regionCodes,region.id);}));if(regionCodes.length==1||yAxis!=='geo')return new app.models.CriteriaSingleSelect({code:'geo',name:app.p.t('Criteria.geo.labelMulti'),categories:orderedRegionsSubset.map(function(region){return {code:region.id,name:region.get('name'),filterName:region.getFilterName()};})}).selectFirst();else return new app.models.CriteriaMultiSelect({code:'geo',name:app.p.t('Criteria.geo.labelMulti'),categories:orderedRegionsSubset.map(function(region){return {code:region.id,name:region.get('name'),filterName:region.getFilterName()};}),sentToBackendInCaseOfAllSelected:false}).selectAll();},createCriteria:function(data,yAxis){if('sex'===data.code)return new app.models.CriteriaMultiSelect(data).selectFirst();if(yAxis===data.code)return new app.models.CriteriaMultiSelect(data).selectAll();return new app.models.CriteriaSingleSelect(data).selectFirst();},createGroupByCriteria:function(data){for(var index=0;index<data.categories.length;index++)data.categories[index]["filterName"]=data.categories[index].name;return new app.models.CriteriaMultiSelect(data).selectAll();},needsEuAverages:function(settings,isYAxisNonGeo){return settings.isEnabled('euAverages')&&!isYAxisNonGeo;},finalizeFilter:function(filter){filter.each(function(criteria){if(criteria.isMulti)if(criteria.id==='sex')if(criteria.hasCategoryCode('M')&&criteria.hasCategoryCode('W'))criteria.selectNone().select('M').select('W');else criteria.selectAll();else criteria.selectAll();});},shouldRenderNoData:function(data,filter){return data.length===0;},getTimelineCriteria:function(filter){return filter.get('year')&&filter.get('year').get('categories').length>1?filter.get('year'):null;},getCriteriaShortcut:function(filter){return filter.get('sex');},getDataTableDefaultXAxis:function(visualisations){for(var i=0;i<visualisations.length;i++)if(visualisations[i].x_axis_default)return visualisations[i].x_axis_default;return 'geo';},getDataTableYAxis:function(yAxis){if(yAxis&&yAxis!=='default')return yAxis;else return 'geo';},getPossibleTabs:function(){return ['chart','metadata'];},createChangeYAxisModel:function(filter,selectedOption){let allowedYAxisCriteria=[];filter.each(function(criteria){if(!_.contains(['year','sex','unit'],criteria.get('code'))&&!criteria.get('hidden'))allowedYAxisCriteria.push(criteria);});this.changeYAxisModel=new app.models.CriteriaSingleSelect({code:'yAxis',name:app.p.t('Criteria.changeYAxis.label'),categories:allowedYAxisCriteria.map(function(criteria){return {code:criteria.get('code'),name:criteria.get('name')};})});if(selectedOption)this.changeYAxisModel.select(selectedOption);else this.changeYAxisModel.selectFirst();},getChangeYAxisModel:function(){return this.changeYAxisModel;},processData:function(data,filter,yAxis){data=_.where(data,{year:filter.get('year').getSelected()});if(yAxis&&yAxis!='geo'){const yAxisSelected=filter.get(yAxis).getSelected();if(yAxisSelected.length===1)data.forEach((dataObject)=>dataObject[yAxis]=yAxisSelected[0]);}return _.sortBy(data,function(dataRow){return app.collections.regions.indexOf(app.collections.regions.get(dataRow.geo));});},getDataTableYAxisValues:function(processedData,filter,settings,yAxis){if(yAxis&&yAxis!='geo')return filter.get(yAxis).getSelected();var selectedOptions=filter.get('geo').getSelected();if(typeof selectedOptions=='string')selectedOptions=[selectedOptions];return settings.isEnabled('eu27Only')&&selectedOptions.length>1?_.filter(selectedOptions,function(geo){return app.collections.regions.get(geo).isEu27();}):filter.get('geo').getSelected();},createChart:function(data,settings){return new app.views.IndicatorHorizontalBarChart(data);},createNoDataChart:function(){return new app.views.IndicatorNoData(1200,555);},getVisibleSettings:function(yAxis){if(yAxis&&yAxis!='geo')return ['fixedYAxis'];else return ['fixedYAxis','euAverages','eu27Only'];}};})();;
(function(){"use strict";app.controllers.indicatorLineChart={createYearCriteria:function(years){return new app.models.CriteriaMultiSelect({code:'year',name:app.p.t('Criteria.year.labelMulti'),categories:_.map(years,function(year){return {code:String(year),name:year};}),sort:function(a,b){return a.code<b.code?1:a.code>b.code?-1:0;}}).selectAll();},createRegionCriteria:function(regionCodes){var orderedRegionsSubset=new Backbone.Collection(app.collections.regions.filter(function(region){return _.contains(regionCodes,region.id);}));return new app.models.CriteriaMultiSelect({code:'geo',name:app.p.t('Criteria.geo.labelMulti'),categories:orderedRegionsSubset.map(function(region){return {code:region.id,name:region.get('name'),filterName:region.getFilterName()};}),sentToBackendInCaseOfAllSelected:false}).selectFirst();},createCriteria:function(data,yAxism,datasetViewCode){var multiselectCriteriaForDatasetView={"wmidm_socp_socp__wmid_socp_eur":"EGROUP","wmidm_bus_bus__wmid_comp_compex":"POSITION"};if('sex'===data.code||_.isMatch(multiselectCriteriaForDatasetView,{[datasetViewCode]:data.code}))return new app.models.CriteriaMultiSelect(data).selectFirst();return new app.models.CriteriaSingleSelect(data).selectFirst();},needsEuAverages:function(settings){return true;},finalizeFilter:function(filter){var sex=filter.get('sex')?filter.get('sex').get('categories').length:1;filter.get('geo').set('maxSelected',Math.round(12/sex));},shouldRenderNoData:function(data,filter){return data.length===0;},getTimelineCriteria:function(filter){return null;},getCriteriaShortcut:function(filter){return null;},getDataTableYAxis:function(){return 'year';},getPossibleTabs:function(){return ['chart','metadata'];},processData:function(data,filter){return data;},getDataTableYAxisValues:function(processedData,filter,settings){return _.uniq(_.pluck(processedData,this.getDataTableYAxis()));},createChart:function(data,settings){return new app.views.IndicatorLineChart(data,settings);},createNoDataChart:function(){return new app.views.IndicatorNoData(1200,555);},getVisibleSettings:function(){return ['proportionalXAxis'];}};})();;
(function(){"use strict";app.controllers.indicatorMapChart={createYearCriteria:function(years){return new app.models.CriteriaSingleSelect({code:'year',name:app.p.t('Criteria.year.label'),categories:_.map(years,function(year){return {code:String(year),name:year};}),sort:function(a,b){return a.code<b.code?1:a.code>b.code?-1:0;},sentToBackend:false}).selectLast();},createRegionCriteria:function(regionCodes){var orderedRegionsSubset=new Backbone.Collection(app.collections.regions.filter(function(region){return _.contains(regionCodes,region.id);}));return new app.models.CriteriaMultiSelect({code:'geo',name:app.p.t('Criteria.geo.labelMulti'),categories:orderedRegionsSubset.map(function(region){return {code:region.id,name:region.get('name'),filterName:region.getFilterName()};}),sentToBackendInCaseOfAllSelected:false}).selectAll();},createCriteria:function(data){return new app.models.CriteriaSingleSelect(data).selectFirst();},needsEuAverages:function(settings){return true;},shouldRenderNoData:function(data,filter){return data.length===0;},finalizeFilter:function(filter){},getTimelineCriteria:function(filter){return filter.get('year')&&filter.get('year').get('categories').length>1?filter.get('year'):null;},getCriteriaShortcut:function(filter){return filter.get('sex');},getDataTableYAxis:function(){return 'geo';},getPossibleTabs:function(){return ['chart','metadata'];},processData:function(data,filter){data=_.where(data,{year:filter.get('year').getSelected()});return _.sortBy(data,function(dataRow){return app.collections.regions.indexOf(app.collections.regions.get(dataRow.geo));});},getDataTableYAxisValues:function(processedData,filter,settings){return settings.isEnabled('eu27Only')?_.filter(filter.get('geo').getSelected(),function(geo){return app.collections.regions.get(geo).isEu27();}):filter.get('geo').getSelected();},createChart:function(data,settings){return new app.views.IndicatorMapChart(data,settings);},createNoDataChart:function(){return new app.views.IndicatorNoData(1200,720);},getVisibleSettings:function(){return ['fixedYAxis','symbolMap','eu27Only'];}};})();;
(function(){"use strict";app.controllers.indicatorMetadata={getPossibleTabs:function(){return ['metadata'];},getMetadata:function(indicatorContent){var metadata={};metadata.dataset_name=indicatorContent.dataset.name;metadata.base_information={field_names:['source_type','source_org','source_org_url','source_activity','source_ref','data_type','harmonised','updated_on','value_count'],field_content:_.clone(indicatorContent.dataset.metadata),years:indicatorContent.dataset.years,time_periods:indicatorContent.dataset.time_periods,criterias:indicatorContent.dataset.criteria,flags:app.collections.flagValues};if(indicatorContent.dataset.updated_on&&indicatorContent.dataset.updated_on['$date'])metadata.base_information.field_content.updated_on=new Date(Number(indicatorContent.dataset.updated_on['$date']['$numberLong'])).format('dd.mm.yyyy');if(indicatorContent.dataset.value_count)metadata.base_information.field_content.value_count=indicatorContent.dataset.value_count;metadata.description=indicatorContent.datasetView.description;metadata.fields=_.clone(indicatorContent.dataset.metadata.fields);function keywordExists(keywords,key){var exists=false;_.each(keywords,function(keyword){if(keyword.key===key){exists=true;return;}});return exists;}var keywords=[];var synonyms=[];var keywordsToBeSkipped=[];if(indicatorContent.datasetView.specific_keywords)_.each(indicatorContent.datasetView.specific_keywords,function(keyword){var sanitizedKeyword=app.utils.sanitize(keyword);if(!keywordExists(keywords,sanitizedKeyword))keywords.push({key:sanitizedKeyword,literal:keyword});});if(indicatorContent.datasetView.data_set_view_keywords)_.each(indicatorContent.datasetView.data_set_view_keywords,function(keyword){var sanitizedKeyword=app.utils.sanitize(keyword._id);if(!keywordExists(keywords,sanitizedKeyword))keywords.push({key:sanitizedKeyword,literal:keyword._id});if(keyword.synonyms)synonyms=synonyms.concat(keyword.synonyms);});if(indicatorContent.datasetView.skip_keywords)keywordsToBeSkipped=indicatorContent.datasetView.skip_keywords;keywordsToBeSkipped=keywordsToBeSkipped.concat(synonyms);_.each(keywordsToBeSkipped,function(keyword){var sanitizedKeyword=app.utils.sanitize(keyword);var existingKeywordIndex=-1;_.each(keywords,function(keyword,index){if(keyword.key===sanitizedKeyword){existingKeywordIndex=index;return;}});if(existingKeywordIndex>-1)keywords.splice(existingKeywordIndex,1);});metadata.keywords=[];_.each(keywords,function(keyword){metadata.keywords.push({'name':keyword.literal,'valueForUrl':app.utils.sanitizeForUrlParam(keyword.literal)});});if(indicatorContent.datasetView.predefined_tables&&indicatorContent.datasetView.predefined_tables.length)metadata.predefinedTables=indicatorContent.datasetView.predefined_tables;;if(indicatorContent.datasetView.visualisations&&indicatorContent.datasetView.visualisations.length)metadata.visualisations=indicatorContent.datasetView.visualisations;;return metadata;}};})();;
(function($){"use strict";app.controllers.indicatorPageExporter={svgBackground:'white',htmlBackground:'white',initialize:function(){this.exportOptions=[{type:'png',group:'chart',callback:this.exportChartAsImage,mimetype:'image/png'},{type:'jpg',group:'chart',callback:this.exportChartAsImage,mimetype:'image/jpeg'},{type:'iframe',group:'embed',callback:this.embedChartAsIframe},{type:'xlsx',group:'data',callback:this.exportDataTable,filteredAndUnfiltered:true},{type:'csv',group:'data',callback:this.exportDataTable,filteredAndUnfiltered:true},{type:'xml',group:'data',callback:this.exportDataTable,filteredAndUnfiltered:true},{type:'json',group:'data',callback:this.exportDataTable,filteredAndUnfiltered:true}];},export:function(view,datasetViewId,pageUrl,filter,type,option){var exportOption=_.findWhere(this.exportOptions,{type});if(!exportOption)return;Backbone.trigger('track-action','dgs','export',type);if(exportOption.callback)exportOption.callback.call(this,view,datasetViewId,pageUrl,filter,exportOption,option);},exportDataTable:function(view,datasetViewId,pageUrl,filter,exportOption,option){if(option==='full')filter=filter.clone(function(criteria){return criteria.isHidden();});var exportUrl=[app.root,'export',pageUrl,exportOption.type,filter.getUrlForUI()].filter((item)=>item!=='').join('/');window.location=exportUrl;view.closeExportModal();},exportChartAsImage:function(view,datasetViewId,pageUrl,filter,exportOption){var filename=datasetViewId+'-chart-'+filter.getDescription();view.closeExportModal();view.appendSpinner();var that=this;_.defer(function(){that.exportSvgTo(view.$('.chart svg'),exportOption.mimetype,filename,exportOption.type);view.removeSpinner();});},embedChartAsIframe:function(view,datasetViewId,pageUrl,filter,exportOption,option){view.closeExportModal();view.showEmbedModal();},exportSvgTo:function($svg,mimetype,filename,extension){var svg=$svg.get(0);this.inlineSvgCss($svg);var canvas=this.convertToCanvas(svg);this.serveCanvas(canvas,mimetype,filename,extension);$('#svg_chart_clone').remove();},exportHtmlTo:function($html,mimetype,filename,extension){var that=this,svgs=[],canvases=[];$html.find('svg:visible').each(function(){var $svg=$(this);that.inlineSvgCss($svg);var canvas=that.convertToCanvas(this);$svg.hide();$svg.after(canvas);svgs.push($svg);canvases.push(canvas);});html2canvas($html[0],{logging:true,height:$html.outerHeight(),background:that.htmlBackground,onrendered:function(canvas){that.serveCanvas(canvas,mimetype,filename,extension);for(var i=0;i<svgs.length;i++)svgs[i].show();for(var i=0;i<canvases.length;i++)canvases[i].remove();}});},convertToCanvas:function(svg){var clonedSVG=$(svg).clone();var yTextPosition=parseInt(clonedSVG[0].getAttribute("viewBox").split(' ')[3]);var viewbox=clonedSVG[0].getAttribute("viewBox").split(' ');var newViewboxHeight=parseInt(viewbox[3])+150;var newViewBox=viewbox[0]+" "+viewbox[1]+" "+viewbox[2]+" "+newViewboxHeight;var indicatorText=document.createElementNS('http://www.w3.org/2000/svg',"text");indicatorText.setAttributeNS(null,'id','chart_info');indicatorText.setAttributeNS(null,"x",0);indicatorText.setAttributeNS(null,"y",yTextPosition+20);indicatorText.setAttributeNS(null,"font-size","15");indicatorText.setAttributeNS(null,"fill","#44444");var indicatorTextNode=document.createTextNode("EIGE’s Gender Statistics Database - "+document.title.split('|')[0].replace(" ",""));indicatorText.appendChild(indicatorTextNode);clonedSVG.append(indicatorText);var sourceText=document.createElementNS('http://www.w3.org/2000/svg',"text");sourceText.setAttributeNS(null,'id','chart_info');sourceText.setAttributeNS(null,"x",0);sourceText.setAttributeNS(null,"y",yTextPosition+40);sourceText.setAttributeNS(null,"font-size","15");sourceText.setAttributeNS(null,"fill","#44444");var sourceTextNode=document.createTextNode("Source: European Institute for Gender Equality.");sourceText.appendChild(sourceTextNode);clonedSVG.append(sourceText);var importText=document.createElementNS('http://www.w3.org/2000/svg',"text");importText.setAttributeNS(null,'id','chart_info');importText.setAttributeNS(null,"x",0);importText.setAttributeNS(null,"y",yTextPosition+60);importText.setAttributeNS(null,"font-size","15");importText.setAttributeNS(null,"fill","#44444");var importTextNode=document.createTextNode(document.getElementsByClassName('import-info')[0].innerText);importText.appendChild(importTextNode);clonedSVG.append(importText);clonedSVG[0].setAttribute("viewbox","0 0 1200 1000");clonedSVG[0].setAttribute("id","svg_chart_clone");clonedSVG.height(0);clonedSVG.appendTo("body");var canvas=$('<canvas width="'+1200+'" height="'+(yTextPosition+200)+'"></canvas>')[0];var svgMarkup=clonedSVG[0].outerHTML;canvg(canvas,svgMarkup,{ignoreMouse:true,ignoreAnimation:true,ignoreDimensions:true});this.solidifyBackground(canvas);return canvas;},solidifyBackground:function(canvas){var context=canvas.getContext("2d");context.globalCompositeOperation="destination-over";context.fillStyle=this.svgBackground;context.fillRect(0,0,canvas.width,canvas.height);},serveCanvas:function(canvas,mimetype,filename,extension){var link=$('<a style="display: none" href="'+canvas.toDataURL(mimetype)+'" download="'+new Date().format('yyyy-mm-dd')+'-'+app.utils.sanitize(filename)+'.'+extension+'">Save</a>')[0];document.body.appendChild(link);link.click();document.body.removeChild(link);},inlineSvgCss:function($elem){this.inlineCssProperties($elem,'fill,fillOpacity,stroke,strokeWidth,strokeDasharray,strokeLinecap,opacity,fontSize,dominantBaseline,textAnchor,fontWeight'.split(','));},inlineCssProperties:function($elem,properties){$elem.find('*').each(function(){var $elem=jQuery(this);for(var i=0;i<properties.length;i++)if(properties[i]=="transform"){var transformValue=$elem.css(properties[i]);if(transformValue!="none")$elem.css(properties[i],transformValue);}else $elem.css(properties[i],$elem.css(properties[i]));});}};})(Backbone.$);;
(function($){"use strict";app.controllers.indicatorPage=_.extend({chartTypes:[{key:'map',controller:app.controllers.indicatorMapChart,x_axis:'default',y_axis:'default'},{key:'bar',controller:app.controllers.indicatorBarChart,x_axis:'default',y_axis:'default'},{key:'hbar',controller:app.controllers.indicatorHorizontalBarChart,x_axis:'default',y_axis:'default'},{key:'line',controller:app.controllers.indicatorLineChart,x_axis:'default',y_axis:'default'},{key:'datatable',controller:app.controllers.indicatorDataTable,x_axis:'default',y_axis:'default'},{key:'metadata',controller:app.controllers.indicatorMetadata}],noDataIndicators:['ta_gbv_prev__prev_admin'],euAveragePriorityCodeList:["EU_V","EU27_2020","EU28"],initialize:function(settings){this.settings=settings;app.controllers.indicatorPageExporter.initialize();this.chartTypeSelectorModel=new Backbone.Model({keys:_.pluck(this.chartTypes,'key'),selected:null});this.listenTo(this.chartTypeSelectorModel,'change',this.changeChartType);this.listenTo(this.settings,'change:fixedYAxis',this.fetchAndRenderIndicatorData);this.listenTo(this.settings,'change:euAverages',this.fetchAndRenderIndicatorData);this.listenTo(this.settings,'change:eu27Only',this.fetchAndRenderIndicatorData);},shouldShowIndicatorData:function(){return !_.contains(this.noDataIndicators,this.datasetViewId);},shouldLoadIndicatorData:function(){return this.chartType.controller.getPossibleTabs().indexOf('chart')>=0;},shouldShowFilters:function(){return this.chartType.controller.getPossibleTabs().indexOf('chart')>=0;},filterSelected:function(filter){this.setCurrentFilter(filter);this.view.renderFilters(this.getAllFilters(),this.getCurrentFilter(),this.chartType.controller,this.canAddFilter());this.filterChanged();},filterRemove:function(filter){var filters=this.getAllFilters();for(var i=1;i<filters.length;i++)if(filters[i]===filter){this.setAllFilters(_.without(filters,filter));this.setCurrentFilter(filters[i-1]);this.saveFilters();this.view.renderFilters(this.getAllFilters(),this.getCurrentFilter(),this.chartType.controller,this.canAddFilter());this.filterChanged();return;}},filterChanged:function(){this.filterStateInUrl=true;var newUrl=this.getPageUrl()+'/'+this.getCurrentFilter().getUrlForUI();Backbone.history.navigate(newUrl);Backbone.history.trigger('route');this.fetchAndRenderIndicatorData();},getPageUrl:function(){return 'indicator/'+this.metadata.datasetView._id+'/'+this.chartTypeSelectorModel.get('selected');},changeChartType:function(){this.chartType=_.findWhere(this.chartTypes,{key:this.chartTypeSelectorModel.get('selected')});var newUrl=this.getPageUrl();Backbone.history.navigate(newUrl);Backbone.history.trigger('route');this.params='';this.filterStateInUrl=false;this.selectedDataDisplay=this.chartType.controller.getPossibleTabs()[0];if(this.shouldShowFilters()){this.createFilters();this.view.renderFilters(this.getAllFilters(),this.getCurrentFilter(),this.chartType.controller,this.canAddFilter());}else this.view.removeFilters();this.fetchAndRenderIndicatorData();},getCurrentFilter:function(){return this.currentFilter;},setCurrentFilter:function(filter){this.currentFilter=filter;},getAllFilters:function(){return this.filters;},setAllFilters:function(filters){this.filters=filters;},canAddFilter:function(){return this.getAllFilters().length<this.maxFilters;},maxFilters:4,addFilter:function(){var filters=this.getAllFilters();if(!this.canAddFilter())return;var filterClone=filters[filters.length-1].clone();filters.push(filterClone);this.saveFilters();this.setCurrentFilter(filterClone);this.view.renderFilters(this.getAllFilters(),this.getCurrentFilter(),this.chartType.controller,this.canAddFilter());Backbone.trigger('track-action','dgs','add-filter');},serializeFilters:function(filters){var filterUrls=[];for(var i=0;i<filters.length;i++)filterUrls.push(filters[i].getUrlForUI());return JSON.stringify(filterUrls);},saveFilters:function(){var filters=this.getAllFilters(),key=this.getPageUrl();filters=filters.slice(1);if(filters.length)localStorage.setItem(key,this.serializeFilters(filters));else localStorage.removeItem(key);},restoreFilters:function(defaultFilter){var key=this.getPageUrl(),storedFilterUrls=JSON.parse(localStorage.getItem(key)),filters=[];if(!storedFilterUrls)return [];for(var i=0;i<storedFilterUrls.length;i++)filters.push(defaultFilter.clone().setStateFromUrl(storedFilterUrls[i]));return filters;},createView:function(id,urlChartType,urlDataDisplay,params){this.datasetViewId=id;this.params=params;this.urlChartType=urlChartType;this.urlDataDisplay=urlDataDisplay;this.view=new app.views.IndicatorPage({chartTypeSelectorModel:this.chartTypeSelectorModel,settings:this.settings,exportOptions:app.controllers.indicatorPageExporter.exportOptions,params:this.params});this.listenTo(this.view,'filter:changed',function(){this.filterChanged();this.saveFilters();});this.listenTo(this.view,'filter:selected',this.filterSelected);this.listenTo(this.view,'filter:remove',this.filterRemove);this.listenTo(this.view,'addFilter:clicked',this.addFilter);this.listenTo(this.view,'export',this.export);this.listenTo(this.view,'help',this.fetchAndRenderHelpText);Backbone.trigger('title',app.p.t('IndicatorPage.title.pending'));this.fetchAndRenderIndicatorMetadata();return this.view;},export:function(type,option){app.controllers.indicatorPageExporter.export(this.view,this.datasetViewId,this.getPageUrl(),this.getCurrentFilter(),type,option);},getIframeEmbedHtmlCode:function(width){var that=this;var baseUrl=window.location.href.replace(/\?.*/,'');var sliceIndex=baseUrl.indexOf('indicator/'+this.datasetViewId);var url=baseUrl.substr(0,sliceIndex)+'embed/iframe/'+baseUrl.substr(sliceIndex)+'?'+_.map(that.chartType.controller.getVisibleSettings(),function(setting){return setting+'='+(that.settings.isEnabled(setting)?'true':'false');}).join('&');var height=2*this.view.getEstimatedEmbedHeightForWidth(width);return app.templates.IndicatorEmbedIframe({width,height,url}).trim();},fetchAndRenderIndicatorMetadata:function(){var indicatorMetadataBackendUrl='indicator/'+this.datasetViewId;if(indicatorMetadataBackendUrl===this.previousIndicatorMetadataBackendUrl){this.processAndRenderIndicatorMetadata(this.previousIndicatorMetadataContent);this.fetchAndRenderIndicatorData();return;}else delete this.previousIndicatorMetadataBackendUrl;this.fetch(indicatorMetadataBackendUrl,function(content){this.previousIndicatorMetadataBackendUrl=indicatorMetadataBackendUrl;this.previousIndicatorMetadataContent=content;this.processAndRenderIndicatorMetadata(content);this.fetchAndRenderIndicatorData();},function(){this.view.render404();});},processAndRenderIndicatorMetadata:function(content){Backbone.trigger('title',app.p.t('IndicatorPage.title.loaded',{indicator:content.datasetView.name}));this.setIndicatorMetadata(content);this.selectChartTypeAndDefaultTab(content);var breadcrumbKeys=this.metadata.datasetView.parent_themes.concat(this.metadata.datasetView.theme),breadcrumbData=[];for(var i=0;i<breadcrumbKeys.length;i++){var keys=breadcrumbKeys.slice(0,i+1),node=app.controllers.navigationTree.getNodeByKeys(keys);if(!node)continue;breadcrumbData.push({key:keys.join('/'),name:node.name,cssClass:"theme_"+keys[keys.length-1]});}Backbone.trigger('breadcrumb',breadcrumbData);this.view.renderMetadata(content,app.controllers.indicatorMetadata.getMetadata(content),this.shouldShowIndicatorData());if(this.shouldShowIndicatorData()&&this.shouldShowFilters()){this.createFilters();this.view.renderFilters(this.getAllFilters(),this.getCurrentFilter(),this.chartType.controller,this.canAddFilter());}},appendDummyChartsSettings:function(content){content.datasetView.dgs_charts={"default":"bar","settings":[{name:"map",display:true},{name:"bar",display:true},{name:"hbar",display:true},{name:"line",display:!(content.dataset?.years.length<=1&&content.dataset?.time_periods.length<=1)},{name:"breakdown",display:false},{name:"datatable",display:true}]};},setIndicatorMetadata:function(data){this.datasetId=data.datasetView.data_set;this.metadata=data;},selectChartTypeAndDefaultTab:function(content){var chartSettings=[];var defaultChart=null;var dbChartTypes=[];if(content.datasetView.visualisations){chartSettings=content.datasetView.visualisations;for(var i=0;i<chartSettings.length;i++){if(chartSettings[i].default_visualisation)defaultChart=_.findWhere(this.chartTypes,{key:(chartSettings[i].name).toLowerCase()});for(var j=0;j<this.chartTypes.length;j++)if(this.chartTypes[j].key===chartSettings[i].name.toLowerCase()&&chartSettings[i].display){if(chartSettings[i].name.toLowerCase()==="line"&&content.dataset?.years.length<=1&&content.dataset?.time_periods.length<=1)continue;dbChartTypes.push(this.chartTypes[j]);}}dbChartTypes.push(_.findWhere(this.chartTypes,{key:'metadata'}));this.chartTypes=dbChartTypes;this.chartTypeSelectorModel.set('keys',_.pluck(this.chartTypes,'key'),{silent:true});}else{this.appendDummyChartsSettings(content);chartSettings=this.metadata.datasetView.dgs_charts.settings;for(var i=0;i<chartSettings.length;i++)for(var j=0;j<this.chartTypes.length;j++)if(this.chartTypes[j].key===chartSettings[i].name.toLowerCase()&&chartSettings[i].display)dbChartTypes.push(this.chartTypes[j]);dbChartTypes.push(_.findWhere(this.chartTypes,{key:'metadata'}));this.chartTypes=dbChartTypes;this.chartTypeSelectorModel.set('keys',_.pluck(this.chartTypes,'key'),{silent:true});defaultChart=_.findWhere(this.chartTypes,{key:this.metadata.datasetView.dgs_charts.default})?_.findWhere(this.chartTypes,{key:this.metadata.datasetView.dgs_charts.default}):this.chartTypes[1];}this.chartType=_.findWhere(this.chartTypes,{key:this.urlChartType})?_.findWhere(this.chartTypes,{key:this.urlChartType}):defaultChart;this.chartTypeSelectorModel.set('selected',this.chartType.key,{silent:true});},createFilters:function(){var defaultFilter=new app.collections.Criterias();var visualisations=this.metadata.datasetView.visualisations||[];for(var i=0;i<visualisations.length;i++){var visualName=visualisations[i].name.toLowerCase();if(this.chartType.key==visualName&&visualisations[i].x_axis_default)this.chartType.x_axis=visualisations[i].x_axis_default;if(this.chartType.key==visualName&&visualisations[i].y_axis_default)this.chartType.y_axis=visualisations[i].y_axis_default;}if(this.chartType.controller.createChangeYAxisModel&&this.chartType.controller.getChangeYAxisModel())this.chartType.y_axis=this.chartType.controller.getChangeYAxisModel().getSelected();const yAxis=this.chartType.controller.getDataTableYAxis(this.chartType.y_axis);if(this.metadata.dataset.criteria&&this.metadata.datasetView.criteria)for(var i=0;i<this.metadata.datasetView.criteria.length;i++){var datasetViewCriteria=this.metadata.datasetView.criteria[i];var datasetCriteria=_.findWhere(this.metadata.dataset.criteria,{code:datasetViewCriteria.code});if(!datasetCriteria)continue;if(datasetViewCriteria.categories){var enabledCategoryCodes=_.pluck(_.where(datasetViewCriteria.categories,{option:'Default'}),'code');datasetCriteria.categories=_.filter(datasetCriteria.categories,function(category){return _.contains(enabledCategoryCodes,category.code);});}if(this.chartType.controller.createGroupByCriteria&&this.chartType.y_axis==datasetViewCriteria.code)var criteria=this.chartType.controller.createGroupByCriteria(datasetCriteria);else var criteria=this.chartType.controller.createCriteria(datasetCriteria,yAxis,this.metadata.datasetView._id);criteria.setHidden(datasetViewCriteria.hidden);if(datasetViewCriteria.default_category){if(criteria.isMulti)criteria.selectNone();criteria.select(datasetViewCriteria.default_category);}defaultFilter.add(criteria);}if(this.metadata.dataset.criteria&&this.metadata.dataset.criteria.length>defaultFilter.length)for(var i=0;i<this.metadata.dataset.criteria.length;i++)if(defaultFilter.get(this.metadata.dataset.criteria[i].code)===undefined)defaultFilter.add(this.chartType.controller.createCriteria(this.metadata.dataset.criteria[i],yAxis,this.metadata.datasetView._id));if(this.metadata.dataset.regions&&this.metadata.dataset.regions.length){var geos=[];if(this.metadata.datasetView.criteria&&this.metadata.datasetView.criteria.length)for(var i=0;i<this.metadata.datasetView.criteria.length;i++){var datasetViewCriteria=this.metadata.datasetView.criteria[i];if(datasetViewCriteria.code=='geo')for(var i=0;i<datasetViewCriteria.categories.length;i++){var geo=datasetViewCriteria.categories[i];if(geo.option.toLowerCase()!='hidden')geos.push(geo.code);}}const isYAxisNonGeo=yAxis!=='geo';if(geos.length)defaultFilter.add(this.chartType.controller.createRegionCriteria(geos,yAxis),{at:0});else defaultFilter.add(this.chartType.controller.createRegionCriteria(_.pluck(this.metadata.dataset.regions,'code'),yAxis),{at:0});}var timeCriteriaData=_.findWhere(this.metadata.datasetView.criteria,{code:'time'});if(timeCriteriaData){var years=_.pluck(_.where(timeCriteriaData.categories,{option:'Default'}),'code');var defaultYear=timeCriteriaData.default_category;years=years.sort();var timeCriteria=this.chartType.controller.createYearCriteria(years);timeCriteria.select(defaultYear);if(timeCriteriaData.default_category){if(timeCriteria.isMulti)timeCriteria.selectNone();timeCriteria.select(timeCriteriaData.default_category);}defaultFilter.add(timeCriteria,{at:0});}else{if(this.metadata.dataset.time_periods&&this.metadata.dataset.time_periods.length){var years=this.metadata.dataset.time_periods;years=years.sort();var timeCriteria=this.chartType.controller.createYearCriteria(years);defaultFilter.add(timeCriteria,{at:0});}}this.chartType.controller.finalizeFilter(defaultFilter);this.setAllFilters(this.restoreFilters(defaultFilter));this.getAllFilters().splice(0,0,defaultFilter);var filters=this.getAllFilters(),currentFilter=null;for(var i=0;i<filters.length;i++)if('/'+filters[i].getUrlForUI()===this.params)currentFilter=filters[i];if(currentFilter)this.setCurrentFilter(currentFilter);else{if(this.params)defaultFilter.setStateFromUrl(this.params);this.setCurrentFilter(defaultFilter);}if(this.chartType.controller.createChangeYAxisModel){this.chartType.controller.createChangeYAxisModel(defaultFilter,yAxis);this.listenTo(this.chartType.controller.getChangeYAxisModel(),'change',this.reCreateFilters);}},reCreateFilters:function(){this.createFilters();this.view.renderFilters(this.getAllFilters(),this.getCurrentFilter(),this.chartType.controller,this.canAddFilter());this.fetchAndRenderIndicatorData();},fetchAndRenderIndicatorData:function(){if(!this.shouldShowIndicatorData())return;if(!this.shouldLoadIndicatorData()){this.view.renderData(null,this.chartType.controller,this.selectedDataDisplay,this.datasetViewId);return;}var criteriasForBackend=this.getCurrentFilter().clone();const isYAxisNonGeo=this.chartType.controller.getDataTableYAxis(this.chartType.y_axis)!=='geo';if(this.chartType.controller.needsEuAverages(this.settings,isYAxisNonGeo)){var geoCriteria=criteriasForBackend.get('geo');for(var i=0;i<this.euAveragePriorityCodeList.length;i++)if(_.contains(_.pluck(app.collections.regions.models,'id'),this.euAveragePriorityCodeList[i])&&_.contains(_.pluck(geoCriteria.get('categories'),'code'),this.euAveragePriorityCodeList[i])){geoCriteria.select(this.euAveragePriorityCodeList[i],true);break;}}var indicatorDataBackendUrl='indicator-data/'+this.datasetId+'/'+criteriasForBackend.getUrlForBackend();if(indicatorDataBackendUrl===this.previousIndicatorDataBackendUrl){this.processAndRenderData(this.previousIndicatorDataContent);return;}else delete this.previousIndicatorDataBackendUrl;this.fetch(indicatorDataBackendUrl,function(content){this.previousIndicatorDataBackendUrl=indicatorDataBackendUrl;this.previousIndicatorDataContent=content;this.processAndRenderData(content);},function(){Backbone.trigger('error',e);});},processAndRenderData:function(data){var that=this;var default_x_axis=null;var default_y_axis=null;_.each(this.metadata.datasetView.visualisations,function(visualisation){if(that.chartType.key===visualisation.name.toLowerCase()&&visualisation.x_axis_default)default_x_axis=visualisation.x_axis_default;if(that.chartType.key===visualisation.name.toLowerCase()&&visualisation.y_axis_default)default_y_axis=visualisation.y_axis_default;});if(this.chartType.controller.getChangeYAxisModel)default_y_axis=this.chartType.controller.getChangeYAxisModel().getSelected();if(!this.shouldLoadIndicatorData())return;const isYAxisNonGeo=this.chartType.controller.getDataTableYAxis(this.chartType.y_axis)!=='geo';if(this.chartType.controller.needsEuAverages(this.settings,isYAxisNonGeo)){var geoCriteria=this.getCurrentFilter().get('geo'),criteriaEuRegionCode=null;for(var i=0;i<this.euAveragePriorityCodeList.length;i++)if(_.contains(_.pluck(app.collections.regions.models,'id'),this.euAveragePriorityCodeList[i])&&_.contains(_.pluck(geoCriteria.get('categories'),'code'),this.euAveragePriorityCodeList[i])){criteriaEuRegionCode=this.euAveragePriorityCodeList[i];break;}}var globalMinValue=_.min(_.without(_.pluck(data,'value'),null));var globalMaxValue=_.max(_.without(_.pluck(data,'value'),null));var processedData=this.chartType.controller.processData(data,this.getCurrentFilter(),default_y_axis);if(this.chartType.controller.needsEuAverages(this.settings,isYAxisNonGeo)){var euAverageData=_.filter(processedData,function(dataRow){return dataRow.geo===criteriaEuRegionCode;});var postProcessedData=_.filter(processedData,function(dataRow){return _.contains(geoCriteria.getSelected(),dataRow.geo);});if(postProcessedData.length)processedData=postProcessedData;}if(this.chartType.controller.shouldRenderNoData(processedData,this.getCurrentFilter())){this.view.renderNoData(this.chartType.controller);return;}var minValue=_.min(_.without(_.pluck(processedData,'value'),null));var maxValue=_.max(_.without(_.pluck(processedData,'value'),null));_.each(processedData,function(data){if(data.flag){data.flags=data.flag.split('');delete data.flag;}});var yAxis=this.chartType.controller.getDataTableYAxis(default_y_axis);var yAxisValues=this.chartType.controller.getDataTableYAxisValues(processedData,this.getCurrentFilter(),this.settings,yAxis);if(typeof yAxisValues==='string')yAxisValues=[yAxisValues];var tableData={headers:[{key:yAxis,label:app.p.t('IndicatorDataTable.yAxis.'+yAxis)}],rows:[]};var xAxisMultipliers=[];this.getCurrentFilter().each(function(criteria){if(criteria.get('code')===yAxis)return 1;if(!criteria.isMulti)return 1;if(criteria.getSelected().length<2)return 1;if(criteria.isAllSelected()&&!criteria.get('sentToBackendInCaseOfAllSelected'))return 1;var multipliers=[],sortedCategories=_.pluck(criteria.getSortedCategories(),'code'),sortedSelectedCategories=_.sortBy(criteria.getSelected(),function(category){return _.indexOf(sortedCategories,category);});_.each(sortedSelectedCategories,function(selected){var multiplier={};multiplier[criteria.get('code')]=selected;multipliers.push(multiplier);});xAxisMultipliers.push(multipliers);});xAxisMultipliers=app.utils.cartesianProductOf(xAxisMultipliers);var xAxisFilters=[];_.each(xAxisMultipliers,function(xAxisMultiplier){var xAxisFilter={};_.each(xAxisMultiplier,function(propertyValuePair){xAxisFilter=_.extend(xAxisFilter,propertyValuePair);});xAxisFilters.push(xAxisFilter);});if(xAxisFilters.length===1)tableData.headers.push({key:'value',label:app.p.t('IndicatorDataTable.value')});else _.each(xAxisFilters,function(xAxisFilter,i){tableData.headers.push({key:'value'+i,label:_.values(xAxisFilter).join(', ')});});_.each(yAxisValues,function(yAxisValue){var row={};row[yAxis]=yAxisValue;if(xAxisFilters.length===1){var value=_.find(processedData,function(data){return data[yAxis]===yAxisValue;});if(value){row['value']=value.value;copyValueToRow(value['value'],row,'value');copyValueToRow(value['geo'],row,'value_geo');copyValueToRow(value['sex'],row,'value_sex');copyValueToRow(value['year'],row,'value_year');copyValueToRow(value['flags'],row,'value_flags');if(value.value===minValue)row['value_min']=true;if(value.value===maxValue)row['value_max']=true;}}else _.each(xAxisFilters,function(xAxisFilter,i){xAxisFilter[yAxis]=yAxisValue;var value=_.findWhere(processedData,xAxisFilter);if(value){copyValueToRow(value['value'],row,'value'+i);copyValueToRow(value['geo'],row,'value'+i+'_geo');copyValueToRow(value['sex'],row,'value'+i+'_sex');copyValueToRow(value['year'],row,'value'+i+'_year');copyValueToRow(value['flags'],row,'value'+i+'_flags');if(value.value===minValue)row['value'+i+'_min']=true;if(value.value===maxValue)row['value'+i+'_max']=true;}});tableData.rows.push(row);});function copyValueToRow(value,row,rowKey){if(value!==undefined)row[rowKey]=value;}if(yAxis==='year')tableData.rows=_.sortBy(tableData.rows,function(row){return row[yAxis];});var selectedUnitCriteria=null;var criteriaToBeUsedAsUnitForSomeDatasets={demo_find:"indic_de",demo_gind:"indic_de",demo_mlifetable:"indic_de",demo_ndivind:"indic_de",demo_nind:"indic_de",earn_gr_isco:"currency",earn_gr_nace:"currency",earn_gr_nace2:"currency",earn_ses_annual:"indic_se",earn_ses_hourly:"indic_se",earn_ses_monthly:"indic_se",earn_ses_pub2s:"currency",earn_ses10_12:"currency",earn_ses10_13:"currency",earn_ses10_14:"currency",earn_ses10_15:"currency",earn_ses10_16:"currency",earn_ses10_17:"currency",earn_ses10_18:"currency",earn_ses10_19:"currency",earn_ses10_20:"currency",earn_ses10_21:"currency",earn_ses10_22:"currency",earn_ses10_23:"currency",earn_ses10_24:"currency",earn_ses10_25:"currency",earn_ses10_26:"currency",earn_ses10_27:"currency",earn_ses10_28:"currency",earn_ses10_29:"currency",earn_ses10_30:"currency",earn_ses10_31:"currency",earn_ses10_32:"currency",earn_ses10_33:"indic_se",earn_ses10_34:"indic_se",earn_ses10_35:"indic_se",earn_ses10_36:"indic_se",earn_ses10_37:"indic_se",earn_ses10_38:"indic_se",earn_ses10_39:"indic_se",earn_ses10_47:"currency",earn_ses10_48:"currency",earn_ses10_49:"currency",earn_ses10_50:"indic_se",earn_ses14_12:"currency",earn_ses14_13:"currency",earn_ses14_14:"currency",earn_ses14_15:"currency",earn_ses14_16:"currency",earn_ses14_17:"currency",earn_ses14_18:"currency",earn_ses14_19:"currency",earn_ses14_20:"currency",earn_ses14_21:"currency",earn_ses14_22:"currency",earn_ses14_23:"currency",earn_ses14_24:"currency",earn_ses14_25:"currency",earn_ses14_26:"currency",earn_ses14_27:"currency",earn_ses14_28:"currency",earn_ses14_29:"currency",earn_ses14_30:"currency",earn_ses14_31:"currency",earn_ses14_32:"currency",earn_ses14_47:"currency",earn_ses14_48:"currency",earn_ses14_49:"currency",educ_ipart_s:"indic_ed",educ_itertc:"indic_ed",educ_itertp:"indic_ed",educ_mofo_gen:"indic_ed",educ_mofo_grd:"indic_ed",educ_momo_gen:"indic_ed",educ_momo_grd:"indic_ed",educ_thflds:"indic_ed",hlth_hlye:"indic_he",hlth_hlye_h:"indic_he",ilc_li01:"currency",lfsi_grt_a:"indic_em",prc_ppp_ind:"na_item",proj_15ndbims:"indic_de"};selectedUnitCriteria=this.getCurrentFilter().get(criteriaToBeUsedAsUnitForSomeDatasets[this.datasetId]);if(!selectedUnitCriteria)selectedUnitCriteria=this.getCurrentFilter().getCaseInsensitive('unit');var selectedUnitFullMetadata=selectedUnitCriteria&&selectedUnitCriteria.isMulti?null:selectedUnitCriteria?{name:selectedUnitCriteria.getSelectedCategoryName()}:this.metadata.datasetView.units[0];var fixedYMin=null;var fixedYMax=null;if(selectedUnitFullMetadata){var unit=_.findWhere(this.metadata.datasetView.units,{name:selectedUnitFullMetadata.name});if(unit&&_.has(unit,"fixed_y_min")&&_.has(unit,"fixed_y_max")){fixedYMin=unit.fixed_y_min;fixedYMax=unit.fixed_y_max;}}var maxValuePerCountry=_.max(_.without(_.pluck(tableData.rows,'value'),null));var minValuePerCountry=_.min(_.without(_.pluck(tableData.rows,'value'),null));if(!isFinite(maxValuePerCountry)||!isFinite(minValuePerCountry)){var maxValuePerCountryM=_.max(_.without(_.pluck(tableData.rows,'value0'),null));if(!isFinite(maxValuePerCountryM))maxValuePerCountryM=0;var maxValuePerCountryW=_.max(_.without(_.pluck(tableData.rows,'value1'),null));if(!isFinite(maxValuePerCountryW))maxValuePerCountryW=0;var maxValuePerCountryT=_.min(_.without(_.pluck(tableData.rows,'value2'),null));if(!isFinite(maxValuePerCountryT))maxValuePerCountryT=0;var minValuePerCountryM=_.min(_.without(_.pluck(tableData.rows,'value0'),null));if(!isFinite(minValuePerCountryM))minValuePerCountryM=0;var minValuePerCountryW=_.min(_.without(_.pluck(tableData.rows,'value1'),null));if(!isFinite(minValuePerCountryW))minValuePerCountryW=0;var minValuePerCountryT=_.min(_.without(_.pluck(tableData.rows,'value2'),null));if(!isFinite(minValuePerCountryT))minValuePerCountryT=0;}if(this.settings.isEnabled('eu27Only')&&(!yAxis||yAxis=='geo')&&selectedUnitCriteria&&selectedUnitCriteria.getSelected()!='PC'){maxValue=isFinite(maxValuePerCountry)?maxValuePerCountry:Math.max(maxValuePerCountryM,maxValuePerCountryW,maxValuePerCountryT);minValue=isFinite(minValuePerCountry)?minValuePerCountry:Math.min(minValuePerCountryM,minValuePerCountryW,minValuePerCountryT);}this.view.renderData({tableData,processedData,x_axis_default:default_x_axis,y_axis_default:default_y_axis,filter:this.getCurrentFilter(),selectedUnitFullMetadata,flagValues:app.collections.flagValues,chartFixedMin:fixedYMin,chartFixedMax:fixedYMax,minValue:_.contains(this.chartType.controller.getVisibleSettings(),'fixedYAxis')&&this.settings.isEnabled('fixedYAxis')?globalMinValue:minValue,maxValue:_.contains(this.chartType.controller.getVisibleSettings(),'fixedYAxis')&&this.settings.isEnabled('fixedYAxis')?globalMaxValue:maxValue,euAverageData,timeFormat:this.metadata.datasetView.time_format},this.chartType.controller,this.selectedDataDisplay);},fetchAndRenderHelpText:function(){var that=this;var fail=function(){that.view.closeHelpModal();};this.fetch(app.root+'/json/page'+app.root+'/indicator-help-content',function(content){this.view.renderHelpModalContent(content);},fail,fail,true,true);},fetch:function(url,success,fail404,error,rawUrl,noSpinner){var that=this;if(!noSpinner)that.view.appendSpinner();if(that.contentRequest&&that.contentRequest.abort)that.contentRequest.abort();that.contentRequest=$.ajax({url:rawUrl?url:app.getDbEndpoint(url)});$.when(that.contentRequest).done(function(content){delete that.contentRequest;that.view.removeSpinner();if(content===null){if(fail404)fail404.apply(that);}else success.apply(that,[content]);}).fail(function(e){if(error)error();if(e.status===0)return;that.view.removeSpinner();if(e.status===200)return;Backbone.trigger('error',e);});}},Backbone.Events);})(Backbone.$);;
(function(){"use strict";app.controllers.navigationTree={navigationTree:null,orphanThemeKey:'frequs',minSearchCharsLimit:3,maxSearchCharsLimit:256,themesToExclude:['eustrat_sege1619'],initialize:function(content){if(!content){console.log('navigation tree is not loaded');return;}if(content.root.children[this.orphanThemeKey]){content.root.children[this.orphanThemeKey].orphan=true;this.orphanNode=content.root.children[this.orphanThemeKey];}this.navigationTree=content;},sanitizePath:function(path){if(!path)return '';var sanitizedPath=path.trim();if(sanitizedPath&&sanitizedPath.slice(-1)==="/")sanitizedPath=sanitizedPath.slice(0,sanitizedPath.length-1);return sanitizedPath;},getNextLevelPath:function(path,node){if(typeof path!=='string')return '';var result='';if(path.length)result=this.sanitizePath(path)+"/";if(node&&node.id)result+=node.id;return result;},escapeRegExp:function(str){return str.trim().replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&");},compareNodeDisplayOrder:function(aNode,anotherNode){return aNode.order-anotherNode.order;},cloneNode:function(node,excludedProperties){if(!node)return null;var clone=node.constructor();for(var attr in node)if(_.has(node,attr)&&(!excludedProperties||!_.contains(excludedProperties,attr)))clone[attr]=node[attr];return clone;},getNodeByPath:function(pathFromRoot){var keys=[];if(pathFromRoot)keys=this.sanitizePath(pathFromRoot).split("/");return this.getNodeByKeys(keys);},getNodeByKeys:function(keys){if(!this.navigationTree)return null;if(!keys)return null;if(typeof keys==='string')keys=[keys];var node=this.navigationTree.root;for(var i=0;i<keys.length;i++){if(!node)return null;if(!node.children)return null;node=node.children[keys[i]];}return node;},getPreviousNode:function(pathFromRoot){return this.getSiblingNode(pathFromRoot,true);},getNextNode:function(pathFromRoot){return this.getSiblingNode(pathFromRoot);},getSiblingNode:function(pathFromRoot,previous){if(!pathFromRoot)return null;pathFromRoot=this.sanitizePath(pathFromRoot);var keys=pathFromRoot.split("/");var currentNodeId=keys[keys.length-1];var parentPathFromRoot='';if(keys.length>1)parentPathFromRoot=keys.slice(0,keys.length-1).join('/');var parentNode=this.getRenderableNode(parentPathFromRoot);if(_.has(parentNode,"orderedChildren")){var currentNodeIndex=_.findIndex(parentNode.orderedChildren,function(node){return node.id===currentNodeId;});var siblingNode=false;if(previous){if(currentNodeIndex>0)siblingNode=parentNode.orderedChildren[currentNodeIndex-1];}else{if(currentNodeIndex<parentNode.orderedChildren.length-1)siblingNode=parentNode.orderedChildren[currentNodeIndex+1];}if(siblingNode)return this.getRenderableNode(this.getNextLevelPath(parentPathFromRoot,siblingNode));}return null;},getRenderableNode:function(pathFromRoot){var node=this.getNodeByPath(pathFromRoot);if(!node)return null;var clone=this.cloneNode(node,['children']);var that=this;if(_.has(node,"children")){clone.orderedChildren=[];_.each(node.children,function(child){_.each(that.themesToExclude,function(id){if(!child.orphan&&id!==child.id)clone.orderedChildren.push(child);});});clone.orderedChildren.sort(this.compareNodeDisplayOrder);}clone.topLevelParentPath=this.sanitizePath(pathFromRoot).split("/")[0];clone.pathFromRoot=this.sanitizePath(pathFromRoot);clone.nextLevelPath=this.getNextLevelPath(pathFromRoot);return clone;},nodeMatches:function(node,searchTerm){if(!node||!searchTerm)return false;var matches=false;if(_.has(node,'name'))matches=node.name.match(new RegExp(this.escapeRegExp(searchTerm),"i"));if(!matches&&_.has(node,'id'))matches=node.id.match(new RegExp(this.escapeRegExp(searchTerm),"i"));return matches;},getHighlightedMatch:function(node,searchTerm){if(!this.nodeMatches(node,searchTerm))return '';var pattern=new RegExp(this.escapeRegExp(searchTerm),"gi");return node.name.replace(pattern,'<em>$&</em>');},searchTree:function(pathFromRoot,term){if(!term)return null;var searchRoot=this.getNodeByPath(pathFromRoot);if(!searchRoot)return null;var sanitizedTerm=term.substring(0,this.maxSearchCharsLimit).trim();return this.searchTreeNode(searchRoot,this.sanitizePath(pathFromRoot),sanitizedTerm);},searchTreeNode:function(node,pathFromRoot,term,parent){var clone=this.cloneNode(node,['children','indicators','indicators_count']);clone.pathFromRoot=this.sanitizePath(pathFromRoot);clone.nextLevelPath=this.getNextLevelPath(pathFromRoot);if(this.nodeMatches(node,term)){clone.selfMatched=true;clone.name=this.getHighlightedMatch(clone,term);}if(_.has(node,"indicators")){var that=this;_.each(node.indicators,function(indicator){if(that.nodeMatches(indicator,term)){var indicatorClone=that.cloneNode(indicator);indicatorClone.name=that.getHighlightedMatch(indicatorClone,term);if(!_.has(clone,"indicators"))clone.indicators=[];clone.indicators.push(indicatorClone);}});}if(_.has(node,"children")){var that=this;_.each(node.children,function(theme){_.each(that.themesToExclude,function(id){if(!theme.orphan&&id!==theme.id)that.searchTreeNode(theme,that.getNextLevelPath(pathFromRoot,theme),term,clone);});});}if(clone.selfMatched||_.has(clone,"orderedChildren")||_.has(clone,"indicators"))if(parent){if(!_.has(parent,"orderedChildren"))parent.orderedChildren=[];parent.orderedChildren.push(clone);parent.orderedChildren.sort(this.compareNodeDisplayOrder);}return clone;},fetchHelpText:function(success,fail){var that=this;if(that.contentRequest&&that.contentRequest.abort)that.contentRequest.abort();that.contentRequest=Backbone.$.ajax({url:app.root+'/json/page'+app.root+'/navigation-help-content'});Backbone.$.when(that.contentRequest).done(function(content){delete that.contentRequest;success(content);}).fail(function(e){fail();if(e.status===200)return;if(e.status===0)return;Backbone.trigger('error',e);});}};})();;
(function(){"use strict";app.controllers.searchPage=_.extend({pagerKey:'p',textSearchKey:'t',keywordSearchKey:'k',maxTextSearchCharsLimit:256,urlFilterKeyValueSeparator:':',initialize:function(searchFiltersData){this.createFilters(searchFiltersData);},createView:function(params){this.view=new app.views.SearchPage({controller:this});Backbone.trigger('title',app.p.t('SearchPage.title'));this.populateFiltersAndSearch(params);return this.view;},fetch:function(url,success,triggerEvent){var that=this;if(that.contentRequest&&that.contentRequest.abort)that.contentRequest.abort();that.contentRequest=Backbone.$.ajax({url:app.getDbEndpoint(url)});Backbone.$.when(that.contentRequest).done(function(data){delete that.contentRequest;success.apply(that,[data]);if(triggerEvent)Backbone.trigger(triggerEvent);}).fail(function(e){if(that.view)that.view.removeSpinner();if(e.status===200)return;if(e.status===0)return;Backbone.trigger('error',e);});},createFilters:function(data){this.filters=new app.collections.Filters([],{urlFilterKeyValueSeparator:this.urlFilterKeyValueSeparator});this.filters.add(new app.models.TextFilter({key:this.textSearchKey,charsLimit:this.maxTextSearchCharsLimit,helpMessage:app.p.t('SearchPage.search.help'),label:app.p.t('SearchPage.search.label'),placeholder:app.p.t('SearchPage.search.placeholder')}));if(data.keywords){this.keywordOptions=data.keywords;this.filters.add(new app.models.MultipleSelectFilter({key:this.keywordSearchKey,label:app.p.t('SearchPage.filters.keywords'),sendLabelsToBackend:true,data:data.keywords}));}if(data.source_orgs)this.filters.add(new app.models.MultipleSelectFilter({key:'source-orgs',label:app.p.t('SearchPage.filters.source_orgs'),sendLabelsToBackend:true,data:data.source_orgs}));if(data.source_activities)this.filters.add(new app.models.MultipleSelectFilter({key:'source-activities',label:app.p.t('SearchPage.filters.source_activities'),sendLabelsToBackend:true,data:data.source_activities}));if(data.data_types)this.filters.add(new app.models.MultipleSelectFilter({key:'data-types',label:app.p.t('SearchPage.filters.data_types'),sendLabelsToBackend:true,data:data.data_types}));},populateFiltersAndSearch:function(params){params=decodeURIComponent(params);this.filters.clearAndpopulateFromUrl(params);var that=this;this.filters.each(function(filter){that.view.renderFilter(filter);});this.view.renderSearchControls();if(this.filters.isAnyActive())this.performSearch(this.calculatePagerCurrentPageFromUrl(params));},calculatePagerCurrentPageFromUrl:function(params){if(!params)return 0;var searchParams=_.compact(params.split('/'));for(var i=0;i<searchParams.length;i++){var param=searchParams[i].split(':');if(param.length!==2)continue;var key=param[0].trim(),value=param[1].trim();if(key===this.pagerKey){var page=parseInt(value,10);if(page)return page;}}return 0;},performSearch:function(selectedPage){this.view.emptyResultsAndAppendSpinner();this.fetch('search-results-all/'+this.filters.getBackendUrl(),_.partial(this.createPagerAndfetchSearchResults,_,selectedPage));},updatePageTitle:function(data){var keywordFilter=this.filters.get(this.keywordSearchKey);var synonyms=[];if(keywordFilter.isActive()&&this.keywordOptions){var that=this;_.each(keywordFilter.getSelectedLabels(),function(keyword){_.each(that.keywordOptions,function(option){if(option.name===keyword&&option.synonyms)synonyms=synonyms.concat(option.synonyms);});});}this.view.updateTitle({results_count:(data?data.length:0),search_term:this.filters.get(this.textSearchKey).getActiveValue(),keywords_count:keywordFilter.getSelectedOptionsCount(),keyword:keywordFilter.getActiveValue(),synonyms:synonyms.join(", ")});},createPagerAndfetchSearchResults:function(data,selectedPage){this.updatePageTitle(data);this.allResults=data;if(!this.allResults.length){this.view.removeSpinner();this.view.renderEmptyResultsMessage();return;}this.pager=new app.models.Pager({key:this.pagerKey,totalItems:this.allResults.length,currentPage:selectedPage});this.fetchPaginatedResults();},fetchPaginatedResults:function(){if(!this.allResults)return;var paginatedResultIds=this.allResults.slice(this.pager.getOffset(),this.pager.getLastItemIndex());var backendUrl='search-results-data/ids:'+paginatedResultIds.join(",");this.fetch(backendUrl,this.renderSearchResults);},renderSearchResults:function(results){this.view.removeSpinner();if(results&&results.length){this.view.renderPager(this.pager,this.filters.getUrl());this.view.renderResults(this.prepareResultsForRendering(results));}else this.view.renderEmptyResultsMessage();},prepareResultsForRendering:function(results){_.each(results,function(result){if(result.parent_themes&&result.parent_themes.length){result.path=[];for(var i=0;i<result.parent_themes.length;i++){var keys=result.parent_themes.slice(0,i+1);var theme=app.controllers.navigationTree.getNodeByKeys(keys);if(theme)result.path.push({key:keys.join('/'),name:theme.name,cssClass:"theme_"+keys[keys.length-1]});}}});var resultsUnique=_.uniq(results,function(x){return x.name&&x.data_set;});return resultsUnique;},updatePaginatedResults:function(url){if(!this.pager)return;var page=this.calculatePagerCurrentPageFromUrl(url);if(page===this.pager.get("currentPage"))return;var newUrl=url.replace(app.root,'');Backbone.history.navigate(newUrl);Backbone.history.trigger('route');this.pager.updateCurrentPage(page);this.view.emptyResultsAndAppendSpinner();this.fetchPaginatedResults();},updateSearchFilters:function(){app.router.navigate("search/"+this.filters.getUrl(),{trigger:true});},clearSearch:function(){if(this.filters)this.filters.clearAll();app.router.navigate("search",{trigger:true});}},Backbone.Events);})();;
(function(){"use strict";app.controllers.skeleton={initialize:function(){new app.views.Error();new app.views.Title();app.collections.flagValues=new app.collections.FlagValues(app.data.flags);app.collections.regions=new app.collections.Regions(app.data.regions);app.collections.settings=new app.collections.Settings();app.collections.settings.localStorage=new Backbone.LocalStorage("dgs-settings");app.collections.settings.fetch();if(!app.collections.settings.get('proportionalXAxis'))app.collections.settings.toggle('proportionalXAxis');app.controllers.indexPage.initialize();app.controllers.aboutPage.initialize();app.controllers.browsePage.initialize();app.controllers.themePage.initialize();app.controllers.searchPage.initialize(app.data.searchFilters);app.controllers.indicatorPage.initialize(app.collections.settings);app.controllers.navigationTree.initialize(app.data.tree);},createView:function(rootElementSelector){this.view=new app.views.Skeleton({controller:this,el:rootElementSelector,settings:app.collections.settings});},navigationLinkClicked:function(href){app.router.navigate(href.substr(app.root.length),{trigger:true});},renderSubView:function(view){if(this.oldView){this.oldView.remove();delete this.oldView;}this.oldView=view;this.view.renderSubView(view);if(view.rendered)view.rendered();}};})();;
(function(){"use strict";app.controllers.themePage={initialize:function(){},createView:function(treePath){this.view=new app.views.ThemePage({controller:this});this.calculateAndRenderData(treePath);return this.view;},calculateAndRenderData:function(treePath){var tree=app.controllers.navigationTree.getRenderableNode(treePath);if(!tree){this.view.render404();return;}Backbone.trigger('title',app.p.t('ThemePage.title',{theme:tree.name}));var themeKeys=tree.pathFromRoot.split('/'),breadcrumbData=[];for(var i=0;i<themeKeys.length-1;i++){var keys=themeKeys.slice(0,i+1);breadcrumbData.push({key:keys.join('/'),name:app.controllers.navigationTree.getNodeByKeys(keys).name,cssClass:"theme_"+keys[keys.length-1]});}Backbone.trigger('breadcrumb',breadcrumbData);var hasDescription=_.has(tree,"metadata")&&_.has(tree.metadata,"full")&&tree.metadata.full;this.view.renderContent(tree,hasDescription,app.controllers.navigationTree.getPreviousNode(tree.pathFromRoot),app.controllers.navigationTree.getNextNode(tree.pathFromRoot));}};})();;
(function($){"use strict";app.views.AboutPage=Backbone.View.extend({className:'AboutPage',initialize:function(options){this.render();this.listenTo(Backbone,'view:rendered',this.updateActiveMenuLink);},render:function(){this.$el.html(app.templates.AboutPage());return this;},updateActiveMenuLink:function(){app.utils.updateActiveMenuLink($,"about");},renderContent:function(content){if(content&&content.body&&content.body.en&&content.body.en.value&&content.body.en.value.length)this.$el.find(".text-formatted-extended").append(content.body.en.value);this.renderSourceStats();},renderSourceStats:function(){this.sourceStats=new app.views.SourceStatsSection();this.registerChild(this.sourceStats);this.$el.append(this.sourceStats.el);},appendSpinner:function(){this.removeSpinner();this.spinner=new app.views.SmallSpinner();this.registerChild(this.spinner);this.$el.append(this.spinner.el);},removeSpinner:function(){if(this.spinner){this.spinner.remove();delete this.spinner;}}});})(Backbone.$);;
(function(){"use strict";Backbone.View.prototype.getChildren=function(){if(typeof this._children==='undefined')return [];return _.clone(this._children);};Backbone.View.prototype.getParent=function(){return this._parent;};Backbone.View.prototype.registerChild=function(child){if(typeof this._children==='undefined')this._children=[];child._parent=this;this._children.push(child);};Backbone.View.prototype.unregisterChild=function(child){delete child._parent;this._children.splice(_.indexOf(this._children,child),1);};Backbone.View.prototype.registerChildren=function(children){for(var i=0;i<children.length;i++)this.registerChild(children[i]);};var originalRemove=Backbone.View.prototype.remove;Backbone.View.prototype.remove=function(){var children=this.getChildren();for(var i=0;i<children.length;i++)if(children[i])children[i].remove();if(this.destroy)this.destroy();this.unbind();originalRemove.apply(this);if(this.getParent())this.getParent().unregisterChild(this);};})();;
(function($){"use strict";app.views.Breadcrumb=Backbone.View.extend({initialize:function(){this.listenTo(Backbone,'breadcrumb',this.render);},tagName:'div',className:'breadcrumb',render:function(data){this.$el.html(app.templates.Breadcrumb({data}));var breadCrumbElements=[];this.$el.find("li").each(function(){var clone=$(this).clone();clone.addClass('dgs-breadcrumb-element');breadCrumbElements.push(clone);});var drupalBreadcrumb=$('nav.breadcrumb > ol');if(drupalBreadcrumb.length){drupalBreadcrumb.find("li.dgs-breadcrumb-element").remove();_.each(breadCrumbElements,function(element){drupalBreadcrumb.append(element);});}return this;}});})(Backbone.$);;
(function(){"use strict";app.views.BrowsePage=Backbone.View.extend({className:'BrowsePage',initialize:function(options){this.controller=options.controller;this.navigationTreeBrowser=new app.views.NavigationTree({controller:app.controllers.navigationTree,displayTitle:false});this.registerChild(this.navigationTreeBrowser);this.render();},render:function(){this.$el.html(app.templates.BrowsePage());this.$el.append(this.navigationTreeBrowser.el);return this;},renderTree:function(tree){this.navigationTreeBrowser.renderTree(tree);}});})();;
(function($){"use strict";app.views.CriteriaShortcut=Backbone.View.extend({initialize:function(){this.render();},tagName:'div',className:'CriteriaShortcut',events:{'click button':'buttonClicked'},buttonClicked:function(e){this.model.toggle(e.currentTarget.getAttribute('data-value'));this.trigger('change');},render:function(){this.$el.html(app.templates.CriteriaShortcut({model:this.model}));return this;},update:function(){this.render();}});})(Backbone.$);;
(function($){"use strict";app.views.CriteriaTimeline=Backbone.View.extend({initialize:function(options,settings){this.title=options.title;this.state=options.state;this.listenTo(this.state,'change',this.update);this.min=0;this.max=this.model.get('categories').length-1;this.render();this.$range=this.$('input');this.$tip=this.$('p.tip').hide();this.$el.addClass('play');this.settings=settings;},tagName:'div',className:'CriteriaTimeline',events:{'change input':'rangeChanged','click a':'buttonClicked','mouseenter input':'mouseEnterRange','mousemove input':'mouseMoveRange','mouseleave input':'mouseLeaveRange'},getCodeForMouseX:function(x){var totalX=this.$range.width(),offsetX=this.$range.offset().left,actualX=x-offsetX,index=Math.min(Math.max(this.min,Math.floor(this.max*actualX/totalX)),this.max);return this.model.get('categories')[index].code;},getTipDataForMouseX:function(x){var thumbSize=31,totalX=this.$range.width()-thumbSize,offsetX=this.$range.offset().left,actualX=x-offsetX-thumbSize/2,index=Math.min(Math.max(this.min,Math.round(this.max*actualX/totalX)),this.max),text=this.model.get('categories')[index].name,x=totalX/this.max*index-this.$tip.width()/2;return {x:Math.round(x),text};},showTipForMouseX:function(x){var tipData=this.getTipDataForMouseX(x);if(this.$tip.is(':visible')&&this.$tip.css('left')===tipData.x+'px')return;this.$tip.show().html(tipData.text).css('left',tipData.x+'px');},mouseEnterRange:function(e){this.showTipForMouseX(e.clientX);},mouseMoveRange:function(e){this.showTipForMouseX(e.clientX);},mouseLeaveRange:function(e){this.$tip.hide();},rangeChanged:function(e){this.enableFixedYAxis();this.selectByCurrentRangeValue();this.trigger('change');},selectByCurrentRangeValue:function(){this.model.select(this.model.get('categories')[this.$range.val()].code,true);},buttonClicked:function(e){e.preventDefault();this.state.set('play',!this.state.get('play'));this.timelinePlayOrPause();},goToNext:function(){var newValue=Number(this.$range.val())+1;if(newValue>this.max)newValue=0;this.$range.val(newValue);this.selectByCurrentRangeValue();this.trigger('change');},timelinePlayOrPause:function(){this.enableFixedYAxis();if(this.state.get('play'))this.timelinePlay();else this.timelinePause();},timelinePlay:function(){if(this.timelineInterval)return;var that=this;that.goToNext();this.timelineInterval=setInterval(function(){that.goToNext();},1500);},timelinePause:function(){if(this.timelineInterval){clearInterval(this.timelineInterval);delete this.timelineInterval;}},render:function(){this.$el.html(app.templates.CriteriaTimeline({indicatorTitle:this.title,min:this.min,max:this.max,index:this.model.getSelectedIndex()}));return this;},update:function(){this.$range.val(this.model.getSelectedIndex());this.$el.toggleClass('play',!this.state.get('play'));this.$el.toggleClass('pause',this.state.get('play'));},destroy:function(){this.timelinePause();},enableFixedYAxis:function(){if(!this.settings.isEnabled("fixedYAxis"))this.settings.toggle("fixedYAxis");}});})(Backbone.$);;
(function(){"use strict";app.views.Error404Page=Backbone.View.extend({className:'Error404Page',initialize:function(options){this.controller=options.controller;this.render();},render:function(){this.$el.html(app.templates.Error404Page());return this;},renderSearchInput:function(searchFilter){var searchFilterView=new app.views.TextFilter({model:searchFilter});this.registerChild(searchFilterView);this.$el.find("form").prepend(searchFilterView.el);},events:{'click button.search-submit':'performSearch'},performSearch:function(e){e.preventDefault();var $input=Backbone.$(e.currentTarget);this.controller.redirectToSearch($input.prev("div").find("input").val());}});})();;
(function(){"use strict";app.views.Error=Backbone.View.extend({initialize:function(){this.listenTo(Backbone,'error',this.render);},render:function(error){if(!error){alert(app.p.t('errors.generic'));return;}if(error.status===0&&error.statusText==="timeout"){alert(app.p.t('errors.ajax_timeout'));return;}if(error.status===0&&error.statusText==="error"){alert(app.p.t('errors.ajax_connection_error'));return;}if(error.status===500){alert(app.p.t('errors.ajax_500',{message:error.statusText,status:error.status}));return;}if(error.status){alert(app.p.t('errors.ajax_generic',{message:error.statusText,status:error.status}));return;}alert(app.p.t('errors.generic'));return this;}});})();;
(function($){"use strict";app.views.Featured=Backbone.View.extend({className:'FeaturedSection',initialize:function(){this.listenTo(Backbone,'featured',this.render);},render:function(content){this.$el.html(app.templates.FeaturedSection({featured:content}));return this;}});})(Backbone.$);;
(function($){"use strict";app.views.IndexPage=Backbone.View.extend({className:'IndexPage',initialize:function(options){this.controller=options.controller;this.navigationTreeBrowser=new app.views.NavigationTree({controller:app.controllers.navigationTree,displayTitle:true});this.registerChild(this.navigationTreeBrowser);this.render();},render:function(){this.$el.html(app.templates.IndexPage());this.$el.find(".theme-navigation").append(this.navigationTreeBrowser.el);return this;},renderTree:function(tree){this.navigationTreeBrowser.renderTree(tree);},renderAbout:function(content){if(content&&content.body&&content.body.en&&content.body.en.summary&&content.body.en.summary.length){this.$el.find(".about .highlighted-frame").prepend(content.body.en.summary);this.$el.find(".about .more-link").show();}else this.hideAboutSection();},renderTags:function(content){if(content){this.tags=new app.views.TagKeywordsSection(content);this.registerChild(this.tags);this.$el.find(".tags").append(this.tags.el);}else this.hideTagsSection();},renderFeaturedContent:function(content){var hasContent=false;if(content){var $content=Backbone.$(content);if($content.length){hasContent=true;$content.find('a').attr('data-bypass','yes');this.$('.featured').append($content);}}if(!hasContent){this.$('.featured').parent('div').remove();this.$('.theme-navigation').parent('div').removeClass().addClass("small-12 columns");}},renderPublicationsList:function(content){if(content){var $content=Backbone.$(content);$content.find('a').attr('data-bypass','yes');this.$('.publications').append($content);}else this.hidePublicationsSection();},renderFeaturedIndicators:function(content){this.featured=new app.views.Featured(content.getFeatured());this.registerChild(this.featured);this.$('.featured-indicators').append(this.featured.el);Backbone.trigger('featured',content.getFeatured());},hideAboutSection:function(){this.$el.find(".about").remove();},hideTagsSection:function(){this.$el.find(".tags").parent('div').remove();},hidePublicationsSection:function(){this.$el.find(".publications").parent('div').remove();},appendSpinner:function(){this.removeSpinner();this.spinner=new app.views.SmallSpinner();this.registerChild(this.spinner);this.$el.find(".featured").append(this.spinner.el);},removeSpinner:function(){if(this.spinner)this.spinner.remove();}});})(Backbone.$);;
(function(){"use strict";app.views.IndicatorAddFilter=Backbone.View.extend({initialize:function(){this.render();},tagName:'div',className:'IndicatorAddFilter',events:{'click .tab a':'tabClicked'},tabClicked:function(e){e.preventDefault();this.trigger('clicked',this);},render:function(){this.$el.html(app.templates.IndicatorAddFilter());return this;}});})();;
(function(){"use strict";app.views.IndicatorBarChart=Backbone.View.extend({initialize:function(data){this.data=data;this.render();},tagName:'div',className:'IndicatorBarChart chart',events:{'mouseenter g.geo circle':'mouseEnterDot','mousemove g.geo circle':'mouseMoveDot','mouseleave g.geo circle':'mouseLeaveDot','mouseenter g.axisX text tspan':'textEnter','mouseleave g.axisX text tspan':'textLeave'},textEnter:function(e){var country=e.currentTarget.innerHTML;var regions=app.collections.regions;var helperObject={};if(this.xAxis){country=_.find(this.geosNames,function(item){return item.code===country;}).name;helperObject[this.xAxis]=country;}var x=e.currentTarget.getAttribute('x');var y=e.currentTarget.getAttribute('y');var html=app.templates.PlainTextTooltipContent({yAxis:null,text:country,regions});Backbone.trigger('Tooltip:show',{top:e.clientY,left:e.clientX,width:'250px',html});Backbone.trigger('Tooltip:pointTo',{top:e.clientY,left:e.clientX});},textLeave:function(e){Backbone.trigger('Tooltip:hide');},mouseEnterDot:function(e){var year=e.currentTarget.getAttribute('data:year'),country=e.currentTarget.getAttribute('data:geo'),regions=app.collections.regions,valueElement=_.findWhere(this.data.tableData.rows,{geo:country}),countryValueHeaders=this.data.tableData.headers.slice(1),euAverage=_.sortBy(this.data.euAverageData,function(data){return _.pluck(countryValueHeaders,'label').indexOf(data.sex);}),html=app.templates.CountryYearMultiValuesTooltipContent({yAxis:null,year,country,regions,valueElement,countryValueHeaders,flagValues:app.collections.flagValues,euAverage});Backbone.trigger('Tooltip:show',{top:e.clientY,left:e.clientX,width:'250px',html});},mouseMoveDot:function(e){Backbone.trigger('Tooltip:pointTo',{top:e.clientY,left:e.clientX});},mouseLeaveDot:function(e){Backbone.trigger('Tooltip:hide');},render:function(){this.$el.html(app.templates.IndicatorBarChart(this.data)).find('.svgPlaceholder').replaceWith(this.generateGraphHtml());return this;},postRender:function(){if(app.isIE)this.$('svg').height(this.$('svg').width()*555/1200+'px');},generateGraphHtml:function(){var data=this.data.tableData,euAverageData=this.data.euAverageData,svgWidth=1200,svgHeight=555,geos=_.pluck(data.rows,'geo'),dots=data.headers.slice(1),verticalSplits=8,valuesRange=this.data.maxValue-this.data.minValue,minChartValue,maxChartValue,rightPadding=10,bottomPadding=45,topPadding=10,dotSize=9,linesRegionHeight=svgHeight-bottomPadding-topPadding,elements=[];if(this.data.chartFixedMin!==null)minChartValue=this.data.chartFixedMin;else{minChartValue=valuesRange?this.data.minValue-valuesRange/verticalSplits:this.data.minValue-1;minChartValue=this.data.minValue<0?minChartValue:Math.max(0,minChartValue);}if(this.data.chartFixedMax!==null)maxChartValue=this.data.chartFixedMax;else maxChartValue=valuesRange?this.data.maxValue+valuesRange/verticalSplits:this.data.maxValue+1;var chartValuesRange=maxChartValue-minChartValue;var realVerticalSplits=app.utils.getNiceStepsBetween(minChartValue,maxChartValue,verticalSplits);var leftPadding=(realVerticalSplits[realVerticalSplits.length-1].length)*12+10;var linesRegionWidth=svgWidth-leftPadding-rightPadding;var getXForGeoIndex=function(index){return leftPadding+linesRegionWidth/geos.length*index+linesRegionWidth/geos.length*0.5;};var getYForValue=function(value){return ((maxChartValue-value)/chartValuesRange)*linesRegionHeight+topPadding;};if(this.data.selectedUnitFullMetadata&&this.data.selectedUnitFullMetadata.name.indexOf('Percent')!=-1&&parseInt(realVerticalSplits[realVerticalSplits.length-1])>100)realVerticalSplits=realVerticalSplits.splice(0,realVerticalSplits.length-1);elements.push('<svg id="svg_chart" xmlns="http://www.w3.org/2000/svg" xmlns:data="http://extra.data/" viewBox="0 0 '+svgWidth+' '+svgHeight+'">');elements.push('<g class="axisX">');elements.push('<line x1="'+leftPadding+'" y1="'+(svgHeight-bottomPadding)+'" x2="'+(svgWidth-rightPadding)+'" y2="'+(svgHeight-bottomPadding)+'"></line>');for(var i=0;i<geos.length;i++){var x=getXForGeoIndex(i),geo=geos[i];elements.push('<text>');elements.push('<tspan x="'+x+'" y="'+(svgHeight-bottomPadding/2)+'">'+escape(geo)+'</tspan>');elements.push('</text>');}elements.push('</g>');elements.push('<g class="axisY">');for(var i=0;i<realVerticalSplits.length;i++){var value=realVerticalSplits[i],y=getYForValue(value);elements.push('<text x="'+(leftPadding*0.8)+'" y="'+y+'">'+_.escape(value)+'</text>');}elements.push('</g>');elements.push('<g class="grid">');for(var i=0;i<realVerticalSplits.length;i++){var value=realVerticalSplits[i],y=getYForValue(value);if(value==minChartValue)continue;elements.push('<line x1="'+leftPadding+'" y1="'+y+'" x2="'+(svgWidth-rightPadding)+'" y2="'+y+'"></line>');}elements.push('</g>');if(euAverageData&&euAverageData.length)for(var i=0;i<euAverageData.length;i++){var y=getYForValue(euAverageData[i].value);elements.push('<g class="average">');elements.push('<line'+(euAverageData[i].sex?' class="'+euAverageData[i].sex+'"':'')+' x1="'+leftPadding+'" y1="'+y+'" x2="'+(leftPadding+linesRegionWidth)+'" y2="'+y+'"></line>');elements.push('<text x="'+svgWidth+'" y="'+y+'">'+_.escape(euAverageData[i].geo)+'</text>');elements.push('</g>');}for(var i=0;i<geos.length;i++){var geo=geos[i],values=_.findWhere(data.rows,{geo}),x=getXForGeoIndex(i),barWidth=linesRegionWidth/geos.length;elements.push('<g class="geo">');elements.push('<rect class="gExpander" x="'+(x-barWidth/2)+'" y="'+getYForValue(maxChartValue)+'" width="'+barWidth+'" height="'+(getYForValue(minChartValue)-getYForValue(maxChartValue)+dotSize*2)+'"></rect>');var minValue=undefined,maxValue=undefined,distance=undefined,lineValues=[];for(var j=0;j<dots.length;j++){var dot=dots[j],value=values[dot.key],sex=values[dot.key+'_sex'];if(value===null)continue;if(maxValue===undefined||maxValue<value)maxValue=value;if(minValue===undefined||minValue>value)minValue=value;if(sex==='M'||sex==='W')lineValues.push(value);}if(maxValue!==undefined)elements.push('<rect class="bar" x="'+(x-barWidth/2)+'" y="'+(getYForValue(maxValue)-dotSize*2.5)+'" width="'+barWidth+'" height="'+(getYForValue(minChartValue)-getYForValue(maxValue)+dotSize*2.5-1)+'"></rect>');if(lineValues.length===2){lineValues.sort(function(a,b){return Number(a)-Number(b);});distance=Math.abs(getYForValue(lineValues[0])-getYForValue(lineValues[1]));if(distance>dotSize*2)elements.push('<line class="connector" x1="'+x+'" y1="'+(getYForValue(lineValues[1])+dotSize)+'" x2="'+x+'" y2="'+(getYForValue(lineValues[0])-dotSize)+'" ></line>');}if(minValue!==undefined&&getYForValue(minValue)-dotSize<getYForValue(minChartValue))elements.push('<line class="guide" x1="'+x+'" y1="'+getYForValue(minChartValue)+'" x2="'+x+'" y2="'+(getYForValue(minValue)+dotSize)+'"></line>');for(var j=0;j<dots.length;j++){const dot=dots[j];const value=values[dot.key];if(value===null||value===undefined)continue;const sex=values[dot.key+'_sex'],year=values[dot.key+'_year'],y=getYForValue(value);if(distance!==undefined&&distance===0)if(sex==='M')x=getXForGeoIndex(i)-5;else if(sex==='W')x=getXForGeoIndex(i)+5;else x=getXForGeoIndex(i);elements.push('<circle data:year="'+year+'" data:geo="'+geo+'"'+(sex?' class="'+sex+'"':'')+' cx="'+x+'" cy="'+y+'" r="'+dotSize+'"></circle>');}elements.push('</g>');}elements.push('</svg>');return elements.join('\n');}});})();;
(function(){"use strict";app.views.IndicatorBreakdownChart=Backbone.View.extend({initialize:function(data){this.data=data;this.render();},tagName:'div',className:'IndicatorBreakdownChart chart',render:function(){this.$el.html(app.templates.IndicatorBreakdownChart(this.data));return this;},postRender:function(){var that=this;$LAB.script(app.getFilename('app/lib/d3.min.js')).wait().script(app.getFilename('app/lib/d3.parsets.js')).wait(function(){that.renderD3Svg();if(app.isIE)that.$('svg').height(that.$('svg').width()*600/960+'px');});},renderD3Svg:function(){var that=this,dimensions=_.invoke(this.data.filter.filter(function(criteria){return !criteria.isHidden()&&criteria.isMulti&&criteria.getSelected().length>1;}),'get','code'),chart=d3.parsets().dimensions(dimensions).dimensionFormat(function format(dimension){return that.data.filter.get(dimension).get('name');}).dimensionCategoryFormat(function(option,dimension){return that.data.filter.get(dimension).getCategoryName(option);}).value(function(row){return row.value;}).categoryTooltip(function(d){return that.data.filter.get(d.dimension.name).getCategoryName(d.name)+"<br>"+d3.format(",f")(d.count)+" ("+d3.format("%")(d.count/d.dimension.count)+")";});d3.select(this.$('.wrapper').get(0)).append("svg").attr("viewBox","0 0 "+chart.width()+" "+chart.height()).datum(this.data.processedData).call(chart);this.$('.wrapper .sort').remove();},destroy:function(){Backbone.$('div.parsets.tooltip').remove();}});})();;
(function($){"use strict";app.views.IndicatorChangeAxis=Backbone.View.extend({initialize:function(){this.render();this.listenTo(Backbone,'click',this.clickAnywhere);},tagName:'div',className:'IndicatorChangeAxis',events:{'click button#changeAxis':'toggleAxisOptions','click li > button':'changeAxis'},clickAnywhere:function(e){if(Backbone.$.contains(this.el,e.target))return;this.$el.find(".dropdown").removeClass('open');},toggleAxisOptions:function(){this.$el.find(".dropdown").toggleClass('open');},changeAxis:function(e){this.model.select(e.currentTarget.value);this.trigger('change');},render:function(){this.$el.html(app.templates.IndicatorChangeAxis({model:this.model}));return this;},update:function(){this.render();}});})(Backbone.$);;
(function(){"use strict";app.views.IndicatorChartTools=Backbone.View.extend({initialize:function(data){this.data=data;this.settings=data.settings;this.render();this.listenTo(Backbone,'click',this.clickAnywhere);this.listenTo(this.settings,'change',this.render);},tagName:'div',className:'IndicatorChartTools',events:{'click li.settings > button':'toggleSettings','click li.settings > ul li.setting button':'settingClicked'},clickAnywhere:function(e){if(Backbone.$.contains(this.el,e.target))return;this.$el.find("li.settings .dropdown").removeClass('open');},toggleSettings:function(){this.$el.find("li.settings .dropdown").toggleClass('open');},settingClicked:function(e){e.stopPropagation();this.settings.toggle(Backbone.$(e.currentTarget).closest('li').attr('data-id'));},render:function(){this.$el.html(app.templates.IndicatorChartTools({data:this.data}));return this;}});})();;
(function($){"use strict";app.views.IndicatorChartTypeSelector=Backbone.View.extend({initialize:function(options){this.pageUrl=options.pageUrl;this.render();this.listenTo(this.model,'change',this.render);},tagName:'div',className:'IndicatorChartTypeSelector',events:{'click li.chart':'chartTypeClicked'},chartTypeClicked:function(e){e.preventDefault();this.model.set('selected',$(e.currentTarget).attr('data-type'));},render:function(){this.$el.html(app.templates.IndicatorChartTypeSelector({model:this.model,pageUrl:this.pageUrl}));var helpLinkTitle=app.p.t('IndicatorPage.help');this.$('ul.menu').append($("<li/>").addClass("help").append($("<a/>").attr("href","#").attr("title",helpLinkTitle).text(helpLinkTitle)));return this;}});})(Backbone.$);;
(function($){"use strict";app.views.IndicatorDataTable=Backbone.View.extend({initialize:function(datasetViewId,params){this.datasetViewId=datasetViewId;this.params=params;this.render();this.boundResize=this.resize.bind(this);$(window).on('resize',this.boundResize);},resize:function(){if(!this.iframeLoaded)return;var height=this.calculateHeight(this.$('iframe'));this.$('iframe').height(height);},calculateHeight:function($iframe){return Math.max($iframe.contents().find('html').height(),600)+'px';},destroy:function(){$(window).off('resize',this.boundResize);},tagName:'div',className:'IndicatorDataTable',appendSpinner:function(){this.removeSpinner();this.spinner=new app.views.SmallSpinner();this.registerChild(this.spinner);this.$el.append(this.spinner.el);},removeSpinner:function(){if(this.spinner){this.spinner.remove();delete this.spinner;}},render:function(){var $iframe=$('<iframe style="border: 0; height: 0em"'+'onLoad="const urlParams = new URLSearchParams(this.contentWindow.location.search); const codeParam = urlParams.get(\'code\'); '+'if (codeParam) {urlParams.delete(\'code\'); Backbone.history.navigate(\'indicator/\' + codeParam + \'/datatable\' + (urlParams.size > 0 ? \'?\' + urlParams.toString():\'\'))}" src="'+app.root+'/beta-table/view?code='+this.datasetViewId+(this.params&&this.params.code?this.params.replace("?","&"):"")+'"></iframe>');var that=this;that.appendSpinner();this.$el.append($iframe);$iframe.on('load',function(e){$iframe.animate({height:that.calculateHeight($iframe)},500,'swing',function(){that.iframeLoaded=true;that.resize();});that.removeSpinner();});return this;}});})(window.jQuery);;
(function(){"use strict";app.views.IndicatorEmbedPanel=Backbone.View.extend({className:'IndicatorEmbedPanel ModalWindow',initialize:function(options){this.sizes=options.sizes;this.render();},events:{'click .close':'closeClicked','click':'click','change select':'selectChanged','focus textarea':'textareaFocused'},closeClicked:function(e){e.preventDefault();this.trigger('close');},textareaFocused:function(e){e.currentTarget.select();},selectChanged:function(e){this.renderCode(this.sizes[e.currentTarget.selectedIndex].width);},click:function(e){e.preventDefault();if(e.target===this.el)this.trigger('close');},render:function(){this.$el.html(app.templates.IndicatorEmbedPanel({sizes:this.sizes}));this.$('select option:eq(2)').prop('selected',true).change();return this;},renderCode:function(width){this.$('textarea').html(app.controllers.indicatorPage.getIframeEmbedHtmlCode(width));}});})();;
(function(){"use strict";app.views.IndicatorExportPanel=Backbone.View.extend({className:'IndicatorExportPanel ExportOptionsModal ModalWindow',initialize:function(options){this.exportOptions=options.exportOptions;this.render();},events:{'click .close':'closeClicked','click':'click','click ul a':'exportClicked'},closeClicked:function(e){e.preventDefault();this.trigger('close');},click:function(e){if(Backbone.$.contains(this.$el.find("div.content")[0],Backbone.$(e.target)[0]))return;e.preventDefault();this.trigger('close');},exportClicked:function(e){e.preventDefault();this.trigger('export',e.currentTarget.getAttribute('data-type'),e.currentTarget.getAttribute('data-option'));},show:function(){this.$el.hide().fadeIn(100);},render:function(){this.$el.html(app.templates.IndicatorExportPanel({exportOptions:this.exportOptions}));return this;}});})();;
(function(){"use strict";app.views.IndicatorFilter=Backbone.View.extend({initialize:function(options){this.defaultOptions=options.collection.clone();this.name=options.name;this.isCurrent=options.isCurrent;this.isDefault=options.isDefault;this.render();this.$tab=this.$('.tab');this.$el.addClass('collapsed');if(this.isCurrent){this.$el.addClass('current');this.$('select').select2({dropdownAdapter:Backbone.$.fn.select2.amd.require('select2/selectAllAdapter')});}if(this.isDefault)this.$('.remove').remove();},tagName:'div',className:'IndicatorFilter',events:{'click .tab a.title':'tabClicked','click .tab a.remove':'removeClicked','click .buttons a.button.apply':'applyClicked','click .buttons a.button.cancel':'cancelClicked','change select.range':'rangeFilterValueChanged','change select':'selectFilterValueChanged','change input':'inputFilterValueChanged'},tabClicked:function(e){if(e)e.preventDefault();if(this.isCurrent){this.$el.toggleClass('collapsed expanded');this.trigger(this.$el.hasClass('collapsed')?'collapsed':'expanded',this);}else this.trigger('selected',this);},removeClicked:function(e){e.preventDefault();this.trigger('remove',this);},cancelClicked:function(e){var that=this;var formElement=e.currentTarget;var $formElement=Backbone.$(formElement).parent().parent()[0];Backbone.$.each($formElement.children,function(index,item){var code=Backbone.$(item).attr('class').split('-')[1];if(code){var currentCriteria=that.collection.get(code);var defaultOptions=that.defaultOptions.get(code).getSelected();if(currentCriteria.isMulti){currentCriteria.selectNone();for(var i=0;i<defaultOptions.length;i++)currentCriteria.select(defaultOptions[i],true);Backbone.$(item).find('select').val(defaultOptions).trigger('change');var contentIndicator=Backbone.$(item).find('span.select2').find('ul');if(currentCriteria.getSelected().length==0)contentIndicator.html("");else if(currentCriteria.getSelected().length==1){contentIndicator.html("");var htmlText=$formElement.find('select').find('option[value="'+criteria.getSelected()[0]+'"]').html();if(htmlText)contentIndicator.html("<li>"+htmlText+"</li>");else contentIndicator.html("<li>"+currentCriteria.getSelected().length+" item selected</li>");}else contentIndicator.html("<li>"+currentCriteria.getSelected().length+" items selected</li>");}else{currentCriteria.select(defaultOptions,true);Backbone.$(item).find('select').val(defaultOptions).trigger('change');}Backbone.$(item).find('option').each(function(){this.selected=currentCriteria.isSelected(this.value);});Backbone.$(item).trigger('change.select2').blur();}});this.tabClicked(e);},rangeFilterValueChanged:function(e){e.stopPropagation();var formElement=e.currentTarget,$formElement=Backbone.$(formElement),code=formElement.getAttribute('data:criteria'),criteria=this.collection.get(code),value=$formElement.val(),range=formElement.getAttribute('data:range'),$sibling=$formElement.siblings('select.range').first(),siblingValue=$sibling.val(),$validation=$formElement.parent('div').prev('.range-validation'),min=range==='min'?value:siblingValue,max=range==='min'?siblingValue:value;if(!criteria)return;$formElement.parent('div').removeClass("error");$validation.text('');if(criteria.isRangeValid(min,max))criteria.selectInRange(min,max);else{$formElement.parent('div').addClass("error");$validation.text(app.p.t('CriteriaMultiSelectRange.error'));}$formElement.find('option').each(function(){this.selected=this.value===(range==='min'?criteria.getMinSelectedOption():criteria.getMaxSelectedOption());});$formElement.trigger('change.select2').blur();},selectFilterValueChanged:function(e){var formElement=e.currentTarget,$formElement=Backbone.$(formElement),code=formElement.getAttribute('name'),criteria=this.collection.get(code),value=$formElement.val();if(!criteria)return;if(criteria.isMulti){if(value==null)criteria.selectNoneValidated();else{criteria.selectNone();for(var i=0;i<value.length;i++)criteria.select(value[i],true);}var contentIndicator=$formElement.parent().find('span.select2').find('ul');if(criteria.getSelected().length==0)contentIndicator.html("");else if(criteria.getSelected().length==1){contentIndicator.html("");var htmlText=$formElement.parent().find('select').find('option[value="'+criteria.getSelected()[0]+'"]').html();if(htmlText)contentIndicator.html("<li>"+htmlText+"</li>");else contentIndicator.html("<li>"+criteria.getSelected().length+" item selected</li>");}else contentIndicator.html("<li>"+criteria.getSelected().length+" items selected</li>");}else criteria.select(value,true);},applyClicked:function(e){e.preventDefault();this.$el.find('.validation').text('');this.trigger('changed');},update:function(){var that=this;this.$tab.find('.summary').html(this.collection.getDescription());this.collection.each(function(criteria){Backbone.$('.criteria-'+criteria.get('code')).find('option').each(function(){this.selected=criteria.isSelected(this.value);});var contentIndicator=Backbone.$('.criteria-'+criteria.get('code')).find('span.select2').find('ul');if(criteria.getSelected().length==0)contentIndicator.html("");else if(criteria.getSelected().length==1){contentIndicator.html("");var htmlText=Backbone.$('.criteria-'+criteria.get('code')).find('select').find('option[value="'+criteria.getSelected()[0]+'"]').html();if(htmlText)contentIndicator.html("<li>"+htmlText+"</li>");else contentIndicator.html("<li>"+criteria.getSelected().length+" item selected</li>");}else contentIndicator.html("<li>"+criteria.getSelected().length+" items selected</li>");Backbone.$('.criteria-'+criteria.get('code')).trigger('change.select2').blur();});},render:function(){this.$el.html(app.templates.IndicatorFilter({criterias:this.collection,name:this.name,isCurrent:this.isCurrent}));return this;}});})();;
(function($){"use strict";app.views.IndicatorHorizontalBarChart=Backbone.View.extend({initialize:function(data){this.data=data;this.yAxis=data.y_axis_default;this.geos=[];this.geosNames=[];this.render();},tagName:'div',className:'IndicatorHorizontalBarChart chart',events:{'mouseenter g.geo circle':'mouseEnterDot','mousemove g.geo circle':'mouseMoveDot','mouseleave g.geo circle':'mouseLeaveDot','mouseenter g.axisY text tspan':'textEnter','mouseleave g.axisY text tspan':'textLeave'},textEnter:function(e){var country=e.currentTarget.innerHTML;var regions=app.collections.regions;var helperObject={};if(this.yAxis){country=_.find(this.geosNames,function(item){return item.code===country;}).name;helperObject[this.yAxis]=country;}var x=e.currentTarget.getAttribute('x');var y=e.currentTarget.getAttribute('y');var html=app.templates.PlainTextTooltipContent({yAxis:this.yAxis,text:country,regions});Backbone.trigger('Tooltip:show',{top:e.clientY,left:e.clientX,width:'250px',html});Backbone.trigger('Tooltip:pointTo',{top:e.clientY,left:e.clientX});},textLeave:function(e){Backbone.trigger('Tooltip:hide');},mouseEnterDot:function(e){var year=e.currentTarget.getAttribute('data:year'),country=e.currentTarget.getAttribute('data:geo'),regions=app.collections.regions;var helperObject={};if(this.yAxis){var nameFull=_.find(this.geosNames,function(item){return item.code===country;}).name;helperObject[this.yAxis]=country;}else helperObject["geo"]=country;var valueElement=_.findWhere(this.data.tableData.rows,helperObject),countryValueHeaders=this.data.tableData.headers.slice(1),euAverage=_.sortBy(this.data.euAverageData,function(data){return _.pluck(countryValueHeaders,'label').indexOf(data.sex);}),html=app.templates.CountryYearMultiValuesTooltipContent({yAxis:this.yAxis,year,country,regions,valueElement,countryValueHeaders,flagValues:app.collections.flagValues,euAverage,nameFull});Backbone.trigger('Tooltip:show',{top:e.clientY,left:e.clientX,width:'250px',html});},mouseMoveDot:function(e){Backbone.trigger('Tooltip:pointTo',{top:e.clientY,left:e.clientX});},mouseLeaveDot:function(e){Backbone.trigger('Tooltip:hide');},render:function(){this.$el.html(app.templates.IndicatorHorizontalBarChart(this.data)).find('.svgPlaceholder').replaceWith(this.generateGraphHtml());return this;},postRender:function(){},generateGraphHtml:function(){var data=this.data.tableData;var euAverageData=this.data.euAverageData;var svgWidth=1200;var yAxis=this.data.y_axis_default;if(yAxis){var geos=_.pluck(data.rows,this.data.y_axis_default);this.geos=geos;var geosNames=this.data.filter.get(yAxis).get('categories');this.geosNames=geosNames;}else var geos=_.pluck(data.rows,'geo');var linesRegionHeight=35*geos.length;var dots=data.headers.slice(1);var horizontalSplits=8;var valuesRange=this.data.maxValue-this.data.minValue;var leftPadding=10;var rightPadding=50;var bottomPadding=50;var topPadding=50;var svgHeight=linesRegionHeight+bottomPadding+topPadding;var dotSize=9;var elements=[];var verticalSplits=linesRegionHeight/(geos.length%2?geos.length+1:geos.length);verticalSplits=parseFloat(verticalSplits.toFixed(2));var minChartValue;if(this.data.chartFixedMin!==null)minChartValue=this.data.chartFixedMin;else{minChartValue=valuesRange?this.data.minValue-valuesRange/horizontalSplits:this.data.minValue-1;minChartValue=this.data.minValue<0?minChartValue:Math.max(0,minChartValue);}var maxChartValue;if(this.data.chartFixedMax!==null)maxChartValue=this.data.chartFixedMax;else maxChartValue=valuesRange?this.data.maxValue+valuesRange/horizontalSplits:this.data.maxValue+1;const chartValuesRange=maxChartValue-minChartValue;const realHorizontalSplits=app.utils.getNiceStepsBetween(minChartValue,maxChartValue,horizontalSplits);String.prototype.width=function(font){var f=font||'15px arial',o=$('<div></div>').text(this).css({'position':'absolute','float':'left','white-space':'nowrap','visibility':'hidden','font':f}).appendTo($('body')),w=o.width();o.remove();return w;};elements.push('<svg id="svg_chart" xmlns="http://www.w3.org/2000/svg" xmlns:data="http://extra.data/" viewBox="0 0 '+svgWidth+' '+svgHeight+'">');elements.push('<g class="axisY">');var maxWidthText=0;for(var i=0;i<geos.length;i++){var geo=geos[i];if(geo.width()>maxWidthText)maxWidthText=geo.width();}var chartStartY=svgHeight>=1200?1.5*topPadding:topPadding;var chartStartX=leftPadding*3+maxWidthText;var linesRegionWidth=svgWidth-chartStartX-rightPadding;var getYForGeoIndex=function(index){return linesRegionHeight/geos.length*index+chartStartY;};var getXForValue=function(value,leftPadding){return linesRegionWidth-((maxChartValue-value)/chartValuesRange)*linesRegionWidth+leftPadding;};var y=0;for(var i=0;i<geos.length;i++){var geo=geos[i];var geoTokens=[geo];elements.push('<text>');if(!geoTokens[1])elements.push('<tspan x="'+(leftPadding*2.5+maxWidthText)+'" y="'+(getYForGeoIndex(i))+'">'+decodeURI(geoTokens[0].toString())+'</tspan>');else{elements.push('<tspan x="'+(leftPadding*2.5)+'" y="'+(getYForGeoIndex(i))+'">'+decodeURI(geoTokens[0].toString())+'</tspan>');elements.push('<tspan x="'+(leftPadding*2.5+maxWidthText)+'" y="'+(getYForGeoIndex(i))+'">'+decodeURI(geoTokens[1].toString())+'</tspan>');}elements.push('</text>');y=y+verticalSplits;}elements.push('</g>');elements.push('<line x1="'+(chartStartX)+'" y1="'+(getYForGeoIndex(0)-topPadding/2)+'" x2="'+(chartStartX)+'" y2="'+(getYForGeoIndex(geos.length-1)+bottomPadding/2)+'" stroke="black"></line>');elements.push('<g class="axisX">');for(var i=0;i<realHorizontalSplits.length;i++){var value=realHorizontalSplits[i];var x=getXForValue(value,chartStartX);elements.push('<text x="'+(x)+'" y="'+(getYForGeoIndex(0)-30)+'">'+_.escape(value)+'</text>');elements.push('<text x="'+(x)+'" y="'+(getYForGeoIndex(geos.length-1)+34)+'">'+_.escape(value)+'</text>');}elements.push('</g>');elements.push('<g class="grid">');for(var i=0;i<realHorizontalSplits.length;i++){var value=realHorizontalSplits[i];var x=getXForValue(value,chartStartX);if(value==minChartValue)continue;elements.push('<line x1="'+(x)+'" y1="'+(chartStartY)+'" x2="'+(x)+'" y2="'+(getYForGeoIndex(geos.length-1))+'"></line>');}elements.push('</g>');if(euAverageData&&euAverageData.length)for(var i=0;i<euAverageData.length;i++){var x=getXForValue(euAverageData[i].value,chartStartX);elements.push('<g class="average">');elements.push('<line'+(euAverageData[i].sex?' class="'+euAverageData[i].sex+'"':'')+' x1="'+x+'" y1="'+chartStartY+'" x2="'+x+'" y2="'+(getYForGeoIndex(geos.length-1))+'"></line>');elements.push('<text x="'+x+'" y="'+(chartStartY-15)+'">'+_.escape(euAverageData[i].geo)+'</text>');elements.push('<text x="'+x+'" y="'+(getYForGeoIndex(geos.length)-17)+'">'+_.escape(euAverageData[i].geo)+'</text>');elements.push('</g>');}for(var i=0;i<geos.length;i++){var geo=geos[i];var helperObject={};if(yAxis)helperObject[yAxis]=geo;else helperObject['geo']=geo;var values=_.findWhere(data.rows,helperObject);var y=getYForGeoIndex(i,chartStartX);var barWidth=linesRegionHeight/geos.length;elements.push('<g class="geo">');var minValue=undefined,maxValue=undefined,distance=undefined,lineValues=[];for(var j=0;j<dots.length;j++){var dot=dots[j],value=values[dot.key],sex=values[dot.key+'_sex'];if(value===null)continue;if(maxValue===undefined||maxValue<value)maxValue=value;if(minValue===undefined||minValue>value)minValue=value;if(sex==='M'||sex==='W')lineValues.push(value);}if(maxValue!==undefined)elements.push('<rect class="bar" x="'+chartStartX+'" y="'+(y-barWidth/2)+'" width="'+(getXForValue(maxValue,chartStartX)-chartStartX+2*dotSize)+'" height="'+barWidth+'"></rect>');if(lineValues.length===2){lineValues.sort(function(a,b){return Number(a)-Number(b);});distance=Math.abs(getXForValue(lineValues[0],chartStartX)-getXForValue(lineValues[1],chartStartX));if(distance>dotSize*2)elements.push('<line class="connector" x1="'+(getXForValue(lineValues[1],chartStartX)+dotSize)+'" y1="'+(y)+'" x2="'+(getXForValue(lineValues[0],chartStartX)-dotSize)+'" y2="'+(y)+'" ></line>');}if(minValue!==undefined)elements.push('<line class="guide" x1="'+getXForValue(minChartValue,chartStartX)+'" y1="'+(y)+'" x2="'+(getXForValue(minValue,chartStartX)+dotSize)+'" y2="'+(y)+'"></line>');for(var j=0;j<dots.length;j++){const dot=dots[j];const value=values[dot.key];if(value===null||value===undefined)continue;const sex=values[dot.key+'_sex'],year=values[dot.key+'_year'],x=getXForValue(value,chartStartX);if(distance!==undefined&&distance===0)if(sex==='M')y=getYForGeoIndex(i)-5;else if(sex==='W')y=getYForGeoIndex(i)+5;else y=getYForGeoIndex(i);elements.push('<circle data:year="'+year+'" data:geo="'+geo+'"'+(sex?' class="'+sex+'"':'')+' cx="'+x+'" cy="'+(y)+'" r="'+dotSize+'"></circle>');}elements.push('</g>');}elements.push('</svg>');return elements.join('\n');}});})(Backbone.$);;
(function(){"use strict";app.views.IndicatorLineChart=Backbone.View.extend({initialize:function(data,settings){this.data=data;this.settings=settings;this.listenTo(this.settings,'change:proportionalXAxis',this.render);this.render();},tagName:'div',className:'IndicatorLineChart chart',events:{'mouseenter g.line circle':'mouseEnterDot','mousemove g.line circle':'mouseMoveDot','mouseleave g.line circle':'mouseLeaveDot'},mouseEnterDot:function(e){var that=this,geos=app.collections.regions.pluck('_id'),sexes=that.data.filter.get('sex')?_.pluck(that.data.filter.get('sex').getSortedCategories(),'code'):[],year=e.currentTarget.getAttribute('data:year'),yearData=_.where(this.data.processedData,{year}).sort(function(a,b){var geo=_.indexOf(geos,a.geo)-_.indexOf(geos,b.geo),sex=_.indexOf(sexes,a.sex)-_.indexOf(sexes,b.sex);return geo||sex;}),countriesInYearData=_.pluck(yearData,'geo'),euAverage=_.filter(this.data.euAverageData,function(data){return !_.contains(countriesInYearData,data.geo)&&data.year===year;}),html=app.templates.IndicatorLineChartTooltip({year,yearData,euAverage});Backbone.trigger('Tooltip:show',{top:e.clientY,left:e.clientX,width:'250px',html});},mouseMoveDot:function(e){Backbone.trigger('Tooltip:pointTo',{top:e.clientY,left:e.clientX});},mouseLeaveDot:function(e){Backbone.trigger('Tooltip:hide');},render:function(){this.$el.html(app.templates.IndicatorLineChart(this.data)).find('.svgPlaceholder').replaceWith(this.generateGraphHtml());return this;},postRender:function(){if(app.isIE)this.$('svg').height(this.$('svg').width()*555/1200+'px');},generateGraphHtml:function(){var data=this.data.tableData,euAverageData=this.data.euAverageData,svgWidth=1200,svgHeight=555,years=_.pluck(data.rows,'year'),lines=data.headers.slice(1),verticalSplits=8,valuesRange=this.data.maxValue-this.data.minValue,minChartValue=valuesRange?this.data.minValue-valuesRange/verticalSplits:this.data.minValue-1,minChartValue=this.data.minValue<0?minChartValue:Math.max(0,minChartValue),maxChartValue=valuesRange?this.data.maxValue+valuesRange/verticalSplits:this.data.maxValue+1,chartValuesRange=maxChartValue-minChartValue,realVerticalSplits=app.utils.getNiceStepsBetween(minChartValue,maxChartValue,verticalSplits),leftPadding=(realVerticalSplits[realVerticalSplits.length-1].length)*12,rightPadding=60,bottomPadding=40,topPadding=10,dotSize=8,linesRegionWidth=svgWidth-leftPadding-rightPadding,linesRegionHeight=svgHeight-bottomPadding-topPadding,minYearWidth=linesRegionWidth/20,elements=[],that=this;if(that.settings.isEnabled('proportionalXAxis'))var firstYear=parseInt(years[0]),lastYear=parseInt(years[years.length-1]),yearLabels=app.utils.generateYearLabelSeries(firstYear,lastYear,this.data.timeFormat),lastYear=app.utils.parseYear(yearLabels[yearLabels.length-1].label),columnWidth=linesRegionWidth/yearLabels.length,getXForYearLabelIndex=function(index){var year=app.utils.parseYear(yearLabels[index].label);return leftPadding+(linesRegionWidth-columnWidth)*(year-firstYear)/(lastYear-firstYear)+columnWidth*0.5;};if(!that.settings.isEnabled('proportionalXAxis')||yearLabels.length==1)var yearLabels=_.map(years,function(year){return {label:year,start:true};}),getXForYearLabelIndex=function(index){return leftPadding+linesRegionWidth/yearLabels.length*index+linesRegionWidth/yearLabels.length*0.5;};elements.push('<svg id="svg_chart" xmlns="http://www.w3.org/2000/svg" xmlns:data="http://extra.data/" viewBox="0 0 '+svgWidth+' '+svgHeight+'">');elements.push('<g class="axisX">');elements.push('<line x1="'+leftPadding+'" y1="'+(svgHeight-bottomPadding)+'" x2="'+(svgWidth-rightPadding)+'" y2="'+(svgHeight-bottomPadding)+'"></line>');var lastLabelEnd=0;for(var i=0;i<yearLabels.length;i++){var year=yearLabels[i],splitHeight=20,x=getXForYearLabelIndex(i);if(year.start){elements.push('<line x1="'+x+'" y1="'+(svgHeight-bottomPadding-splitHeight)+'" x2="'+x+'" y2="'+(svgHeight-bottomPadding)+'"></line>');if(x>lastLabelEnd){elements.push('<text x="'+x+'" y="'+(svgHeight-bottomPadding/2)+'">'+_.escape(year.label)+'</text>');lastLabelEnd=x+10*year.label.length;}}else elements.push('<line x1="'+x+'" y1="'+(svgHeight-bottomPadding-splitHeight/3)+'" x2="'+x+'" y2="'+(svgHeight-bottomPadding)+'"></line>');}elements.push('</g>');elements.push('<g class="axisY">');for(var i=0;i<realVerticalSplits.length;i++){var value=realVerticalSplits[i],y=((maxChartValue-value)/chartValuesRange)*linesRegionHeight+topPadding;elements.push('<text x="'+(leftPadding*0.8)+'" y="'+y+'">'+_.escape(value)+'</text>');}elements.push('</g>');elements.push('<g class="grid">');for(var i=0;i<realVerticalSplits.length;i++){var value=realVerticalSplits[i],y=((maxChartValue-value)/chartValuesRange)*linesRegionHeight+topPadding;if(value==minChartValue)continue;elements.push('<line x1="'+leftPadding+'" y1="'+y+'" x2="'+(svgWidth-rightPadding)+'" y2="'+y+'"></line>');}elements.push('</g>');for(var i=0;i<lines.length;i++){var line=lines[i];elements.push('<g class="line nth-child-'+(i+1)+'" data:line="'+line.key+'">');var previousValue=null,previousY=null,previousX=null,backElements=[],frontElements=[],captionElement=null;for(var j=0;j<years.length;j++){var year=years[j],valueElement=_.findWhere(data.rows,{year});if(!valueElement)continue;var x=getXForYearLabelIndex(yearLabels.indexOf(_.findWhere(yearLabels,{label:year}))),value=valueElement[line.key],geo=valueElement[line.key+'_geo'],sex=valueElement[line.key+'_sex'],y=((maxChartValue-value)/chartValuesRange)*linesRegionHeight+topPadding;if(_.isNumber(previousValue)&&_.isNumber(value))backElements.push('<line x1="'+previousX+'" y1="'+previousY+'" x2="'+x+'" y2="'+y+'"></line>');if(_.isNumber(value)){frontElements.push('<circle data:year="'+year+'" data:geo="'+geo+'"'+(sex?' data:sex="'+sex+'"':'')+' cx="'+x+'" cy="'+y+'" r="'+dotSize+'"></circle>');captionElement='<text x="'+(getXForYearLabelIndex(years.length-1)+dotSize+5)+'" y="'+y+'">'+_.escape(line.label)+'</text>';}previousValue=value;previousY=y;previousX=x;}elements=elements.concat(backElements).concat(frontElements);if(captionElement&&lines.length>1)elements.push(captionElement);elements.push('</g>');}elements.push('</svg>');return elements.join('\n');}});})();;
(function(){"use strict";app.views.IndicatorMapChart=Backbone.View.extend({initialize:function(data,settings){this.data=data;this.settings=settings;var that=this;$LAB.script(app.getFilename('app/data/map.js')).wait(function(){that.render();that.listenTo(that.settings,'change:symbolMap',that.symbolMapUpdate);that.symbolMapUpdate();if(app.isIE)that.$('svg').height(that.$('svg').width()*720/1200+'px');});},tagName:'div',className:'IndicatorMapChart chart',symbolMapUpdate:function(){this.$el.toggleClass('symbolMap',this.settings.isEnabled('symbolMap'));},events:{'mouseenter g.country.withData':'mouseEnterCountry','mousemove g.country.withData':'mouseMoveCountry','mouseleave g.country.withData':'mouseLeaveCountry','mouseenter circle':'mouseEnterCountry','mousemove circle':'mouseMoveCountry','mouseleave circle':'mouseLeaveCountry','mouseenter text.hasData':'mouseEnterCountry','mousemove text.hasData':'mouseMoveCountry','mouseleave text.hasData':'mouseLeaveCountry'},mouseEnterCountry:function(e){var country=e.currentTarget.getAttribute('data:country'),year=e.currentTarget.getAttribute('data:year'),regions=app.collections.regions,valueElement=_.findWhere(this.data.tableData.rows,{geo:country}),countryValueHeaders=this.data.tableData.headers.slice(1),euAverage=_.sortBy(this.data.euAverageData,function(data){return _.pluck(countryValueHeaders,'label').indexOf(data.sex);}),html=app.templates.CountryYearMultiValuesTooltipContent({yAxis:null,year,country,regions,valueElement,countryValueHeaders,flagValues:app.collections.flagValues,euAverage});Backbone.trigger('Tooltip:show',{top:e.clientY,left:e.clientX,width:'340px',html});},mouseMoveCountry:function(e){Backbone.trigger('Tooltip:pointTo',{top:e.clientY,left:e.clientX});},mouseLeaveCountry:function(e){Backbone.trigger('Tooltip:hide');},render:function(){var that=this;var euAverageData=_.sortBy(this.data.euAverageData,function(data){return _.pluck(that.data.tableData.headers.slice(1),'label').indexOf(data.sex);});this.$el.html(app.templates.IndicatorMapChart({regions:app.collections.regions,euAverageData})).find('.svgPlaceholder').replaceWith(this.generateGraphHtml());return this;},generateGraphHtml:function(){var scale=1,mapDataWidth=1200,mapDataHeight=720,svgWidth=mapDataWidth*scale,svgHeight=mapDataHeight*scale,axisPadding=10,axisWidth=10,axisHeight=svgHeight-axisPadding*2,data=this.data,axisMin=data.minValue,axisMax=data.maxValue,symbolMapCircleMinSize=10,symbolMapCircleMaxSize=30,lines=5,elements=[],symbolAndTextElements=[],colorGroupMinValues=[];function translate(point){return [svgWidth/mapDataWidth*point[0],svgHeight/mapDataHeight*point[1]];}for(var i=0;i<lines;i++)if(i===0)colorGroupMinValues.push(Math.floor(axisMin));else colorGroupMinValues.push(((axisMax-axisMin)/lines*i+axisMin).toFixed(0));function getColorClassName(value){if(_.indexOf(colorGroupMinValues,value)!==-1)return "group-"+_.indexOf(colorGroupMinValues,value)+1;else return "group-"+_.sortedIndex(colorGroupMinValues,value);}elements.push('<svg id="svg_chart" xmlns="http://www.w3.org/2000/svg" xmlns:data="http://extra.data/" viewBox="0 0 '+svgWidth+' '+svgHeight+'">');for(var i=0;i<app.data.map.length;i++){var country=app.data.map[i],countryData=_.findWhere(data.tableData.rows,{geo:country.code}),countryValueHeader=data.tableData.headers[1],hasValue=countryData&&_.has(countryData,countryValueHeader.key);if(hasValue){var value=countryData[countryValueHeader.key];var year=countryData[countryValueHeader.key+'_year'];if(data.tableData.rows.length==1)elements.push('<g data:country="'+country.code+'" data:year="'+year+'" class="country group-3 country-'+country.code+' withData'+'">');else elements.push('<g data:country="'+country.code+'" data:year="'+year+'" class="country country-'+country.code+' withData '+getColorClassName(value)+'">');}else{const noDataClass=country.center&&country.code!=='UK'?" noData":"";elements.push('<g data:country="'+country.code+'" data:year="'+year+'" class="country country-'+country.code+noDataClass+'">');}for(var j=0;j<country.shapes.length;j++){var shape=country.shapes[j];elements.push('<polygon points="'+_.map(shape,function(point){return translate(point);}).join(' ')+'" />');}elements.push('</g>');if(country.center){var center=translate(country.center.point);if(hasValue){var value=countryData[countryValueHeader.key];var symbolMapCircleSize=(value-axisMin)/(axisMax-axisMin)*(symbolMapCircleMaxSize-symbolMapCircleMinSize)+symbolMapCircleMinSize;if(!symbolMapCircleSize)symbolMapCircleSize=10.50;symbolAndTextElements.push('<circle data:country="'+country.code+'" class="'+getColorClassName(value)+'" data:year="'+year+'" cx="'+center[0]+'" cy="'+(center[1]-5)+'" r="'+symbolMapCircleSize+'"></circle>');}symbolAndTextElements.push('<text x="'+center[0]+'" y="'+center[1]+'" data:country="'+country.code+'" data:year="'+year+'" class="country country-'+country.code+' '+(hasValue?'hasData '+getColorClassName(value):'')+'">'+_.escape(country.code)+'</text>');}}elements=elements.concat(symbolAndTextElements);for(var i=0;i<lines;i++)if(data.tableData.rows.length==1)elements.push('<rect class="axis group-3" x="'+(axisPadding+0.5)+'" y="'+(axisPadding+axisHeight-(axisHeight/lines*(i+1))+0.5)+'" width="'+axisWidth+'" height="'+(axisHeight/lines)+'" />');else elements.push('<rect class="axis group-'+(i+1)+'" x="'+(axisPadding+0.5)+'" y="'+(axisPadding+axisHeight-(axisHeight/lines*(i+1))+0.5)+'" width="'+axisWidth+'" height="'+(axisHeight/lines)+'" />');for(var i=0;i<lines+1;i++)elements.push('<text class="axis" x="'+(axisPadding+axisWidth+5)+'" y="'+(5+axisPadding+axisHeight-(axisHeight/lines*i))+'">'+(i===lines?Math.ceil(axisMax):colorGroupMinValues[i])+'</text>');elements.push('</svg>');return elements.join('\n');}});})();;
(function(){"use strict";app.views.IndicatorMetadataDateInfo=Backbone.View.extend({initialize:function(options){this.metadata=options.metadata;this.render();},tagName:'div',className:'import-info',render:function(){this.$el.html(app.templates.IndicatorMetadataDateInfo({metadata:this.metadata}));return this;}});})();;
(function(){"use strict";app.views.IndicatorMetadataDescription=Backbone.View.extend({initialize:function(options){this.metadataDescription=options.metadata.description;this.pageUrl=options.pageUrl;this.render();},tagName:'div',className:'IndicatorMetadataDescription',render:function(){this.$el.html(app.templates.IndicatorMetadataDescription({metadataDescription:this.metadataDescription,pageUrl:this.pageUrl}));return this;}});})();;
(function($){"use strict";app.views.IndicatorMetadata=Backbone.View.extend({initialize:function(options){this.metadata=options.metadata;this.criterias=options.criterias;this.render();app.utils.applyContentInteractions(this.$el);this.$(".expandable-title:first").click();},tagName:'div',className:'IndicatorMetadata',render:function(){this.$el.html(app.templates.IndicatorMetadata({metadata:this.metadata,criterias:this.criterias}));return this;}});})(Backbone.$);;
(function(){"use strict";app.views.IndicatorMetadataKeywords=Backbone.View.extend({tagName:'div',className:'keywords',initialize:function(options){this.metadata=options.metadata;this.render();},render:function(){this.$el.html(app.templates.IndicatorMetadataKeywords({metadata:this.metadata}));return this;}});})();;
(function(){"use strict";app.views.IndicatorMetadataSource=Backbone.View.extend({initialize:function(options){this.metadata=options.metadata;this.pageUrl=options.pageUrl;this.render();},tagName:'div',className:'IndicatorMetadataSource',render:function(){this.$el.html(app.templates.IndicatorMetadataSource({metadata:this.metadata,pageUrl:this.pageUrl}));return this;}});})();;
(function(){"use strict";app.views.IndicatorNoData=Backbone.View.extend({initialize:function(width,height){this.width=width;this.height=height;this.render();},tagName:'div',className:'IndicatorNoData chart',render:function(){this.$el.html(app.templates.IndicatorNoData(this.data)).find('.svgPlaceholder').replaceWith(this.generateGraphHtml());return this;},generateGraphHtml:function(){var elements=[];elements.push('<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 '+this.width+' '+this.height+'">');elements.push('</svg>');return elements.join('\n');}});})();;
(function(){"use strict";app.views.IndicatorPageFooterBar=Backbone.View.extend({className:'IndicatorPageFooterBar',initialize:function(options){this.chartType=options.chartType;this.render();this.listenTo(this.chartType,'change',this.render);Backbone.$(window).on('scroll',this.windowScrolled.bind(this));},events:{'click a.export':'exportClicked','click a.help':'helpClicked'},exportClicked:function(e){e.preventDefault();this.trigger('exportModal');},helpClicked:function(e){e.preventDefault();this.trigger('helpModal');},windowScrolled:function(){var currentScroll=Backbone.$(window).scrollTop(),windowHeight=Backbone.$(window).height(),targets=[];if(!this.scrollLinks)return;for(var i=0;i<this.scrollLinks.length;i++){var href=this.scrollLinks[i].getAttribute('href'),$target=Backbone.$(Backbone.$(href));if($target.offset())targets.push({link:this.scrollLinks[i],target:$target,top:Math.round($target.offset().top),bottom:Math.round($target.offset().top+$target.height()),topDistanceFromCenter:Math.round(Math.abs($target.offset().top-(currentScroll+windowHeight/2))),bottomDistanceFromCenter:Math.round(Math.abs($target.offset().top+$target.height()-(currentScroll+windowHeight/2)))});}var closestTarget=_.min(targets,function topOrBottom(target){return Math.min(target.topDistanceFromCenter,target.bottomDistanceFromCenter);});this.$('.navigation a').removeClass('selected');if(closestTarget)Backbone.$(closestTarget.link).addClass('selected');},destroy:function(){Backbone.$(window).off('scroll');},render:function(){this.$el.html(app.templates.IndicatorPageFooterBar({chartType:this.chartType}));this.scrollLinks=this.$('.navigation a[data-scroll]');this.windowScrolled();return this;}});})();;
(function($){"use strict";app.views.IndicatorPage=Backbone.View.extend({className:'IndicatorPage',initialize:function(options){this.exportOptions=options.exportOptions;this.chartTypeSelectorModel=options.chartTypeSelectorModel;this.settings=options.settings;this.params=options.params;this.render();this.indicatorTitle="";},render:function(){this.$el.html(app.templates.IndicatorPage());var breadcrumb=new app.views.Breadcrumb();this.registerChild(breadcrumb);this.$el.find('.dataset-info').after(breadcrumb.el);return this;},events:{'click ul.menu li.help a':'helpOpenClicked','click ul.tools li.export button':'exportOpenClicked'},exportOpenClicked:function(){this.showExportModal();},helpOpenClicked:function(e){e.preventDefault();this.showHelpModal();},wrapLinkToSource:function($elem){$elem.wrapInner('<a href="'+window.location.href.replace(/embed\/iframe\//,'')+'" target="_blank" />');},renderMetadata:function(content,metadata,shouldShowIndicatorData){this.indicatorTitle=content.datasetView.name;this.$('h2.title').html(this.indicatorTitle);if(_.contains(content.datasetView.parent_themes,'index'))this.$el.addClass("geiIndicator");var indicatorMetadata=new app.views.IndicatorMetadata({metadata});this.registerChild(indicatorMetadata);this.$('div.tab.metadata').append(indicatorMetadata.el);if(!shouldShowIndicatorData)return;this.$('div.tab.metadata').hide();var pageUrl=app.root+'/indicator/'+content.datasetView._id;var indicatorChartTypeSelector=new app.views.IndicatorChartTypeSelector({model:this.chartTypeSelectorModel,pageUrl});this.registerChild(indicatorChartTypeSelector);this.$('.main .chart-selector').prepend(indicatorChartTypeSelector.el);if(metadata.keywords&&metadata.keywords.length){var indicatorMetadataKeywords=new app.views.IndicatorMetadataKeywords({metadata},content);this.registerChild(indicatorMetadataKeywords);this.$el.find('.dataset-info').append(indicatorMetadataKeywords.el);}if(metadata.base_information.field_content.updated_on){var indicatorMetadataDateInfo=new app.views.IndicatorMetadataDateInfo({metadata});this.registerChild(indicatorMetadataDateInfo);this.$el.find('.dataset-info').append(indicatorMetadataDateInfo.el);}var indicatorMetadataSource=new app.views.IndicatorMetadataSource({metadata,pageUrl});this.registerChild(indicatorMetadataSource);this.$el.find('.dataset-info').append(indicatorMetadataSource.el);var indicatorMetadataDescription=new app.views.IndicatorMetadataDescription({metadata,pageUrl});this.registerChild(indicatorMetadataDescription);indicatorMetadataDescription.$el.find(".text-formatted-extended").children(':gt(1)').remove();this.$el.find('.dataset-info').before(indicatorMetadataDescription.$el);if(app.isEmbed){this.$('h2.title').after($("<h3/>").addClass("title").text(this.indicatorTitle));this.$('h2.title').remove();this.$el.find('.dataset-info').after(app.templates.IndicatorEmbedIframeSource());this.wrapLinkToSource(this.$('.iframe-info .app-title'));}},showExportModal:function(){if(this.exportModal)return;;if(this.chartTypeSelectorModel.get("selected")==="datatable"){this.appendSpinner();var excelLink=document.getElementsByTagName('iframe')[0].contentWindow.document.getElementsByClassName('navbar-nav')[0].getElementsByTagName('li')[1].getElementsByTagName('a')[0];var hiddenDatatableIframe=document.getElementById('datatable_download_iframe');if(hiddenDatatableIframe)document.body.removeChild(document.getElementById('datatable_download_iframe'));hiddenDatatableIframe=document.createElement('iframe');hiddenDatatableIframe.setAttribute('id','datatable_download_iframe');hiddenDatatableIframe.src=excelLink.getAttribute('href');hiddenDatatableIframe.style.display='none';document.body.appendChild(hiddenDatatableIframe);var that=this;$('#datatable_download_iframe').on('load',function(){var downloadDatatableButton=hiddenDatatableIframe.contentWindow.document.getElementById('download-button');downloadDatatableButton.click();that.removeSpinner();});}else{this.exportModal=new app.views.IndicatorExportPanel({exportOptions:this.exportOptions});this.registerChild(this.exportModal);this.$el.append(this.exportModal.el);this.exportModal.show();this.listenTo(this.exportModal,'close',this.closeExportModal);this.listenTo(this.exportModal,'export',this.exportClicked);}},closeExportModal:function(){this.exportModal.remove();delete this.exportModal;},showEmbedModal:function(){if(this.embedModal)return;var that=this;this.embedModal=new app.views.IndicatorEmbedPanel({sizes:_.map([420,480,640,800,960],function(width){return {width,height:2*that.getEstimatedEmbedHeightForWidth(width)};})});this.registerChild(this.embedModal);this.$el.append(this.embedModal.el);this.listenTo(this.embedModal,'close',this.closeEmbedModal);},closeEmbedModal:function(){this.embedModal.remove();delete this.embedModal;},exportClicked:function(type,target){this.trigger('export',type,target);},showHelpModal:function(){if(this.helpModal)return;this.helpModal=new app.views.ModalWindow();this.registerChild(this.helpModal);this.$el.append(this.helpModal.el);this.helpModal.appendSpinner();this.listenTo(this.helpModal,'close',this.closeHelpModal);this.trigger('help');},renderHelpModalContent:function(content){if(!this.helpModal)return;this.helpModal.removeSpinner();if(content&&content.body&&content.body.en&&content.body.en.value)this.helpModal.renderContent(content.body.en.value);else this.closeHelpModal();},closeHelpModal:function(){this.helpModal.remove();delete this.helpModal;},removeFilters:function(){this.filterCollapsed();if(this.indicatorFilters)_.invoke(this.indicatorFilters,'remove');if(this.addFilter){this.addFilter.remove();delete this.addFilter;}},renderFilters:function(filters,currentFilter,chartTypeController,renderAddFilterComponent){this.removeFilters();this.indicatorFilters=this.indicatorFilters||[];for(var i=0;i<filters.length;i++){var filter=filters[i],isCurrent=filter===currentFilter,isDefault=i===0;var indicatorFilter=new app.views.IndicatorFilter({name:app.p.t('IndicatorFilter.name_'+(isDefault?'default':'custom'),{name:i}),collection:filter,isCurrent,isDefault});this.registerChild(indicatorFilter);this.$('section.filters > .wrapper').append(indicatorFilter.el);var form=this.$('.IndicatorFilter')[0];$.each(form.children,function(index,item){var code=$(item).attr('class').split('-')[1];if(code){var currentCriteria=filter.get(code);if(currentCriteria.isMulti){var contentIndicator=$(item).find('span.select2').find('ul');if(currentCriteria.getSelected().length==0)contentIndicator.html("");else if(currentCriteria.getSelected().length==1){contentIndicator.html("");var htmlText=$(item).find('select').find('option[value="'+currentCriteria.getSelected()[0]+'"]').html();if(htmlText)contentIndicator.html("<li>"+htmlText+"</li>");else contentIndicator.html("<li>"+currentCriteria.getSelected().length+" item selected</li>");}else contentIndicator.html("<li>"+currentCriteria.getSelected().length+" items selected</li>");}}});this.indicatorFilters.push(indicatorFilter);this.listenTo(indicatorFilter,'changed',this.filterChanged);this.listenTo(indicatorFilter,'selected',this.filterSelected);this.listenTo(indicatorFilter,'collapsed',this.filterCollapsed);this.listenTo(indicatorFilter,'expanded',this.filterExpanded);this.listenTo(indicatorFilter,'remove',this.filterRemove);if(isCurrent)this.currentFilter=indicatorFilter;}if(this.addFilter){this.addFilter.remove();delete this.addFilter;}this.filterCollapsed();if(this.criteriaShortcut)this.criteriaShortcut.remove();if(chartTypeController.getCriteriaShortcut(currentFilter)){this.criteriaShortcut=new app.views.CriteriaShortcut({model:chartTypeController.getCriteriaShortcut(currentFilter)});this.registerChild(this.criteriaShortcut);this.$('section.helpers').append(this.criteriaShortcut.el);this.listenTo(this.criteriaShortcut,'change',this.filterChanged);}if(this.changeYAxisView)this.changeYAxisView.remove();if(chartTypeController.getChangeYAxisModel){this.changeYAxisView=new app.views.IndicatorChangeAxis({model:chartTypeController.getChangeYAxisModel()});this.registerChild(this.changeYAxisView);this.$('section.helpers').append(this.changeYAxisView.el);this.listenTo(this.changeYAxisView,'change',this.filterChanged);}if(this.timeline){this.timeline.remove();delete this.timeline;}if(chartTypeController.getTimelineCriteria(currentFilter)){this.timeline=new app.views.CriteriaTimeline({title:this.indicatorTitle,model:chartTypeController.getTimelineCriteria(currentFilter),state:new Backbone.Model({play:false})},this.settings);this.registerChild(this.timeline);this.$('div.tab.chart').append(this.timeline.el);this.listenTo(this.timeline,'change',this.filterChanged);}},filterChanged:function(){this.trigger('filter:changed');if(this.currentFilter)this.currentFilter.update();if(this.criteriaShortcut)this.criteriaShortcut.update();if(this.timeline)this.timeline.update();if(this.changeYAxisView)this.changeYAxisView.update();},filterSelected:function(filter){this.trigger('filter:selected',filter.collection);},filterCollapsed:function(filter){this.$('section.filters').css('height','auto');},filterExpanded:function(filter){var filterHeaderHeight=$(filter.el).outerHeight();var filterContentHeight=$('.content',filter.el).outerHeight();this.$('section.filters').css('height',filterHeaderHeight+filterContentHeight);},filterRemove:function(filter){this.trigger('filter:remove',filter.collection);},removeData:function(){if(this.indicatorChartTools){this.indicatorChartTools.remove();delete this.indicatorChartTools;}if(this.indicatorChart){this.indicatorChart.remove();delete this.indicatorChart;}if(this.indicatorDataTable){this.indicatorDataTable.remove();delete this.indicatorDataTable;}if(this.indicatorNoData){this.indicatorNoData.remove();delete this.indicatorNoData;}},getEstimatedEmbedHeightForWidth:function(embedWidth){var chartWidth=this.$('div.tab.chart').width(),chartHeight=this.$('div.tab.chart').height();return Math.round(embedWidth*chartHeight/chartWidth)+25;},renderData:function(data,chartTypeController,dataDisplay,datasetViewId){this.removeData();var shouldShowMetaTab=true;if(this.chartTypeSelectorModel.get("selected")==="metadata")this.$el.find('.IndicatorMetadataDescription').hide();else this.$el.find('.IndicatorMetadataDescription').show();if(chartTypeController.getPossibleTabs().indexOf('chart')>=0){this.$('div.tab.chart').show();this.$('li.export').show();this.indicatorChartTools=new app.views.IndicatorChartTools({selectedUnitFullMetadata:data.selectedUnitFullMetadata,visibleSettings:chartTypeController.getVisibleSettings(data.y_axis_default),settings:this.settings});this.registerChild(this.indicatorChartTools);this.$('section.helpers').append(this.indicatorChartTools.el);this.indicatorChart=chartTypeController.createChart(data,this.settings);this.registerChild(this.indicatorChart);this.$('div.tab.chart section.helpers').after(this.indicatorChart.el);if(this.indicatorChart.postRender)this.indicatorChart.postRender();this.wrapLinkToSource(this.$('.source'));shouldShowMetaTab=false;}else this.$('div.tab.chart').hide();if(chartTypeController.getPossibleTabs().indexOf('table')>=0){this.$('div.tab.table').show();this.indicatorChartTools=new app.views.IndicatorChartTools({settings:this.settings});this.registerChild(this.indicatorChartTools);this.$('div.tab.table').append(this.indicatorChartTools.el);if(this.timeline){this.timeline.remove();delete this.timeline;}this.indicatorDataTable=new app.views.IndicatorDataTable(datasetViewId,this.params);this.registerChild(this.indicatorDataTable);this.$('div.tab.table').show().append(this.indicatorDataTable.el);shouldShowMetaTab=false;}else this.$('div.tab.table').hide();if(shouldShowMetaTab)this.$('div.tab.metadata').show();else this.$('div.tab.metadata').hide();},renderNoData:function(chartTypeController){this.removeData();this.indicatorNoData=chartTypeController.createNoDataChart();this.registerChild(this.indicatorNoData);this.$('section.helpers').after(this.indicatorNoData.el);this.$('div.tab.metadata').hide();},render404:function(){var error404View=app.controllers.error404Page.createView();this.registerChild(error404View);this.$el.html(error404View.el);},appendSpinner:function(){this.removeSpinner();this.spinner=new app.views.SmallSpinner();this.registerChild(this.spinner);this.$el.append(this.spinner.el);},removeSpinner:function(){if(this.spinner){this.spinner.remove();delete this.spinner;}}});})(Backbone.$);;
(function($){"use strict";app.views.ModalWindow=Backbone.View.extend({className:'ModalWindow',initialize:function(){this.render();},events:{'click .close':'closeClicked','click a[data-scroll]':'scroll'},closeClicked:function(e){e.preventDefault();this.trigger('close');},scroll:function(e){e.preventDefault();e.stopPropagation();var $element=this.$(e.currentTarget.href.substring(e.currentTarget.href.indexOf('#')));if($element.length===0)return;var wrapperPosition=$(".scrollable-wrapper > div").position().top;this.$el.find('.scrollable-wrapper > div').animate({scrollTop:($element.position().top-wrapperPosition)},250);},render:function(){this.$el.html(app.templates.ModalWindow());return this;},renderContent:function(content){content='<div class="body field text-formatted-extended">'+content+'</div>';var $content=$(content);var $modalTitle=$content.find("h2:first");$content.find("h2:first").remove();this.$el.find('.content > div').prepend($modalTitle);this.$el.find('.scrollable-wrapper > div').append($content);},appendSpinner:function(){this.removeSpinner();this.spinner=new app.views.SmallSpinner();this.registerChild(this.spinner);this.$el.find('.content').append(this.spinner.el);},removeSpinner:function(){if(this.spinner){this.spinner.remove();delete this.spinner;}}});})(Backbone.$);;
(function($){"use strict";app.views.MultipleSelectFilterDefault=Backbone.View.extend({className:'MultipleSelectFilterDefault',initialize:function(){this.render();},render:function(){this.$el.html(app.templates.MultipleSelectFilterDefault(this.model));if(!app.isMobile)this.$('select').select2();return this;},events:{'change':'optionsChanged','click .select-clear':'clearSelected'},clearSelected:function(e){e.preventDefault();this.$('select').val(null).trigger("change");return false;},optionsChanged:function(){var that=this;this.$('select option').each(function(){var $option=$(this);if($option.is(':selected'))that.model.select($option.val());else that.model.deselect($option.val());});}});})(Backbone.$);;
(function($){"use strict";app.views.NavigationTree=Backbone.View.extend({className:"NavigationTree",searchResultsTreeClassName:"search-results",displayRootIndicatorCount:false,initialize:function(options){this.controller=options.controller;this.customTitle=(options.title)?options.title:false;this.displayTitle=(options.displayTitle!==undefined)?options.displayTitle:true;this.displayRootIndicatorCount=options.displayRootIndicatorCount;this.searchTimeout=false;this.searchTerm='';this.render();},render:function(){return this;},renderTree:function(tree){this.tree=tree;var params={title:this.displayTitle?((this.customTitle)?this.customTitle:tree.name):false,viewId:this.cid,minCharsLimit:this.controller.minSearchCharsLimit,maxCharsLimit:this.controller.maxSearchCharsLimit,indicatorsCount:{display:this.displayRootIndicatorCount,value:tree.indicators_count}};this.$el.html(app.templates.NavigationTree(params));this.$treeSection=this.$el.children(".tree").children("nav");var treeHasData=this.renderThemesAndIndicatorsList(this.$treeSection,tree);if(!treeHasData){this.$el.children('.tree-filter').remove();this.$el.children('.help').remove();this.$treeSection.empty().append(app.templates.NavigationTreeEmpty({message:app.p.t('NavigationTree.empty')}));}return this;},renderThemesAndIndicatorsList:function($element,tree,animation){if(!tree||!$element)return false;if(!(_.has(tree,"orderedChildren")||_.has(tree,"indicators")))return false;var themes=_.has(tree,"orderedChildren")?tree.orderedChildren:[];var indicators=_.has(tree,"indicators")?tree.indicators:[];indicators=_.sortBy(indicators,function(o){return o.order;});if(!(themes.length||indicators.length))return false;var $content=$(app.templates.ThemesAndIndicatorsList({themes,indicators,pathFromRoot:tree.nextLevelPath}));if(animation)$content.hide().appendTo($element).slideToggle(300);else $element.append($content);return true;},renderSearchResultsTree:function($element,tree){if(!tree||!$element)return false;var hasRenderedResults=this.renderThemesAndIndicatorsList($element,tree);if(_.has(tree,"orderedChildren")){var that=this;_.each(tree.orderedChildren,function(child){that.renderSearchResultsTree($element.find(".theme_"+child.id),child);});}return hasRenderedResults;},events:{'click section:not(.search-results) li.theme > button':'toggleNode','keyup section.tree-filter input':'filterTree','mouseleave section.tree-filter input':'filterTree','click div.help button':'showHelpModal'},toggleNode:function(e){var $target=$(e.target);var $theme=$target.parent("li");var $children=$theme.children("ul");if($children.length)$children.slideToggle(300,function(){$children.remove();});else this.renderThemesAndIndicatorsList($theme,this.controller.getRenderableNode($theme.attr("data-tree-path")),true);},filterTree:function(e){var that=this;var term=$(e.currentTarget).val().trim();if(that.searchTerm===term)return;that.searchTerm=term;that.$treeSection.removeClass(that.searchResultsTreeClassName).empty();if(term.length===0)that.renderThemesAndIndicatorsList(that.$treeSection,that.tree);if(term.length>=that.controller.minSearchCharsLimit){if(that.searchTimeout)clearTimeout(that.searchTimeout);that.searchTimeout=setTimeout(function(){that.$treeSection.addClass(that.searchResultsTreeClassName);var hasSearchResults=that.renderSearchResultsTree(that.$treeSection,that.controller.searchTree(that.tree.pathFromRoot,term));if(!hasSearchResults)that.$treeSection.append(app.templates.NavigationTreeEmpty({message:app.p.t('NavigationTree.filter.empty',{filter:term})}));},250);}},showHelpModal:function(e){if(this.helpModal)return;this.helpModal=new app.views.ModalWindow();this.registerChild(this.helpModal);this.$el.append(this.helpModal.el);this.helpModal.appendSpinner();this.listenTo(this.helpModal,'close',this.closeHelpModal);this.controller.fetchHelpText(_.bind(this.renderHelpModalContent,this),_.bind(this.closeHelpModal,this));},renderHelpModalContent:function(content){if(!this.helpModal)return;this.helpModal.removeSpinner();if(content&&content.body&&content.body.en&&content.body.en.value)this.helpModal.renderContent(content.body.en.value);else this.closeHelpModal();},closeHelpModal:function(){this.helpModal.remove();delete this.helpModal;}});})(Backbone.$);;
(function($){"use strict";app.views.SearchPage=Backbone.View.extend({className:'SearchPage',initialize:function(options){if(options.controller)this.controller=options.controller;this.render();this.listenTo(Backbone,'view:rendered',this.updateActiveMenuLink);this.$el.find(".view-footer").hide();},events:{'click .form-submit':'performSearch','click .form-clear':'clearSearch','click .pager a':'updateResultsPage'},render:function(){this.$el.html(app.templates.SearchPage());return this;},updateActiveMenuLink:function(){app.utils.updateActiveMenuLink($,"search");},renderFilter:function(filter){var filterView=null;if(filter.isSelect)filterView=new app.views.MultipleSelectFilterDefault({model:filter});else filterView=new app.views.TextFilter({model:filter});this.$el.find(".view-filters .views-exposed-widgets").append(filterView.el);this.registerChild(filterView);},renderSearchControls:function(){this.$el.find(".view-filters .views-exposed-widgets").append(app.templates.SearchPageControls());},renderPager:function(pager,urlParams){this.$el.find(".view-footer").show();this.$el.find(".view-results-count p").html(app.templates.PagerSummary({pager}));this.$el.find(".view-pager.top").html(app.templates.Pager({pager,url:urlParams}));this.$el.find(".view-pager.bottom").html(app.templates.Pager({pager,url:urlParams}));},renderResults:function(results){this.$el.find(".view-content").html(app.templates.SearchPageResults({results}));},renderEmptyResultsMessage:function(){this.$el.find(".view-content").html(app.templates.SearchPageResultsEmpty());this.$el.find(".view-footer").hide();},updateTitle:function(data){this.$el.find("h2").remove();this.$el.find("p.subtitle").remove();this.$el.prepend(app.templates.SearchPageTitle({data}));},updateResultsPage:function(e){e.preventDefault();this.controller.updatePaginatedResults(Backbone.$(e.currentTarget).attr("href"));},appendSpinner:function($element){this.removeSpinner();this.spinner=new app.views.SmallSpinner();this.registerChild(this.spinner);if(!$element)$element=this.$el;$element.append(this.spinner.el);},emptyResultsAndAppendSpinner:function(){var $resultsSection=this.$el.find(".view-content");$resultsSection.empty();this.appendSpinner($resultsSection);},removeSpinner:function(){if(this.spinner){this.spinner.remove();delete this.spinner;}},performSearch:function(){this.controller.updateSearchFilters();},clearSearch:function(e){this.controller.clearSearch();this.performSearch();}});})(Backbone.$);;
(function($){"use strict";app.views.Skeleton=Backbone.View.extend({initialize:function(options){this.controller=options.controller;this.settings=options.settings;this.render();this.$el.append(new app.views.Tooltip().el);this.handleScrollingLinks();this.listenToOnce(Backbone.history,'route',function(){this.listenTo(Backbone.history,'route',function(){if(window._paq){_paq.push(['setDocumentTitle',document.title]);_paq.push(['setCustomUrl',Backbone.history.location.toString()]);_paq.push(['trackPageView']);}});this.listenTo(Backbone,'track-action',function(category,action,name){if(window._paq)_paq.push(['trackEvent',category,action,name]);});});},events:{'click a:not([data-bypass],[href="#"])':'navigationLinkClicked','click':'clickAnywhere'},navigationLinkClicked:function(e){var href=e.currentTarget.getAttribute('href')||e.currentTarget.getAttribute('xlink:href');if(href.indexOf('http')===0)return;e.preventDefault();this.controller.navigationLinkClicked(href);},clickAnywhere:function(e){Backbone.trigger('click',e);},handleScrollingLinks:function(){var that=this;function scrollTo($elem,speed){if($elem.length===0)return;$("html, body").animate({scrollTop:$elem.offset().top},speed||250);}function scrollToTop(speed){scrollTo(that.$el,speed||125);}this.$el.on('click','a[data-scroll]',function(e){e.preventDefault();scrollTo($(this.href.substring(this.href.indexOf('#'))));});this.listenTo(Backbone,'view:rendered',function(){if(!history.pushState)return;if(window.location.hash.length>1)scrollTo($(window.location.hash));else{}});this.listenTo(Backbone,'scrollTo',function(selector,speed){scrollTo(this.$(selector),speed);});},render:function(){this.$el.html(app.templates.Skeleton());return this;},renderSubView:function(view){this.$('#dgs-view').append(view.el);app.utils.updateActiveMenuLink($,"browse-gender-statistics");Backbone.trigger('view:rendered');}});})(Backbone.$);;
(function(){"use strict";app.views.SmallSpinner=Backbone.View.extend({tagName:'div',className:'SmallSpinner',initialize:function(){this.render();},render:function(){this.$el.html(app.templates.SmallSpinner());return this;}});})();;
(function($){"use strict";app.views.SourceStatsSection=Backbone.View.extend({className:'SourceStatsSection',source_type_EIGE_COLLECTED:'Data collected by EIGE',source_type_EIGE_CALCULATED:'Data developed by EIGE using other internal or external datasets',source_EUROSTAT:'Eurostat',valueThreshold:7,events:{'mouseenter div.source':'mouseEnterSource','mousemove div.source':'mouseMoveSource','mouseleave div.source':'mouseLeaveSource'},mouseEnterSource:function(e){var html=app.templates.SourceStatsSectionTooltipContent({title:e.currentTarget.dataset.title});Backbone.trigger('Tooltip:show',{top:e.clientY,left:e.clientX,width:'200px',html});},mouseMoveSource:function(e){Backbone.trigger('Tooltip:pointTo',{top:e.clientY,left:e.clientX});},mouseLeaveSource:function(e){Backbone.trigger('Tooltip:hide');},initialize:function(){this.fetchSourceTypesAndRender();},render:function(content){this.$el.html(app.templates.SourceStatsSection({stats:content})).find('.chart').append(this.generateGraphHtml(content));return this;},fetchSourceTypesAndRender:function(){var that=this;if(that.sourceRequest&&that.sourceRequest.abort)that.sourceRequest.abort();that.sourceRequest=Backbone.$.ajax({url:app.getDbEndpoint('source-types')});Backbone.$.when(that.sourceRequest).done(function(data){delete that.sourceRequest;that.render(data);}).fail(function(e){if(e.status===200)return;if(e.status===0)return;Backbone.trigger('error',e);});},generateGraphHtml:function(data){var elements=[],that=this;var overallTotal=0;var overallSourceEige=0;var overallSourceEigeCalculated=0;var overallSourceEurostat=0;var overallSourceOther=0;_.each(data,function(theme){theme.key=app.utils.sanitize(theme.name);var datasets=theme.datasets;if(datasets.length){var sourceTypeEige=_.filter(datasets,function(dataset){return dataset.type===that.source_type_EIGE_COLLECTED;});var sourceTypeEigeCalculated=_.filter(datasets,function(dataset){return dataset.type===that.source_type_EIGE_CALCULATED;});var sourceTypeOther=_.filter(datasets,function(dataset){return dataset.type!==that.source_type_EIGE_COLLECTED&&dataset.type!==that.source_type_EIGE_CALCULATED;});var sourceEurostat=0;var sourceOther=0;if(sourceTypeOther.length){var datasetsEurostat=_.filter(sourceTypeOther,function(dataset){return dataset.organisation===that.source_EUROSTAT;});sourceEurostat=datasetsEurostat.length;sourceOther=sourceTypeOther.length-sourceEurostat;}theme.total=datasets.length;theme.sourceEige=sourceTypeEige.length;theme.sourceEigeCalculated=sourceTypeEigeCalculated.length;theme.sourceEurostat=sourceEurostat;theme.sourceOther=sourceOther;overallTotal+=theme.total;overallSourceEige+=theme.sourceEige;overallSourceEigeCalculated+=theme.sourceEigeCalculated;overallSourceEurostat+=theme.sourceEurostat;overallSourceOther+=theme.sourceOther;}});var overallTheme=_.findWhere(data,{key:'overall'});overallTheme.total=overallTotal;overallTheme.sourceEige=overallSourceEige;overallTheme.sourceEigeCalculated=overallSourceEigeCalculated;overallTheme.sourceEurostat=overallSourceEurostat;overallTheme.sourceOther=overallSourceOther;var that=this;_.each(data,function(theme){elements.push('<p class="'+theme.key+'">'+theme.name+'</p>');var percentageEige=Math.round((100*theme.sourceEige)/theme.total);var percentageEigeCalculated=Math.round((100*theme.sourceEigeCalculated)/theme.total);var percentageEurostat=Math.round((100*theme.sourceEurostat)/theme.total);var percentageOther=Math.round((100*theme.sourceOther)/theme.total);elements.push('<div class="'+theme.key+' bars">');if(percentageEige>0){var valueClass=percentageEige>that.valueThreshold?"in":"out";elements.push('<p>'+app.p.t('SourceStats.source_eige')+'</p>');elements.push('<div data-title="'+app.p.t('SourceStats.source_eige')+'" class="source source-eige" style="width:'+percentageEige+'%;"><span class="value '+valueClass+'">'+percentageEige+'%</span></div>');}if(percentageEigeCalculated>0){var valueClass=percentageEigeCalculated>that.valueThreshold?"in":"out";elements.push('<p>'+app.p.t('SourceStats.source_eige_calculated')+'</p>');elements.push('<div data-title="'+app.p.t('SourceStats.source_eige_calculated')+'" class="source source-eige-calculated" style="width:'+percentageEigeCalculated+'%;"><span class="value '+valueClass+'">'+percentageEigeCalculated+'%</span></div>');}if(percentageEurostat>0){var valueClass=percentageEurostat>that.valueThreshold?"in":"out";elements.push('<p>'+app.p.t('SourceStats.source_eurostat')+'</p>');elements.push('<div data-title="'+app.p.t('SourceStats.source_eurostat')+'" class="source source-eurostat" style="width:'+percentageEurostat+'%;"><span class="value '+valueClass+'">'+percentageEurostat+'%</span></div>');}if(percentageOther>0){var valueClass=percentageOther>that.valueThreshold?"in":"out";elements.push('<p>'+app.p.t('SourceStats.source_other')+'</p>');elements.push('<div data-title="'+app.p.t('SourceStats.source_other')+'" class="source source-other" style="width:'+percentageOther+'%;"><span class="value '+valueClass+'">'+percentageOther+'%</span></div>');}elements.push('</div>');});return elements.join('\n');}});})(Backbone.$);;
(function($){"use strict";app.views.TagKeywordsSection=Backbone.View.extend({className:'TagKeywordsSection',initialize:function(content){this.render(content);},render:function(content){content=_.map(content,function(i,pos){i["index"]=pos;return i;});var index=[5,9,1,4,6,0,2,8,3,7];var output=_.map(index,function(i,pos){return content[i];});this.$el.html(app.templates.TagKeywordsSection({tags:output,pageUrl:app.root+'/search/k:'}));return this;}});})(Backbone.$);;
(function(){"use strict";app.views.TextFilter=Backbone.View.extend({className:'TextFilter',initialize:function(){this.render();},render:function(){this.$el.html(app.templates.TextFilter(this.model));return this;},events:{'change':'valueChanged'},valueChanged:function(){this.model.setValue(this.$el.find("input").val());}});})();;
(function(){"use strict";app.views.ThemePage=Backbone.View.extend({className:"ThemePage",initialize:function(options){this.controller=options.controller;this.navigationTreeBrowser=new app.views.NavigationTree({controller:app.controllers.navigationTree,displayRootIndicatorCount:true,displayTitle:false});this.registerChild(this.navigationTreeBrowser);this.render();},render:function(){this.$el.html(app.templates.ThemePage());this.$navigationSection=this.$el.find("section.theme-navigation");this.$metadataSection=this.$el.find("section.theme-metadata");this.$navigationSection.append(this.navigationTreeBrowser.el);var breadcrumb=new app.views.Breadcrumb();this.registerChild(breadcrumb);this.$el.append(breadcrumb.el);return this;},renderContent:function(tree,hasDescription,previousTheme,nextTheme){this.tree=tree;this.$el.addClass("theme_"+tree.topLevelParentPath);this.$el.find('h2:first').text(tree.name);this.navigationTreeBrowser.renderTree(tree);if(!hasDescription){this.$metadataSection.remove();this.$navigationSection.removeClass("large-6 medium-6");}else this.$metadataSection.find(".content-wrapper").append(app.templates.ThemePageAbout({theme:tree}));if(previousTheme||nextTheme)this.$el.append(app.templates.ThemePagePager({previousTheme,nextTheme}));},render404:function(){var error404View=app.controllers.error404Page.createView();this.registerChild(error404View);this.$el.html(error404View.el);}});})();;
(function(){"use strict";app.views.Title=Backbone.View.extend({initialize:function(){this.listenTo(Backbone,'title',this.render);},render:function(data){var elements=[app.p.t('website_title_long'),app.p.t('title_long')];if(data&&!_.isArray(data))elements.push(data);if(data&&_.isArray(data))elements=_.union(elements,_.compact(data));var newTitle=elements.reverse().join(' | ');document.title=newTitle;Backbone.trigger('title:changed',newTitle);return this;}});})();;
(function(){"use strict";app.views.Tooltip=Backbone.View.extend({tagName:'div',className:'Tooltip',initialize:function(options){this.render();this.$leftArrow=this.$('.arrow.left');this.$rightArrow=this.$('.arrow.right');this.leftArrowTarget={x:-25,y:25,opposite:false,shown:this.$leftArrow,hidden:this.$rightArrow};this.rightArrowTarget={x:25,y:25,opposite:true,shown:this.$rightArrow,hidden:this.$leftArrow};this.hide();this.listenTo(Backbone,'Tooltip:hide',this.hide);this.listenTo(Backbone,'Tooltip:show',this.show);this.listenTo(Backbone,'Tooltip:pointTo',this.pointTo);Backbone.$(window).on('scroll',this.hide.bind(this));},hide:function(){this.$el.hide();},show:function(data){if(data.width){this.$el.css('width',data.width);this.$rightArrow.css('left',data.width);}this.arrowTarget=data.left<window.innerWidth/2?this.leftArrowTarget:this.rightArrowTarget;this.arrowTarget.shown.show();this.arrowTarget.hidden.hide();this.$('.content').html(data.html);this.$el.show();},pointTo:function(data){if(!this.arrowTarget)return;this.$el.css({top:data.top-this.arrowTarget.y,left:data.left-this.arrowTarget.x-(this.arrowTarget.opposite&&this.$el.width())});},render:function(){this.$el.html(app.templates.Tooltip());return this;},destroy:function(){Backbone.$(window).off('scroll');}});})();;
var app=app||{};(function($){"use strict";app.strings={locale:'en',errors:{ajax_500:'Could not communicate with server. Please try again.\nError message was: %{message} (%{status})',ajax_generic:'Could not communicate with server. Please try again.\nError message was: %{message} (%{status})',ajax_timeout:'Communication with server timed out. Please check your internet connection and try again.',ajax_connection_error:'Communication with server could not be established. Please check your internet connection and try again.',generic:'An error has occured. Please try again.'},title_short:'DGS',title_long:'Gender Statistics Database',website_title_short:"EIGE",website_title_long:"European Institute for Gender Equality",IndexPage:{title:'Browse Gender Statistics',data_talks:'Data Talks',more_label:'Read more',featured:'Featured indicators',publications:'Latest publications'},AboutPage:{title:'About the Gender Statistics Database'},TagsPage:{title:'Popular Topics'},SourceStats:{title:'Sources of indicators used in EIGE Gender Statistics database',source_eige:'Data directly collected by EIGE',source_eige_calculated:'Data computed by EIGE',source_eurostat:'Data from Eurostat',source_other:'Data from other sources',notes_title:'Notes',note_1:'The proportions in this bar may not sum up to exactly 100%, due to rounding',note_2:'The total number of indicators in the visualisation does not reflect the total number of datasets in the Database, as datasets may occur more than once under different entry points.'},SearchPage:{title:'Search',search:{label:'Text search',placeholder:'please type a term',help:'Surround the search term(s) in quotes, for an exact phrase match e.g. "people at risk"'},filters:{keywords:'Keywords',source_orgs:'Source organisation',source_activities:'Statistical activity',data_types:'Data type'},buttons:{search:'Search',clear:'Clear All'},results:{title:'%{smart_count} indicator was found |||| %{smart_count} indicators were found',title_active_search_prefix:' for ',title_active_search_separator:' and ',title_search_term_prefix:'text ',title_keyword_prefix:'keyword |||| keywords ',subtitle:'Also searched for keyword synonyms ',path_label:'Filed under',empty:'Please update your search and try again'}},BrowsePage:{title_short:'Browse',title_full:'Browse Gender Statistics'},ThemePage:{title:'%{theme}',default_title:'Thematic area'},NavigationTree:{aria:'Gender Statistics Indicators',theme:{indicators:'%{smart_count} indicator |||| %{smart_count} indicators',info:'View more information',link:'View more',expand:'Expand'},empty:'There are no indicators available for this theme.',filter:{label:'Filter',placeholder:'Filter all indicators by typing %{limit} letters at least',empty:'There are no results found for term "%{filter}"'},help:{label:'Help'},downloads:{data_sources:{file_path:'sites/default/files/documents/source_catalog_170926.xlsx',file_title:'Data sources'}}},IndicatorPage:{title:{pending:'Indicator',loaded:'Indicator: %{indicator}'},source:'Source: Gender Statistics database of European Institute for Gender Equality',help:'Help',chart:'Chart',data_table:'Data Table',metadata:'Metadata',export:'Export'},IndicatorChartTypeSelector:{map:'Map',map_title:'Indicator data in an EU heat map',bar:'Bar Chart',bar_title:'Indicator data in a vertical bar chart showing statistics seggregated by sex',hbar:'Horizontal Bar Chart',hbar_title:'Indicator data in a horizontal bar chart showing statistics seggregated by sex',line:'Line Chart',line_title:'Indicator data for selected countries over time',breakdown:'Breakdown Chart',breakdown_title:'Full indicator data broken down by criterion',datatable:'Data Table',datatable_title:'Full indicator data presented in a table',metadata:'Metadata',metadata_title:'Full indicator data information'},IndicatorDataTable:{title:'Data Table',value:'Value',yAxis:{year:'Years',geo:'Countries'},unit:'Unit',comparable:'comparable'},IndicatorChartTools:{unit:'Unit',settings:'View Settings',fixedYAxis:'Fixed Y Axis',symbolMap:'Symbol Map',euAverages:'EU Averages',eu27Only:'EU27 Countries',proportionalXAxis:'Proportional X Axis'},IndicatorChangeAxis:{title:'Change Y Axis'},IndicatorMetadata:{source:'Source',base_information:{label:'Base Information',fields:{source_type:'Source type',source_org:'Source organisation',source_org_url:'Source organisation URL',source_activity:'Statistical activity',source_ref:'Source reference',data_type:'Data type',harmonised:'Harmonised',value_count:'Number of values',updated_on:'Last upload on'},years:'Years',time_periods:'Time Periods',criterias:{code:'Code',value:'Value'},flags:{label:'Flags',code:'Code',value:'Value'}},description:'Description',dataset_information:'Dataset information',reference_metadata:'Reference metadata',reference_metadata_empty:'Dataset has no metadata',keywords:'Keywords',downloads:'Pre-defined tables for download'},IndicatorFilter:{name_default:'Filter',name_custom:'My Filter %{name}',apply:'Apply',cancel:'Clear all',remove:'Remove Filter',selectAll:'Select All',selectNone:'Deselect All'},IndicatorAddFilter:{action:'Add Filter'},IndicatorNoData:{title:'No data',description:'The combination of criterias you\'ve selected for this indicator does not yield any results. Please try again with different parameters.'},IndicatorExportPanel:{title:'Export Options',chart:{title:'Export Visualisation as:',png:'PNG',jpg:'JPG'},embed:{title:'Embed Visualisation with:',iframe:'IFRAME'},data:{title:'Export Data Table as:',png:'PNG',jpg:'JPG',xlsx:'XLSX',csv:'CSV',xml:'XML',json:'JSON'},full:'Full',close:'Close'},IndicatorEmbedPanel:{title:'Embed Visualisation',close:'Close',help_generic:'Paste the following HTML snippet anywhere in your webpage. The indicator title and chart will appear for the currently selected indicator, chart type and settings.',help_bg_html:'You can append <code>&amp;bg=RRGGBB</code> at the end of the iframe src URL in order to affect the background colour of the embeded widget, where <code>RRGGBB</code> is the hex representation of the color (e.g use <code>FF0000</code> for red and <code>888888</code> for gray).',size:'Size'},Breadcrumb:{label:'Filed under'},ModalWindow:{close:'Close'},CriteriaTimeline:{title:'Timeline',play:'Play',pause:'Pause'},Pager:{first:{label:'« first',title:'Go to first page'},prev:{label:'‹ previous',title:'Go to previous page'},next:{label:'next ›',title:'Go to next page'},last:{label:'last »',title:'Go to last page'},summary:'<strong>%{total}</strong> items <span class="hide-for-small">/ <strong>%{pages}</strong> pages</span>'},SmallSpinner:{loading:'Loading & processing data...'},Error404Page:{title:'Page not found',content:{main:'The page you requested could not be found. Please try again or use the search box below to search the Gender Statistics Database.',footer:'If you think this is an error of the website, please contact us.'},search:{label:'Search',placeholder:'Search in Gender Statistics Database',submit:'Search'}},Criteria:{year:{label:'Time Period',labelMulti:'Time Periods',helpMulti:'(From > To)',some:'%{count} time periods',all:'All time periods'},geo:{label:'Country',labelMulti:'Countries',some:'%{count} countries',all:'All countries'},sex:{some:'%{count} sex options',all:'All sex options'},_:{all:'All %{code}',some:'%{count} %{code}'}},CriteriaMultiSelectRange:{error:'Selected range is not valid'},IndicatorMetadataKeywords:{title:'Keywords'},IndicatorMetadataDescription:{title:'Data description',readMore:'Read more about the indicator'}};})();;
(function(drupalSettings){"use strict";window.app.data.tree=drupalSettings.eige_dgs['app.data.tree'];window.app.data.flags=drupalSettings.eige_dgs['app.data.flags'];window.app.data.regions=drupalSettings.eige_dgs['app.data.regions'];window.app.data.searchFilters=drupalSettings.eige_dgs['app.data.searchFilters'];window.app.isEmbed=drupalSettings.eige_dgs['app.isEmbed'];window.app.run(drupalSettings.eige_dgs.root,drupalSettings.eige_dgs.ajaxPath,drupalSettings.eige_dgs.rootFiles,drupalSettings.eige_dgs.rootElementSelector,drupalSettings.eige_dgs.cacheBuster);})(window.drupalSettings);;
(function($,drupalSettings){'use strict';$(document).ready(function(){defaultBind();if(drupalSettings.matomo&&drupalSettings.matomo.trackColorbox)$(document).bind('cbox_complete',function(){var href=$.colorbox.element().attr('href');if(href){_paq.push(['setCustomUrl',href]);if(drupalSettings.matomo.disableCookies)_paq.push(['disableCookies']);_paq.push(['trackPageView']);}});});function defaultBind(){$(document.body).bind('mousedown keyup touchstart',function(event){$(event.target).closest('a,area').each(function(){if(drupalSettings.matomo.trackMailto&&$(this).is("a[href^='mailto:'],area[href^='mailto:']"))_paq.push(['trackEvent','Mails','Click',this.href.substring(7)]);});});}})(jQuery,drupalSettings);;
